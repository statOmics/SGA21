<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement" />


<title>Technical details on linear regression for proteomics when starting from summarized protein expression values</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SGA21</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./docs/intro.pdf">1.1 Position</a>
    </li>
    <li>
      <a href="recapGeneralLinearModel.html">1.2 Recap linear model</a>
    </li>
    <li>
      <a href="./docs/martens_proteomics_bioinformatics.pdf">2.1 PDA - identification</a>
    </li>
    <li>
      <a href="pda_quantification_preprocessing.html">2.2 PDA- Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_robustSummarisation_peptideModels.html">2.2 PDA - Wrap-up Preprocessing - Peptide-Level-Models</a>
    </li>
    <li>
      <a href="pda_quantification_inference.html">2.3 PDA - Quantification - Differential Abundance Analysis</a>
    </li>
    <li>
      <a href="pda_blocking_wrapup.html">2.3 PDA - Wrap-up DA - Blocking</a>
    </li>
    <li>
      <a href="technicalDetailsProteomics.html">2.4. PDA - DA Technical Details</a>
    </li>
    <li>
      <a href="./docs/stagewiseTesting.pdf">2.5 PDA - Stage-wise testing</a>
    </li>
    <li>
      <a href="sequencing_intro.html">3.1 SDA - Intro to sequencing</a>
    </li>
    <li>
      <a href="sequencing_countData.html">3.2 SDA - Working with count data</a>
    </li>
    <li>
      <a href="sequencing_rnaseqIntro.html">3.3 SDA - Intro to RNA-seq analysis</a>
    </li>
    <li>
      <a href="sequencing_technicalDE.html">3.4 SDA - Technical topics in DE analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="multipleRegression_KPNA2.html">1 Intro KPNA2</a>
    </li>
    <li>
      <a href="https://www.compomics.com/bioinformatics-for-proteomics/">2.1 Identification</a>
    </li>
    <li>
      <a href="pda_tutorialPreprocessing.html">2.2 DA - Preprocessing</a>
    </li>
    <li>
      <a href="pda_tutorialDesign.html">2.3 DA - Design</a>
    </li>
    <li>
      <a href="sequencing_preprocessing.sh">3.1 Preprocessing</a>
    </li>
    <li>
      <a href="sequencing_lab_oneGene.html">3.2 GLM for one gene</a>
    </li>
    <li>
      <a href="sequencing_hw.html">3.3 Bulk RNA-seq homework</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Technical details on linear regression for proteomics when starting from summarized protein expression values</h1>
<h4 class="author">Lieven Clement</h4>
<h4 class="date">statOmics, Ghent University (<a href="https://statomics.github.io" class="uri">https://statomics.github.io</a>)</h4>

</div>


<div id="preamble" class="section level1">
<h1><span class="header-section-number">1</span> Preamble</h1>
<p>Read stored results for heart data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(limma)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(QFeatures)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(msqrob2)</span>
<span id="cb1-5"><a href="#cb1-5"></a>pe &lt;-<span class="st"> </span><span class="kw">readRDS</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="kw">url</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="st">&quot;https://raw.githubusercontent.com/statOmics/SGA2020/gh-pages/assets/peHeart.rds&quot;</span>,</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="st">&quot;rb&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  )</span></code></pre></div>
</div>
<div id="linear-regression" class="section level1">
<h1><span class="header-section-number">2</span> Linear regression</h1>
<ul>
<li>Consider a vector of predictors <span class="math inline">\(\mathbf{x}_i=(x_1,\ldots,x_{p-1})\)</span> and</li>
<li>a real-valued response <span class="math inline">\(Y_i\)</span></li>
<li>with <span class="math inline">\(i = 1, \ldots, n\)</span></li>
<li>then the linear regression model can be written as <span class="math display">\[
Y_i=f(\mathbf{x}) +\epsilon=\beta_0+\sum\limits_{j=1}^{p-1} x_{ij}\beta + \epsilon_i
\]</span> with i.i.d. <span class="math inline">\(\epsilon_i\sim N(0,\sigma^2)\)</span></li>
</ul>
<hr />
<ul>
<li><span class="math inline">\(n\)</span> observations <span class="math inline">\((\mathbf{x}_1,y_1) \ldots (\mathbf{x}_n,y_n)\)</span></li>
<li>Regression in matrix notation <span class="math display">\[\mathbf{Y}=\mathbf{X\beta} + \boldsymbol{\epsilon}\]</span> with <span class="math inline">\(\mathbf{Y}=\left[\begin{array}{c}y_1\\ \vdots\\y_n\end{array}\right]\)</span>, <span class="math inline">\(\mathbf{X}=\left[\begin{array}{cccc} 1&amp;x_{11}&amp;\ldots&amp;x_{1p-1}\\ \vdots&amp;\vdots&amp;&amp;\vdots\\ 1&amp;x_{n1}&amp;\ldots&amp;x_{np-1} \end{array}\right]\)</span>, <span class="math inline">\(\boldsymbol{\beta}=\left[\begin{array}{c}\beta_0\\ \vdots\\ \beta_{p-1}\end{array}\right]\)</span> and <span class="math inline">\(\boldsymbol{\epsilon}=\left[\begin{array}{c} \epsilon_1 \\ \vdots \\ \epsilon_n\end{array}\right]\)</span></li>
</ul>
<hr />
<div id="least-squares-ls" class="section level2">
<h2><span class="header-section-number">2.1</span> Least Squares (LS)</h2>
<ul>
<li><p>Minimize the residual sum of squares <span class="math display">\[\begin{eqnarray*}
RSS(\boldsymbol{\beta})&amp;=&amp;\sum\limits_{i=1}^n e^2_i\\
&amp;=&amp;\sum\limits_{i=1}^n \left(y_i-\beta_0-\sum\limits_{j=1}^p x_{ij}\beta_j\right)^2
\end{eqnarray*}\]</span></p></li>
<li><p>or in matrix notation <span class="math display">\[\begin{eqnarray*}
RSS(\boldsymbol{\beta})&amp;=&amp;(\mathbf{Y}-\mathbf{X\beta})^T(\mathbf{Y}-\mathbf{X\beta})\\
&amp;=&amp;\Vert \mathbf{Y}-\mathbf{X\beta}\Vert^2
\end{eqnarray*}\]</span> with the <span class="math inline">\(L_2\)</span>-norm of a <span class="math inline">\(p\)</span>-dim. vector <span class="math inline">\(v\)</span> <span class="math inline">\(\Vert \mathbf{v} \Vert=\sqrt{v_1^2+\ldots+v_p^2}\)</span></p></li>
<li><p><span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(\hat{\boldsymbol{\beta}}=\text{argmin}_\beta \Vert \mathbf{Y}-\mathbf{X\beta}\Vert^2\)</span>}</p></li>
</ul>
<hr />
<div id="minimize-rss" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Minimize RSS</h3>
<p><span class="math display">\[
\begin{array}{ccc}
\frac{\partial RSS}{\partial \boldsymbol{\beta}}&amp;=&amp;\mathbf{0}\\\\
\frac{(\mathbf{Y}-\mathbf{X\beta})^T(\mathbf{Y}-\mathbf{X\beta})}{\partial \boldsymbol{\beta}}&amp;=&amp;\mathbf{0}\\\\
-2\mathbf{X}^T(\mathbf{Y}-\mathbf{X\beta})&amp;=&amp;\mathbf{0}\\\\
\mathbf{X}^T\mathbf{X\beta}&amp;=&amp;\mathbf{X}^T\mathbf{Y}\\\\
\hat{\boldsymbol{\beta}}&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}
\end{array}
\]</span></p>
<hr />
<div id="heart-example" class="section level4">
<h4><span class="header-section-number">2.1.1.1</span> Heart example</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>y &lt;-<span class="st"> </span><span class="kw">assay</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])[<span class="dv">2</span>,]</span>
<span id="cb2-2"><a href="#cb2-2"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>location<span class="op">*</span>tissue <span class="op">+</span><span class="st"> </span>patient, <span class="dt">data =</span> <span class="kw">colData</span>(pe), <span class="dt">x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">head</span>(fit<span class="op">$</span>x,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>##               (Intercept) locationR tissueV patient4 patient8 locationR:tissueV
## Intensity.LA3           1         0       0        0        0                 0
## Intensity.LA4           1         0       0        1        0                 0
## Intensity.LA8           1         0       0        0        1                 0
## Intensity.LV3           1         0       1        0        0                 0</code></pre>
<p>The model matrix can also be obtained without fitting the model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>location <span class="op">*</span><span class="st"> </span>tissue <span class="op">+</span><span class="st"> </span>patient, <span class="kw">colData</span>(pe))</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">head</span>(X,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>##               (Intercept) locationR tissueV patient4 patient8 locationR:tissueV
## Intensity.LA3           1         0       0        0        0                 0
## Intensity.LA4           1         0       0        1        0                 0
## Intensity.LA8           1         0       0        0        1                 0
## Intensity.LV3           1         0       1        0        0                 0</code></pre>
<p>Least squares:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>betas &lt;-<span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X)<span class="op">%*%</span>X) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(X) <span class="op">%*%</span><span class="st"> </span>y</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">cbind</span>(fit<span class="op">$</span>coef, betas)</span></code></pre></div>
<pre><code>##                          [,1]        [,2]
## (Intercept)       26.57559360 26.57559360
## locationR          0.20636497  0.20636497
## tissueV            0.12756675  0.12756675
## patient4           0.30592435  0.30592435
## patient8          -0.33432636 -0.33432636
## locationR:tissueV -0.04130843 -0.04130843</code></pre>
<hr />
</div>
</div>
<div id="variance-estimator" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Variance Estimator?</h3>
<p><span class="math display">\[
\begin{array}{ccl}
\hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}
&amp;=&amp;\text{var}\left[(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\right]\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\text{var}\left[\mathbf{Y}\right]\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T(\mathbf{I}\sigma^2)\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}
\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{I}\quad\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2\\\\
%\hat{\boldmath{\Sigma}}_{\hat{\boldsymbol{\beta}}}&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\var\left[\mathbf{Y}\right](\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2
\end{array}
\]</span></p>
<hr />
<div id="heart-example-1" class="section level4">
<h4><span class="header-section-number">2.1.2.1</span> heart example</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">summary</span>(fit)<span class="op">$</span>cov.unscaled <span class="op">*</span><span class="st"> </span><span class="kw">sigma</span>(fit)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>##                   (Intercept)     locationR       tissueV      patient4
## (Intercept)         0.3938774 -2.625849e-01 -2.625849e-01 -1.969387e-01
## locationR          -0.2625849  5.251699e-01  2.625849e-01  1.145024e-16
## tissueV            -0.2625849  2.625849e-01  5.251699e-01  7.663178e-17
## patient4           -0.1969387  1.145024e-16  7.663178e-17  3.938774e-01
## patient8           -0.1969387  1.868024e-16  1.489318e-16  1.969387e-01
## locationR:tissueV   0.2625849 -5.251699e-01 -5.251699e-01 -5.227534e-17
##                        patient8 locationR:tissueV
## (Intercept)       -1.969387e-01      2.625849e-01
## locationR          1.868024e-16     -5.251699e-01
## tissueV            1.489318e-16     -5.251699e-01
## patient4           1.969387e-01     -5.227534e-17
## patient8           3.938774e-01     -2.473696e-16
## locationR:tissueV -2.473696e-16      1.050340e+00</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(X)</span>
<span id="cb10-2"><a href="#cb10-2"></a>p &lt;-<span class="st"> </span><span class="kw">ncol</span>(X)</span>
<span id="cb10-3"><a href="#cb10-3"></a>mse &lt;-<span class="st"> </span><span class="kw">sum</span>((y<span class="op">-</span>X<span class="op">%*%</span>betas)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(n<span class="op">-</span>p)</span>
<span id="cb10-4"><a href="#cb10-4"></a>SigmaBeta &lt;-<span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X)<span class="op">%*%</span>X) <span class="op">*</span><span class="st"> </span>mse   </span>
<span id="cb10-5"><a href="#cb10-5"></a>SigmaBeta</span></code></pre></div>
<pre><code>##                   (Intercept)  locationR    tissueV   patient4   patient8
## (Intercept)         0.3938774 -0.2625849 -0.2625849 -0.1969387 -0.1969387
## locationR          -0.2625849  0.5251699  0.2625849  0.0000000  0.0000000
## tissueV            -0.2625849  0.2625849  0.5251699  0.0000000  0.0000000
## patient4           -0.1969387  0.0000000  0.0000000  0.3938774  0.1969387
## patient8           -0.1969387  0.0000000  0.0000000  0.1969387  0.3938774
## locationR:tissueV   0.2625849 -0.5251699 -0.5251699  0.0000000  0.0000000
##                   locationR:tissueV
## (Intercept)               0.2625849
## locationR                -0.5251699
## tissueV                  -0.5251699
## patient4                  0.0000000
## patient8                  0.0000000
## locationR:tissueV         1.0503398</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">range</span>(SigmaBeta <span class="op">-</span><span class="st"> </span><span class="kw">summary</span>(fit)<span class="op">$</span>cov.unscaled <span class="op">*</span><span class="st"> </span><span class="kw">sigma</span>(fit)<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -4.773959e-15  9.103829e-15</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">data.frame</span>(<span class="kw">summary</span>(fit)<span class="op">$</span>coef[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">betas =</span> betas, <span class="dt">seBetas =</span> <span class="kw">diag</span>(SigmaBeta)<span class="op">^</span>.<span class="dv">5</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Estimate"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Std..Error"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["betas"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["seBetas"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"26.57559360","2":"0.6275965","3":"26.57559360","4":"0.6275965","_rn_":"(Intercept)"},{"1":"0.20636497","2":"0.7246861","3":"0.20636497","4":"0.7246861","_rn_":"locationR"},{"1":"0.12756675","2":"0.7246861","3":"0.12756675","4":"0.7246861","_rn_":"tissueV"},{"1":"0.30592435","2":"0.6275965","3":"0.30592435","4":"0.6275965","_rn_":"patient4"},{"1":"-0.33432636","2":"0.6275965","3":"-0.33432636","4":"0.6275965","_rn_":"patient8"},{"1":"-0.04130843","2":"1.0248609","3":"-0.04130843","4":"1.0248609","_rn_":"locationR:tissueV"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="contrasts" class="section level2">
<h2><span class="header-section-number">2.2</span> Contrasts</h2>
<p>When we assess a contrast we assess a linear combination of model parameters:</p>
<p><span class="math display">\[ H_0: \mathbf{L^T\beta} = 0 \text{ vs } H_1: \mathbf{L^T\beta} \neq 0 \]</span></p>
<p>Estimator of Contrast?</p>
<p><span class="math display">\[\mathbf{L}^T\hat{\boldsymbol{\beta}}\]</span></p>
<p>Variance?</p>
<p><span class="math display">\[
\boldsymbol{\Sigma}_{\mathbf{L}\hat{\boldsymbol{\beta}}}=\mathbf{L}^T\boldsymbol{\Sigma}_{\hat{\boldsymbol{\beta}}}\mathbf{L}
\]</span></p>
<hr />
<div id="heart-example-2" class="section level3">
<h3><span class="header-section-number">2.2.1</span> heart example</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>L &lt;-<span class="st"> </span><span class="kw">makeContrast</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="kw">c</span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="st">&quot;tissueV = 0&quot;</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="st">&quot;tissueV + locationR:tissueV = 0&quot;</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="st">&quot;tissueV + 0.5*locationR:tissueV = 0&quot;</span>,<span class="st">&quot;locationR:tissueV = 0&quot;</span>),</span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="dt">parameterNames =</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">2</span>]] <span class="op">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">    </span>getCoef <span class="op">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="st">    </span>names</span>
<span id="cb15-10"><a href="#cb15-10"></a>  )</span>
<span id="cb15-11"><a href="#cb15-11"></a>L</span></code></pre></div>
<pre><code>##                   tissueV tissueV + locationR:tissueV
## (Intercept)             0                           0
## locationR               0                           0
## tissueV                 1                           1
## patient4                0                           0
## patient8                0                           0
## locationR:tissueV       0                           1
##                   tissueV + 0.5 * locationR:tissueV locationR:tissueV
## (Intercept)                                     0.0                 0
## locationR                                       0.0                 0
## tissueV                                         1.0                 0
## patient4                                        0.0                 0
## patient8                                        0.0                 0
## locationR:tissueV                               0.5                 1</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>contrasts &lt;-<span class="st"> </span><span class="kw">t</span>(L) <span class="op">%*%</span><span class="st"> </span>betas</span>
<span id="cb17-2"><a href="#cb17-2"></a>SigmaContrasts &lt;-<span class="st"> </span><span class="kw">t</span>(L) <span class="op">%*%</span><span class="st"> </span>SigmaBeta <span class="op">%*%</span><span class="st"> </span>L</span>
<span id="cb17-3"><a href="#cb17-3"></a>seContrasts &lt;-<span class="st"> </span>SigmaContrasts <span class="op">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">  </span>diag <span class="op">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">  </span>sqrt</span></code></pre></div>
<p>Comparison with lm and glht results</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">library</span>(multcomp)</span></code></pre></div>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## Loading required package: TH.data</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre><code>## 
## Attaching package: &#39;TH.data&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     geyser</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>fitGlht &lt;-<span class="st"> </span><span class="kw">glht</span>(fit, <span class="dt">linfct =</span> <span class="kw">t</span>(L))</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">summary</span>(fitGlht, <span class="dt">test =</span> <span class="kw">adjusted</span>(<span class="st">&quot;none&quot;</span>))</span></code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = y ~ location * tissue + patient, data = colData(pe), 
##     x = TRUE)
## 
## Linear Hypotheses:
##                                        Estimate Std. Error t value Pr(&gt;|t|)
## tissueV == 0                            0.12757    0.72469   0.176    0.866
## tissueV + locationR:tissueV == 0        0.08626    0.72469   0.119    0.909
## tissueV + 0.5 * locationR:tissueV == 0  0.10691    0.51243   0.209    0.842
## locationR:tissueV == 0                 -0.04131    1.02486  -0.040    0.969
## (Adjusted p values reported -- none method)</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">data.frame</span>(contrasts, seContrasts)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrasts"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["seContrasts"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.12756675","2":"0.7246861","_rn_":"tissueV"},{"1":"0.08625832","2":"0.7246861","_rn_":"tissueV + locationR:tissueV"},{"1":"0.10691253","2":"0.5124304","_rn_":"tissueV + 0.5 * locationR:tissueV"},{"1":"-0.04130843","2":"1.0248609","_rn_":"locationR:tissueV"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ul>
<li><p>Note, that the power for assessing <span class="math inline">\(\log_2\)</span> FC between ventriculum and atrium left and right is the same. Indeed, the standard errors are equal for both effects.</p></li>
<li><p>Note, that the power for assessing <span class="math inline">\(\log_2\)</span> FC between ventriculum and atrium over both heart regions is higher than when assessing the effect left or right.</p>
<ul>
<li>Indeed, the standard error is a factor <span class="math inline">\(\sqrt{2}\)</span> smaller for the former effect</li>
<li>We intuitively can explain this because we can use all samples (double the number of samples) to assess the average effect.</li>
<li>Hence the variance is a factor two smaller, and the se with a factor <span class="math inline">\(\sqrt{2}\)</span></li>
</ul></li>
<li><p>Note, that we have the lowest power to pick up an interaction effect. Indeed, the se is a factor <span class="math inline">\(\sqrt{2}\)</span> larger than for the ventriculum - atrium effect left or right and a factor 2 larger than for the average effect between ventriculum and atrium.</p></li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>seContrasts <span class="op">/</span><span class="st"> </span>seContrasts[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##                           tissueV       tissueV + locationR:tissueV 
##                         1.0000000                         1.0000000 
## tissueV + 0.5 * locationR:tissueV                 locationR:tissueV 
##                         0.7071068                         1.4142136</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">sqrt</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1.414214</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.7071068</code></pre>
</div>
<div id="t-tests" class="section level3">
<h3><span class="header-section-number">2.2.2</span> t-tests</h3>
<ul>
<li><p>When the assumptions of the linear model hold <span class="math display">\[
\hat{\boldsymbol{\beta}} \sim MVN\left[\boldsymbol{\beta},\left(\mathbf{X}^T\mathbf{X}\right)^{-1}\sigma^2\right]
\]</span></p></li>
<li><p>Hence, <span class="math display">\[
\mathbf{L}^T\hat{\boldsymbol{\beta}} \sim MVN\left[\mathbf{L}^T\boldsymbol{\beta},\mathbf{L}^T\left[\left(\mathbf{X}^T\mathbf{X}\right)^{-1}\sigma^2\right]\mathbf{L}\right]
\]</span></p></li>
<li><p>We estimate <span class="math inline">\(\sigma^2\)</span> by MSE <span class="math display">\[\hat{\sigma}^2=\frac{\mathbf{e}^T\mathbf{e}}{n-p} \rightarrow \hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}=\left(\mathbf{X}^T\mathbf{X}\right)^{-1}\hat\sigma^2\]</span></p></li>
<li><p>When we test one contrast at the time (e.g. the <span class="math inline">\(k^\text{th}\)</span> contrast) the statistic reduces to</p></li>
</ul>
<p><span class="math display">\[T=\frac{\mathbf{L}_k^T\hat{\boldsymbol{\beta}}}{\sqrt{\left(\mathbf{L}^T_k\hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}\mathbf{L}_k\right)}} \underset{H_0}{\sim} t_{n-p}\]</span> follows a t distribution with n-p degrees of freedom under <span class="math inline">\(H_0: \mathbf{L}^T_k\hat{\boldsymbol{\beta}}=0\)</span></p>
<hr />
<div id="heart-example-3" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> heart example</h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>tContrasts &lt;-<span class="st"> </span>contrasts<span class="op">/</span>seContrasts</span>
<span id="cb36-2"><a href="#cb36-2"></a>pContrasts &lt;-<span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tContrasts),</span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="dt">df =</span> n <span class="op">-</span><span class="st"> </span>p,</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<p>Comparison with lm and glht results</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">summary</span>(fitGlht, <span class="dt">test =</span> <span class="kw">adjusted</span>(<span class="st">&quot;none&quot;</span>))</span></code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = y ~ location * tissue + patient, data = colData(pe), 
##     x = TRUE)
## 
## Linear Hypotheses:
##                                        Estimate Std. Error t value Pr(&gt;|t|)
## tissueV == 0                            0.12757    0.72469   0.176    0.866
## tissueV + locationR:tissueV == 0        0.08626    0.72469   0.119    0.909
## tissueV + 0.5 * locationR:tissueV == 0  0.10691    0.51243   0.209    0.842
## locationR:tissueV == 0                 -0.04131    1.02486  -0.040    0.969
## (Adjusted p values reported -- none method)</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">data.frame</span>(contrasts, seContrasts, tContrasts, pContrasts)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["contrasts"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["seContrasts"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["tContrasts"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["pContrasts"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.12756675","2":"0.7246861","3":"0.17603036","4":"0.8660611","_rn_":"tissueV"},{"1":"0.08625832","2":"0.7246861","3":"0.11902853","4":"0.9091380","_rn_":"tissueV + locationR:tissueV"},{"1":"0.10691253","2":"0.5124304","3":"0.20863814","4":"0.8416333","_rn_":"tissueV + 0.5 * locationR:tissueV"},{"1":"-0.04130843","2":"1.0248609","3":"-0.04030638","4":"0.9691566","_rn_":"locationR:tissueV"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<hr />
</div>
</div>
<div id="omnibus-test" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Omnibus test</h3>
<ul>
<li><p>We can also assess all contrasts simultaneously with the omnibus null hypothesis: <span class="math display">\[H_0: \mathbf{L}^T\hat{\boldsymbol{\beta}}=\mathbf{0}\]</span></p></li>
<li><p>Statistic <span class="math display">\[\mathbf{F}=\frac{\hat{\boldsymbol{\beta}}^T\mathbf{L}\left(\mathbf{L}^T\hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}\mathbf{L}\right)^{-1}\mathbf{L}^T\hat{\boldsymbol{\beta}}}{n_c} \underset{H_0}{\sim} F_{n_c,n-p}\]</span> follows an F distribution with <span class="math inline">\(n_c\)</span> and n-p degrees of freedom under the omnibus null hypothesis.</p></li>
<li><p>Note, that <span class="math inline">\(n_c\)</span> equals the number of contrasts, and</p></li>
<li><p><span class="math inline">\(\mathbf{L}\)</span> is assumed to be full rank</p></li>
</ul>
<hr />
<p>If the matrix  is not full rank, but has rank <span class="math inline">\(r &lt; n_c\)</span></p>
<ul>
<li><p>i.e. some of the contrasts can be written as linear combinations of other contrasts,</p></li>
<li><p>the inverse of the variance covariance matrix of the contrasts does not exist</p></li>
<li><p>we can then decompose L in <span class="math inline">\(r\)</span> orthogonal contrasts <span class="math inline">\(\mathbf{Q}\)</span> with <span class="math display">\[\mathbf{Q}_j^T \mathbf{Q}_k^T = \delta_{jk},\]</span></p></li>
<li><p><span class="math inline">\(j,k \in 1,\ldots,r\)</span>,</p></li>
<li><p><span class="math inline">\(\delta{jk} = 0\)</span> and if <span class="math inline">\(j\neq k\)</span> <span class="math inline">\(\delta{jk} = 1\)</span></p></li>
<li><p>Decomposition can be done using the QR decomposition</p></li>
<li><p>We can than assess the omnibus null hypothesis using the statistic: <span class="math display">\[\mathbf{F}=\frac{\hat{\boldsymbol{\beta}}^T\mathbf{Q}_r\left(\mathbf{Q}^T_r\hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}\mathbf{Q}_r\right)^{-1}\mathbf{Q}^T_r\hat{\boldsymbol{\beta}}}{r} \underset{H_0}{\sim} F_{r,n-p}\]</span></p></li>
</ul>
<hr />
<div id="heart-example-4" class="section level4">
<h4><span class="header-section-number">2.2.3.1</span> Heart example</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">try</span>(<span class="kw">solve</span>(SigmaContrasts))</span></code></pre></div>
<pre><code>## Error in solve.default(SigmaContrasts) : 
##   Lapack routine dgesv: system is exactly singular: U[3,3] = 0</code></pre>
<ul>
<li>We cannot invert the variance matrix of the contrasts!</li>
<li>Indeed, the contrasts are linear combinations of two parameters and the contrast matrix <span class="math inline">\(\mathbf{L}\)</span> will thus have rank 2</li>
<li>We calculate orthogonal contrasts:</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>qrL &lt;-<span class="st"> </span><span class="kw">qr</span>(L)</span>
<span id="cb42-2"><a href="#cb42-2"></a>r &lt;-<span class="st"> </span>qrL<span class="op">$</span>rank</span>
<span id="cb42-3"><a href="#cb42-3"></a>r</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>Q &lt;-<span class="st"> </span><span class="kw">qr.Q</span>(qrL)[,<span class="dv">1</span><span class="op">:</span>r]</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">rownames</span>(Q) &lt;-<span class="st"> </span><span class="kw">rownames</span>(L)</span>
<span id="cb44-3"><a href="#cb44-3"></a>Q</span></code></pre></div>
<pre><code>##                   [,1] [,2]
## (Intercept)          0    0
## locationR            0    0
## tissueV             -1    0
## patient4             0    0
## patient8             0    0
## locationR:tissueV    0   -1</code></pre>
<ul>
<li>Q is orthonormal</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">t</span>(Q)<span class="op">%*%</span>Q</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1</code></pre>
<p>Exploring Q shows that assessing the omnibus hypothesis is thus equivalent to assessing if the null hypothesis that <span class="math display">\[H_0: \beta_\text{tissue} = \beta_\text{tissue:location} = 0\]</span></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>est &lt;-<span class="st"> </span><span class="kw">t</span>(Q) <span class="op">%*%</span><span class="st"> </span>betas</span>
<span id="cb48-2"><a href="#cb48-2"></a>SigmaEst &lt;-<span class="st"> </span><span class="kw">t</span>(Q) <span class="op">%*%</span><span class="st"> </span>SigmaBeta <span class="op">%*%</span><span class="st"> </span>Q</span>
<span id="cb48-3"><a href="#cb48-3"></a>Fstat &lt;-<span class="st"> </span><span class="kw">t</span>(est) <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(SigmaEst) <span class="op">%*%</span><span class="st"> </span>est <span class="op">/</span><span class="st"> </span>r</span>
<span id="cb48-4"><a href="#cb48-4"></a>pOmnibus &lt;-<span class="st"> </span><span class="kw">pf</span>(Fstat, r, p, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<ul>
<li>Comparison with lm results</li>
<li>We can assess the omnibus hypothesis also by comparing two models
<ul>
<li>model with location, tissue, location - tissue interaction and patient effect</li>
<li>null model: model with location and patient effect</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>fit0 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>location <span class="op">+</span><span class="st"> </span>patient, <span class="kw">colData</span>(pe))</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="kw">anova</span>(fit, fit0)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Res.Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"6","2":"4.726529","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"1"},{"1":"8","2":"4.762100","3":"-2","4":"-0.03557066","5":"0.02257724","6":"0.9777584","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>Fstat</span></code></pre></div>
<pre><code>##            [,1]
## [1,] 0.02257724</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>pOmnibus</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 0.9777584</code></pre>
</div>
</div>
</div>
</div>
<div id="robust-regression" class="section level1">
<h1><span class="header-section-number">3</span> Robust regression</h1>
<ul>
<li><p>With msqrob2 we perform robust regression to estimate the model parameters of the regression model</p></li>
<li><p>No normality assumption needed</p></li>
<li><p>Robust fit minimises the maximal bias of the estimators</p></li>
<li><p>CI and statistical tests are based on asymptotic theory</p></li>
<li><p>If <span class="math inline">\(\epsilon\)</span> is normal, the M-estimators have a high efficiency!</p></li>
<li><p>ordinary least squares (OLS): minimize loss function <span class="math display">\[\sum\limits_{i=1}^n (y_i-\mathbf{x}_i^T\boldsymbol{\beta})^2\]</span></p></li>
<li><p>M-estimation: minimize loss function <span class="math display">\[\sum\limits_{i=1}^n  \rho\left(y_i-\mathbf{x}_i^T\boldsymbol{\beta}\right)\]</span> with</p>
<ul>
<li><span class="math inline">\(\rho\)</span> is symmetric, i.e. <span class="math inline">\(\rho(z)=\rho(-z)\)</span></li>
<li><span class="math inline">\(\rho\)</span> has a minimum at <span class="math inline">\(\rho(0)=0\)</span>, is positive for all <span class="math inline">\(z\neq 0\)</span></li>
<li><span class="math inline">\(\rho(z)\)</span> increases as <span class="math inline">\(\vert z\vert\)</span> increases</li>
</ul></li>
</ul>
<hr />
<p>The estimator <span class="math inline">\(\hat{\mu}\)</span> is also the solution to the equation <span class="math display">\[
   \sum_{i=1}^n \Psi(y_i - \mathbf{x}_i\boldsymbol{\beta}) =0,
 \]</span> where <span class="math inline">\(\Psi\)</span> is the derivative of <span class="math inline">\(\rho\)</span>. For <span class="math inline">\(\hat{\beta}\)</span> possessing the robustness property, <span class="math inline">\(\Psi\)</span> should be bounded.</p>
<hr />
<p>Example: least squares</p>
<ul>
<li><p><span class="math inline">\(\rho(z) = z^2\)</span>, and thus <span class="math inline">\(\Psi(z)=2z\)</span> (unbounded!). Not robust!</p></li>
<li><p><span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> is the solution of <span class="math display">\[
 \sum_{i=1}^n 2 \mathbf{x}_i (y_i - \mathbf{x}_i^T\boldsymbol{\beta}) = 0 \text{ or } \hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}\mathbf{y}
 \]</span> with <span class="math inline">\(\mathbf{X}=[\mathbf{x}_1 \ldots \mathbf{x}_G]^T\)</span></p></li>
</ul>
<hr />
<p>When a location and a scale parameter, say <span class="math inline">\(\sigma\)</span>, have to be estimated simultaneously, we write <span class="math display">\[
   (\hat{\boldsymbol{\beta}},\hat{\sigma}) = \text{ArgMin}_{\boldsymbol{\beta},\sigma} \sum_{i=1}^n \rho\left(\frac{y_i - \mathbf{x}_i^T\boldsymbol{\beta}}{\sigma}\right)
   \text{ and } \sum_{i=1}^n \Psi\left(\frac{y_i - \mathbf{x}_i^T\boldsymbol{\beta}}{\sigma}\right) =0.
 \]</span></p>
<p>Define <span class="math inline">\(u_i = \frac{y_i - \mathbf{x}_i^T\boldsymbol{\beta}}{\sigma}\)</span>. The last estimation equation is equivalent to <span class="math display">\[
   \sum_{i=1}^n w(u_i) u_i = 0 ,
 \]</span> with weight function <span class="math inline">\(w(u)=\Psi(u)/u\)</span>. This is the typical form that appears when solving the <em>iteratively reweighted least squares problem</em>, <span class="math display">\[
   (\hat{\boldsymbol{\beta}},\hat{\sigma}) = \text{ArgMin}_{\mu,\sigma} \sum_{i=1}^n w(u_i^{(k-1)}) \left(u_i^{(k)}\right)^2 ,
 \]</span> where <span class="math inline">\(k\)</span> represents the iteration number.</p>
<hr />
<div id="some-examples-of-robust-functions" class="section level2">
<h2><span class="header-section-number">3.1</span> Some Examples of Robust Functions</h2>
<p><img src="https://raw.githubusercontent.com/statOmics/SGA2020/gh-pages/assets/TableRobust.PNG" /></p>
<p>PhD thesis Bolstad 2004</p>
<hr />
</div>
<div id="the-rho-functions" class="section level2">
<h2><span class="header-section-number">3.2</span> The <span class="math inline">\(\rho\)</span> functions</h2>
<p><img src="https://raw.githubusercontent.com/statOmics/SGA2020/gh-pages/assets/RhoRobust.PNG" /></p>
<p>PhD thesis Bolstad 2004</p>
<hr />
<div id="common-psi-functions" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Common <span class="math inline">\(\Psi\)</span>-Functions</h3>
<p><img src="https://raw.githubusercontent.com/statOmics/SGA2020/gh-pages/assets/robustRegressionPsi.png" /></p>
<p>PhD thesis Bolstad 2004</p>
<hr />
</div>
<div id="corresponding-weight-functions" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Corresponding Weight Functions</h3>
<p><img src="https://raw.githubusercontent.com/statOmics/SGA2020/gh-pages/assets/robustRegressionWeights.png" /></p>
<p>PhD thesis Bolstad 2004</p>
<hr />
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb54-2"><a href="#cb54-2"></a>rfit &lt;-<span class="st"> </span><span class="kw">rlm</span>(y <span class="op">~</span><span class="st"> </span>location <span class="op">*</span><span class="st"> </span>tissue <span class="op">+</span><span class="st"> </span>patient, <span class="kw">colData</span>(pe), <span class="dt">maxit=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning in rlm.default(x, y, weights, method = method, wt.method = wt.method, :
## &#39;rlm&#39; failed to converge in 1 steps</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">qplot</span>(fit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb56-2"><a href="#cb56-2"></a>  rfit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="dt">xlab=</span><span class="st">&quot;fit&quot;</span>,</span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="dt">ylab=</span><span class="st">&quot;robust fit&quot;</span>) <span class="op">+</span></span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="st">  </span><span class="kw">geom_abline</span>() <span class="op">+</span></span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">range</span>(<span class="kw">c</span>(fit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>],rfit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>]))) <span class="op">+</span></span>
<span id="cb56-7"><a href="#cb56-7"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">range</span>(<span class="kw">c</span>(fit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>],rfit<span class="op">$</span>coefficient[<span class="op">-</span><span class="dv">1</span>])))</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<hr />
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>rfit<span class="op">$</span>w</span></code></pre></div>
<pre><code>##  [1] 0.9516397 1.0000000 0.6628477 1.0000000 1.0000000 1.0000000 1.0000000
##  [8] 1.0000000 1.0000000 0.4805187 1.0000000 0.4344049</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="kw">plot</span>(</span>
<span id="cb59-2"><a href="#cb59-2"></a>  rfit<span class="op">$</span>fitted,</span>
<span id="cb59-3"><a href="#cb59-3"></a>  rfit<span class="op">$</span>res,</span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="dt">cex=</span>rfit<span class="op">$</span>w,</span>
<span id="cb59-5"><a href="#cb59-5"></a>  <span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">col=</span><span class="dv">2</span>,</span>
<span id="cb59-6"><a href="#cb59-6"></a>  <span class="dt">cex.lab=</span><span class="fl">1.5</span>,</span>
<span id="cb59-7"><a href="#cb59-7"></a>  <span class="dt">cex.axis=</span><span class="fl">1.5</span>,</span>
<span id="cb59-8"><a href="#cb59-8"></a>  <span class="dt">ylab=</span><span class="st">&quot;residuals&quot;</span>,</span>
<span id="cb59-9"><a href="#cb59-9"></a>  <span class="dt">xlab=</span><span class="st">&quot;fit&quot;</span>)</span>
<span id="cb59-10"><a href="#cb59-10"></a><span class="kw">points</span>(rfit<span class="op">$</span>fitted, rfit<span class="op">$</span>res , <span class="dt">cex=</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<hr />
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ location * tissue + patient, data = colData(pe), 
##     x = TRUE)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.29698 -0.32767  0.04041  0.24905  1.17251 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       26.57559    0.62760  42.345 1.16e-08 ***
## locationR          0.20636    0.72469   0.285    0.785    
## tissueV            0.12757    0.72469   0.176    0.866    
## patient4           0.30592    0.62760   0.487    0.643    
## patient8          -0.33433    0.62760  -0.533    0.613    
## locationR:tissueV -0.04131    1.02486  -0.040    0.969    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8876 on 6 degrees of freedom
## Multiple R-squared:  0.1687, Adjusted R-squared:  -0.524 
## F-statistic: 0.2436 on 5 and 6 DF,  p-value: 0.9286</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">summary</span>(rfit)</span></code></pre></div>
<pre><code>## 
## Call: rlm(formula = y ~ location * tissue + patient, data = colData(pe), 
##     maxit = 1)
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.51703 -0.22326  0.05909  0.16009  1.26070 
## 
## Coefficients:
##                   Value   Std. Error t value
## (Intercept)       26.3378  0.5391    48.8585
## locationR          0.2883  0.6225     0.4631
## tissueV            0.2095  0.6225     0.3365
## patient4           0.4654  0.5391     0.8633
## patient8          -0.0261  0.5391    -0.0484
## locationR:tissueV -0.0555  0.8803    -0.0630
## 
## Residual standard error: 0.4189 on 6 degrees of freedom</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span>getCoef</span></code></pre></div>
<pre><code>##       (Intercept)         locationR           tissueV          patient4 
##       26.33779939        0.28826213        0.20946392        0.46536955 
##          patient8 locationR:tissueV 
##       -0.02608046       -0.05550111</code></pre>
<hr />
</div>
</div>
<div id="understanding-implementation-of-robust-regression" class="section level2">
<h2><span class="header-section-number">3.3</span> Understanding implementation of robust regression</h2>
<div id="simulate-20-observations-from-a-linear-model-with-errors-that-follow-a-normal-distribution" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Simulate 20 observations from a linear model with errors that follow a normal distribution</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>set.seed &lt;-<span class="st"> </span><span class="dv">112358</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>nobs &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>sdy &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>xsim &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> nobs)</span>
<span id="cb66-5"><a href="#cb66-5"></a>ysim &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">5</span><span class="op">*</span>xsim <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nobs, <span class="dt">sd =</span> sdy)</span></code></pre></div>
</div>
<div id="add-outlier-at-high-leverage-point" class="section level3">
<h3><span class="header-section-number">3.3.2</span> add outlier at high leverage point</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>ysim[nobs] &lt;-<span class="st"> </span><span class="dv">7</span></span></code></pre></div>
</div>
<div id="fit-linear-model" class="section level3">
<h3><span class="header-section-number">3.3.3</span> fit linear model</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>ols &lt;-<span class="st"> </span><span class="kw">lm</span>(ysim <span class="op">~</span><span class="st"> </span>xsim)</span></code></pre></div>
</div>
<div id="fit-robust-linear-model" class="section level3">
<h3><span class="header-section-number">3.3.4</span> fit robust linear model</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">library</span>(MASS)</span>
<span id="cb69-2"><a href="#cb69-2"></a>mEst &lt;-<span class="st"> </span><span class="kw">rlm</span>(ysim <span class="op">~</span><span class="st"> </span>xsim)</span></code></pre></div>
<div id="plot-results" class="section level4">
<h4><span class="header-section-number">3.3.4.1</span> plot results</h4>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="kw">plot</span>(xsim, ysim)</span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="kw">abline</span>(ols, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="kw">abline</span>(mEst, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb70-5"><a href="#cb70-5"></a>  <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;M-estimation&quot;</span>),</span>
<span id="cb70-6"><a href="#cb70-6"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb70-7"><a href="#cb70-7"></a>  <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">round</span>(mEst<span class="op">$</span>w,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  [1] 1.000 0.924 1.000 1.000 1.000 1.000 0.712 1.000 0.579 1.000 1.000 0.766
## [13] 0.460 0.741 1.000 1.000 0.461 0.348 1.000 0.086</code></pre>
<p>The plot clearly shows that the outlier has a high impact on the slope estimate. This is because the outlier is at a high leverage point, i.e. far from the average covariate pattern.</p>
</div>
</div>
<div id="implement-it-yourself" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Implement it yourself</h3>
<div id="start-from-ols-fit" class="section level4">
<h4><span class="header-section-number">3.3.5.1</span> start from ols fit</h4>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>lmMod &lt;-<span class="st"> </span>ols</span></code></pre></div>
</div>
<div id="use-robust-variance-estimator-to-calculate-the-z" class="section level4">
<h4><span class="header-section-number">3.3.5.2</span> Use robust variance estimator to calculate the z</h4>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>res &lt;-<span class="st"> </span>lmMod<span class="op">$</span>res</span>
<span id="cb74-2"><a href="#cb74-2"></a>stdev &lt;-<span class="st"> </span><span class="kw">mad</span>(res)</span>
<span id="cb74-3"><a href="#cb74-3"></a>stdev</span></code></pre></div>
<pre><code>## [1] 0.9222977</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">median</span>(<span class="kw">abs</span>(res<span class="op">-</span><span class="kw">median</span>(res)))<span class="op">*</span><span class="fl">1.4826</span></span></code></pre></div>
<pre><code>## [1] 0.9222977</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>z &lt;-<span class="st"> </span>res<span class="op">/</span>stdev</span></code></pre></div>
</div>
<div id="calculate-weights-use-psi.huber-function" class="section level4">
<h4><span class="header-section-number">3.3.5.3</span> Calculate weights use psi.huber function</h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>w &lt;-<span class="st"> </span><span class="kw">psi.huber</span>(z)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="kw">plot</span>(xsim, ysim)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="kw">plot</span>(xsim, lmMod<span class="op">$</span>res, <span class="dt">cex =</span> w, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="kw">points</span>(xsim,lmMod<span class="op">$</span>res, <span class="dt">cex =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
</div>
<div id="perform-a-weighted-regression-use-lm-with-weightsw" class="section level4">
<h4><span class="header-section-number">3.3.5.4</span> Perform a weighted regression use lm with weights=w</h4>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>lmMod &lt;-<span class="st"> </span><span class="kw">lm</span>(ysim<span class="op">~</span>xsim, <span class="dt">weights =</span> w)</span></code></pre></div>
</div>
<div id="plot-results-1" class="section level4">
<h4><span class="header-section-number">3.3.5.5</span> Plot results</h4>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">plot</span>(xsim, ysim)</span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="kw">abline</span>(ols, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="kw">abline</span>(mEst, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="kw">abline</span>(lmMod, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb82-6"><a href="#cb82-6"></a>  <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>,<span class="st">&quot;M-estimation&quot;</span>,<span class="st">&quot;Our Impl&quot;</span>),</span>
<span id="cb82-7"><a href="#cb82-7"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb82-8"><a href="#cb82-8"></a>  <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="repeat-this-many-times" class="section level4">
<h4><span class="header-section-number">3.3.5.6</span> Repeat this many times</h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>lmMod &lt;-<span class="st"> </span>ols</span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb83-3"><a href="#cb83-3"></a>{</span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="co">######repeat this part several times until convergence</span></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="co">#use robust variance estimator to calculate the z</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>res &lt;-<span class="st"> </span>lmMod<span class="op">$</span>res</span>
<span id="cb83-7"><a href="#cb83-7"></a>stdev &lt;-<span class="st"> </span><span class="kw">mad</span>(res)</span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="kw">median</span>(<span class="kw">abs</span>(res<span class="op">-</span><span class="kw">median</span>(res)))<span class="op">*</span><span class="fl">1.4826</span></span>
<span id="cb83-9"><a href="#cb83-9"></a></span>
<span id="cb83-10"><a href="#cb83-10"></a>z &lt;-<span class="st"> </span>res<span class="op">/</span>stdev</span>
<span id="cb83-11"><a href="#cb83-11"></a></span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="co">#calculate weights</span></span>
<span id="cb83-13"><a href="#cb83-13"></a><span class="co">#use psi.huber function</span></span>
<span id="cb83-14"><a href="#cb83-14"></a>w &lt;-<span class="st"> </span><span class="kw">psi.huber</span>(z)</span>
<span id="cb83-15"><a href="#cb83-15"></a></span>
<span id="cb83-16"><a href="#cb83-16"></a><span class="co">#perform a weighted regression use lm with weights=w</span></span>
<span id="cb83-17"><a href="#cb83-17"></a>lmMod &lt;-<span class="st"> </span><span class="kw">lm</span>(ysim <span class="op">~</span><span class="st"> </span>xsim, <span class="dt">weights =</span> w)</span>
<span id="cb83-18"><a href="#cb83-18"></a></span>
<span id="cb83-19"><a href="#cb83-19"></a><span class="co">#plot results</span></span>
<span id="cb83-20"><a href="#cb83-20"></a><span class="kw">plot</span>(xsim,ysim)</span>
<span id="cb83-21"><a href="#cb83-21"></a><span class="kw">abline</span>(ols, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb83-22"><a href="#cb83-22"></a><span class="kw">abline</span>(mEst, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb83-23"><a href="#cb83-23"></a><span class="kw">abline</span>(lmMod, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb83-24"><a href="#cb83-24"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb83-25"><a href="#cb83-25"></a>  <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>,<span class="st">&quot;M-estimation&quot;</span>,<span class="st">&quot;Our Impl&quot;</span>),</span>
<span id="cb83-26"><a href="#cb83-26"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb83-27"><a href="#cb83-27"></a>  <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb83-28"><a href="#cb83-28"></a>  )</span>
<span id="cb83-29"><a href="#cb83-29"></a><span class="co">####################################</span></span>
<span id="cb83-30"><a href="#cb83-30"></a>}</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-32-1.png" width="672" /><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-32-2.png" width="672" /><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-32-3.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="empirical-bayesmoderated-t-test." class="section level1">
<h1><span class="header-section-number">4</span> Empirical Bayes/Moderated <span class="math inline">\(t\)</span>-test.</h1>
<p>A general class of moderated test statistics is given by</p>
<p><span class="math display">\[\tilde{T}_p = \frac{\mathbf{L}_k \hat{ \boldsymbol{\beta_p}}}{\mathbf{L}_k^T(\mathbf{X}^T\mathbf{WX})^{-1}\mathbf{L}_k^T \tilde{s}_p^2}\]</span></p>
<p>where <span class="math inline">\(\tilde{s}_p\)</span> is a moderated variance estimator.</p>
<p>Simple approach: set <span class="math inline">\(\tilde{s}_p=s_p + s_0\)</span>: simply add a small positive constant to the denominator of the t-statistic</p>
<p> theory provides formal framework for borrowing strength across genes or proteins, e.g. popular bioconductor package  <span class="math display">\[\tilde{s}_g=\sqrt{\frac{d_ps_p^2+d_0s_0^2}{d_g+d_0}},\]</span> and the moderated t-statistic is t-distributed with <span class="math inline">\(d_0+d_g\)</span> degrees of freedom under the null hypothesis <span class="math inline">\(H_0: \mathbf{L}\boldsymbol{\beta}=0\)</span>.</p>
<ul>
<li>Note, that the degrees of freedom increase by borrowing strength across proteins.</li>
</ul>
<hr />
<div id="intermezzo-bayesian-methods" class="section level2">
<h2><span class="header-section-number">4.1</span> Intermezzo: Bayesian Methods</h2>
<ul>
<li><p>Frequentists consider data as random and population parameters as fixed but unknown</p></li>
<li><p>In Bayesian viewpoint a person has prior beliefs about the population parameters and the uncertainty on this prior beliefs are represented by a probability distribution placed on this parameter.</p>
<ul>
<li>This distribution reflects the person’s subjective prior opinion about plausible values of the parameter.</li>
<li>And is referred to as the prior <span class="math inline">\(g(\boldsymbol{\theta})\)</span>.</li>
</ul></li>
<li><p>Bayesian thinking will update the prior information on the population parameters by confronting the model to data (<span class="math inline">\(\mathbf{Y}\)</span>).</p></li>
<li><p>By using Bayes Theorem this results in a posterior distribution on the model parameters.<br />
<span class="math display">\[
g(\boldsymbol{\theta}\vert\mathbf{Y})=\frac{f(Y\vert \boldsymbol{\theta})g(\boldsymbol{\theta})}{\int f(Y\vert \boldsymbol{\theta}) g(\boldsymbol{\theta}) d\boldsymbol{\theta}} \text{     }\left(\text{ posterior}=\frac{\text{prior} \times \text{ likelihood}}{\text{Marginal distribution}}\right)
\]</span></p></li>
</ul>
<hr />
</div>
<div id="limma-approach" class="section level2">
<h2><span class="header-section-number">4.2</span> Limma approach</h2>
<p>Developed for gene expression analysis with micro arrays. Let g be the index for gene g. <span class="math display">\[
\begin{array}{cc}
&amp;\beta_{gk}\vert \sigma^2_g,\beta_{gk}\neq 0 \sim N(0,v_{0k}\sigma_g^2)\\\\
\text{Prior}\\
&amp;\frac{1}{\sigma^2_g}\sim s^2_0\frac{\chi^2_{d_0}}{d_0}\\\\\\\\
&amp;\hat \beta_{gk} | \beta_{gk} , \sigma_g^2 \sim N( \beta_{gk} , v_{gk}\sigma_g^2)\\\\
\text{Data}\\
&amp;s_g^2\sim \sigma^2_g\frac{\chi^2_{d_g}}{d_g}\\\\
\end{array}
\]</span></p>
<hr />
</div>
<div id="limma-approach-1" class="section level2">
<h2><span class="header-section-number">4.3</span> Limma approach</h2>
<p>Under this assumption, it can be shown that</p>
<ul>
<li><p>Posterior Mean for the variance parameter: <span class="math display">\[\tilde{s}^2_p = \text{E}\left[\sigma^2_p\vert s_p^2\right]=\frac{d_0 s_0^2+d_ps_p^2}{d_0+d_p}\]</span></p></li>
<li><p><span class="math display">\[\tilde{T}_p=\frac{\mathbf{L}_k \hat{ \boldsymbol{\beta_p}}}{\mathbf{L}_k^T(\mathbf{X}^T\mathbf{WX})^{-1}\mathbf{L}_k^T \tilde{s}_p^2}\]</span></p></li>
</ul>
<p>is t-distributed under <span class="math inline">\(H_0: \mathbf{L}_j\boldsymbol{\beta} = 0\)</span></p>
<p><span class="math display">\[\tilde{T}_p \vert H_0 \sim t(d_0 + d_p)\]</span></p>
<hr />
</div>
<div id="empirical-bayes" class="section level2">
<h2><span class="header-section-number">4.4</span> Empirical Bayes</h2>
<ul>
<li>A fully Bayesian
<ul>
<li>would define the prior distribution by carefully choosing the prior parameters based on prior knowledge on the process</li>
<li>would confront the prior to the data and performs inference using the posterior distribution of the model parameters.</li>
</ul></li>
<li>In an empirical Bayesian approach one estimates the prior parameters based on the data.</li>
<li>In <strong>Limma</strong> moment estimators for <span class="math inline">\(s_0\)</span> and <span class="math inline">\(d_0\)</span> are derived using the information on the gene (protein) wise variances of all genes (proteins).</li>
<li>In <strong>Limma</strong> one also does not work with the full posterior distribution for the variances, but with the maximum a-posterior estimate.</li>
</ul>
<hr />
</div>
<div id="illustration" class="section level2">
<h2><span class="header-section-number">4.5</span> Illustration</h2>
<p>We borrow strength across proteins by</p>
<ol style="list-style-type: decimal">
<li>placing a scaled <span class="math inline">\(\chi^2\)</span> prior: <span class="math inline">\(\chi^2(s_o,d_0)\)</span> on the precisions (<span class="math inline">\(1/\sigma^2_p\)</span>)</li>
<li>estimating the prior parameters <span class="math inline">\(s_0\)</span> and <span class="math inline">\(df_0\)</span></li>
<li>replacing the estimated protein-wise variances (<span class="math inline">\(s_p^2\)</span>) with the maximum a-posteriori variance <span class="math display">\[\tilde{s}_p = \frac{d_p s^2_p + d_0 s_0^2}{d_p+d_0}\]</span></li>
</ol>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>sd &lt;-<span class="st"> </span><span class="kw">sapply</span>(</span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb84-3"><a href="#cb84-3"></a>  getSigma) <span class="op">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="st">  </span>na.exclude</span>
<span id="cb84-5"><a href="#cb84-5"></a>sdPost &lt;-<span class="st"> </span><span class="kw">sapply</span>(</span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb84-7"><a href="#cb84-7"></a>  getSigmaPosterior) <span class="op">%&gt;%</span></span>
<span id="cb84-8"><a href="#cb84-8"></a><span class="st">  </span>na.exclude</span>
<span id="cb84-9"><a href="#cb84-9"></a></span>
<span id="cb84-10"><a href="#cb84-10"></a>p1 &lt;-<span class="st"> </span><span class="kw">qplot</span>(sd,sdPost) <span class="op">+</span></span>
<span id="cb84-11"><a href="#cb84-11"></a><span class="st">  </span><span class="kw">geom_abline</span>()</span>
<span id="cb84-12"><a href="#cb84-12"></a>p1</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div id="how-do-we-get-to-the-posterior-standard-deviation" class="section level3">
<h3><span class="header-section-number">4.5.1</span> How do we get to the posterior standard deviation?</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>hlp &lt;-<span class="st"> </span>limma<span class="op">::</span><span class="kw">squeezeVar</span>(</span>
<span id="cb85-2"><a href="#cb85-2"></a>  <span class="dt">var =</span> <span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels, getVar),</span>
<span id="cb85-3"><a href="#cb85-3"></a>  <span class="dt">df =</span> <span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels, getDF)</span>
<span id="cb85-4"><a href="#cb85-4"></a>  )</span></code></pre></div>
<div id="degrees-of-freedom-of-prior" class="section level4">
<h4><span class="header-section-number">4.5.1.1</span> Degrees of freedom of prior</h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>hlp<span class="op">$</span>df.prior</span></code></pre></div>
<pre><code>## [1] 3.385413</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>model &lt;-<span class="st"> </span><span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">2</span>]]</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="kw">getDfPosterior</span>(model) <span class="op">-</span><span class="st"> </span><span class="kw">getDF</span>(model)</span></code></pre></div>
<pre><code>## [1] 3.385413</code></pre>
</div>
<div id="posterior-variance" class="section level4">
<h4><span class="header-section-number">4.5.1.2</span> posterior variance</h4>
<p><span class="math display">\[\tilde s_p=\sqrt{\frac{d_p\times s^2_p + d_0 s_0^2}{d_p+d_0}} \]</span></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>hlp<span class="op">$</span>var.prior</span></code></pre></div>
<pre><code>## [1] 0.2489859</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>varPost &lt;-<span class="st"> </span>(<span class="kw">getVar</span>(model) <span class="op">*</span><span class="st"> </span><span class="kw">getDF</span>(model) <span class="op">+</span><span class="st"> </span>hlp<span class="op">$</span>df.prior <span class="op">*</span><span class="st"> </span>hlp<span class="op">$</span>var.prior)<span class="op">/</span>(<span class="kw">getDF</span>(model)<span class="op">+</span>hlp<span class="op">$</span>df.prior)</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="kw">sqrt</span>(varPost)</span></code></pre></div>
<pre><code>## [1] 0.6607153</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">getSigmaPosterior</span>(model)</span></code></pre></div>
<pre><code>## [1] 0.6607153</code></pre>
<p>Hence, standard deviations are shrunken towards prior standard deviation! Large standard deviations become smaller and smaller standard deviations become larger!</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>p1 <span class="op">+</span></span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> hlp<span class="op">$</span>var.prior<span class="op">^</span>.<span class="dv">5</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
</div>
<div id="illustration-via-simulation" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Illustration via Simulation</h3>
<p>Suppose that the standard deviations for all proteins are the same and are equal to 1. We simulate proteins with the same mean as the fitted mean in the experiment but with standard deviation of 1.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>nCoefs &lt;-<span class="st"> </span><span class="kw">getCoef</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">2</span>]]) <span class="op">%&gt;%</span><span class="st"> </span>length</span>
<span id="cb97-2"><a href="#cb97-2"></a>coefs &lt;-</span>
<span id="cb97-3"><a href="#cb97-3"></a><span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb97-4"><a href="#cb97-4"></a>    <span class="cf">function</span>(x) <span class="kw">getCoef</span>(x)[<span class="dv">1</span><span class="op">:</span>nCoefs]</span>
<span id="cb97-5"><a href="#cb97-5"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb97-6"><a href="#cb97-6"></a><span class="st">  </span>t <span class="op">%&gt;%</span></span>
<span id="cb97-7"><a href="#cb97-7"></a><span class="st">  </span>na.exclude</span>
<span id="cb97-8"><a href="#cb97-8"></a></span>
<span id="cb97-9"><a href="#cb97-9"></a></span>
<span id="cb97-10"><a href="#cb97-10"></a>p &lt;-<span class="st"> </span><span class="kw">nrow</span>(coefs)</span>
<span id="cb97-11"><a href="#cb97-11"></a>n &lt;-<span class="st"> </span><span class="kw">ncol</span>(pe[[<span class="dv">1</span>]])</span>
<span id="cb97-12"><a href="#cb97-12"></a>f0_equalVar &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>p,</span>
<span id="cb97-13"><a href="#cb97-13"></a>  <span class="dt">FUN=</span><span class="cf">function</span>(i, n, betas, sd, design) {</span>
<span id="cb97-14"><a href="#cb97-14"></a>  <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> design <span class="op">%*%</span><span class="st"> </span>betas[i,], <span class="dt">sd =</span> sd)},</span>
<span id="cb97-15"><a href="#cb97-15"></a>  <span class="dt">n =</span> n,</span>
<span id="cb97-16"><a href="#cb97-16"></a>  <span class="dt">betas =</span> coefs,</span>
<span id="cb97-17"><a href="#cb97-17"></a>  <span class="dt">sd =</span> <span class="dv">1</span>,</span>
<span id="cb97-18"><a href="#cb97-18"></a>  <span class="dt">design =</span> X</span>
<span id="cb97-19"><a href="#cb97-19"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb97-20"><a href="#cb97-20"></a><span class="st">  </span>t</span>
<span id="cb97-21"><a href="#cb97-21"></a><span class="kw">colnames</span>(f0_equalVar) &lt;-<span class="st"> </span><span class="kw">colnames</span>(pe[[<span class="dv">1</span>]])</span>
<span id="cb97-22"><a href="#cb97-22"></a>sims &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(f0_equalVar <span class="op">%&gt;%</span><span class="st"> </span>as.data.frame, <span class="dt">ecol =</span> <span class="dv">1</span><span class="op">:</span>n, <span class="dt">name =</span> <span class="st">&quot;sim_equalVar&quot;</span>)</span>
<span id="cb97-23"><a href="#cb97-23"></a><span class="kw">colData</span>(sims) &lt;-<span class="st"> </span><span class="kw">colData</span>(pe)</span>
<span id="cb97-24"><a href="#cb97-24"></a>sims &lt;-<span class="st"> </span><span class="kw">msqrob</span>(<span class="dt">object =</span> sims, <span class="dt">i =</span> <span class="st">&quot;sim_equalVar&quot;</span>, <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>location<span class="op">*</span>tissue <span class="op">+</span><span class="st"> </span>patient)</span>
<span id="cb97-25"><a href="#cb97-25"></a></span>
<span id="cb97-26"><a href="#cb97-26"></a>sd0 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</span>
<span id="cb97-27"><a href="#cb97-27"></a>  <span class="kw">rowData</span>(sims[[<span class="st">&quot;sim_equalVar&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb97-28"><a href="#cb97-28"></a>  getSigma) <span class="op">%&gt;%</span></span>
<span id="cb97-29"><a href="#cb97-29"></a><span class="st">  </span>na.exclude</span>
<span id="cb97-30"><a href="#cb97-30"></a>sdPost0 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</span>
<span id="cb97-31"><a href="#cb97-31"></a>  <span class="kw">rowData</span>(sims[[<span class="st">&quot;sim_equalVar&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb97-32"><a href="#cb97-32"></a>  getSigmaPosterior) <span class="op">%&gt;%</span></span>
<span id="cb97-33"><a href="#cb97-33"></a><span class="st">  </span>na.exclude</span>
<span id="cb97-34"><a href="#cb97-34"></a></span>
<span id="cb97-35"><a href="#cb97-35"></a><span class="kw">qplot</span>(sd0,sdPost0) <span class="op">+</span></span>
<span id="cb97-36"><a href="#cb97-36"></a><span class="st">  </span><span class="kw">geom_abline</span>() <span class="op">+</span></span>
<span id="cb97-37"><a href="#cb97-37"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">range</span>(sd0))</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<ul>
<li>We observe a large variability in the individual protein level standard deviation estimates.</li>
<li>We simulated proteins with standard deviation of 1, but the protein estimates vary from 0.21, … , 1.95.</li>
<li>Large uncertainty on the estimation of variances in small samples</li>
<li>The empirical Bayes method, however, recognises that all proteins are simulated with the same variance.</li>
<li>Hence, it can borrow tremendous strength across proteins to stabilize the variance estimation</li>
<li>Here, it shrinks all protein variance to the prior variance, which is indeed very close to 1, the value we have adopted in the simulation.</li>
</ul>
<p>Note, that the prior degree of freedom also is set to infinity:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="kw">getDF</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim_equalVar&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 5.666118</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="kw">getDfPosterior</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim_equalVar&quot;</span>]])<span class="op">$</span>msqrobModels[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<p>which imposes shrinkage to the prior standard deviation!</p>
<p>The empirical Bayes method can thus indeed recognise the common variance that is shared across proteins!</p>
</div>
</div>
</div>
<div id="p-values" class="section level1">
<h1><span class="header-section-number">5</span> P-values</h1>
<div id="simulation-under-h_0." class="section level2">
<h2><span class="header-section-number">5.1</span> Simulation under H_0.</h2>
<ul>
<li>Mean log2 protein intensity for atrium equals mean log2 protein intensity for ventriculum in the left heart region.</li>
<li>sd equals the sd for the protein.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Extract <span class="math inline">\(\hat \sigma\)</span> and <span class="math inline">\(\beta\)</span>’s</li>
</ol>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>sd &lt;-<span class="st"> </span><span class="kw">sapply</span>(</span>
<span id="cb102-2"><a href="#cb102-2"></a>  <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb102-3"><a href="#cb102-3"></a>  getSigma) <span class="op">%&gt;%</span></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="st">  </span>na.exclude</span>
<span id="cb102-5"><a href="#cb102-5"></a></span>
<span id="cb102-6"><a href="#cb102-6"></a>coefs &lt;-</span>
<span id="cb102-7"><a href="#cb102-7"></a><span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>msqrobModels,</span>
<span id="cb102-8"><a href="#cb102-8"></a>    <span class="cf">function</span>(x) <span class="kw">getCoef</span>(x)[<span class="dv">1</span><span class="op">:</span>nCoefs]</span>
<span id="cb102-9"><a href="#cb102-9"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="st">  </span>t <span class="op">%&gt;%</span></span>
<span id="cb102-11"><a href="#cb102-11"></a><span class="st">  </span>na.exclude</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Set <span class="math inline">\(\beta_\text{tissue}\)</span> equal to 0. No FC between atrium and ventriculum left.</li>
</ol>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>coefs0 &lt;-<span class="st"> </span>coefs</span>
<span id="cb103-2"><a href="#cb103-2"></a>coefs0[,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Simulate protein expressions for each protein from a Normal distribution under <span class="math inline">\(H_0\)</span> for left heart region (no FC between atrium and ventriculum left) and sd the sd for the protein.</li>
</ol>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="kw">set.seed</span>(<span class="dv">104</span>)</span>
<span id="cb104-2"><a href="#cb104-2"></a>f0 &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>p,</span>
<span id="cb104-3"><a href="#cb104-3"></a>  <span class="cf">function</span>(i, betas, sd, design)</span>
<span id="cb104-4"><a href="#cb104-4"></a>  <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> design <span class="op">%*%</span><span class="st"> </span>betas[i,], <span class="dt">sd =</span> sd[i]),</span>
<span id="cb104-5"><a href="#cb104-5"></a>  <span class="dt">betas =</span> coefs0,</span>
<span id="cb104-6"><a href="#cb104-6"></a>  <span class="dt">sd =</span> sd,</span>
<span id="cb104-7"><a href="#cb104-7"></a>  <span class="dt">design =</span> X</span>
<span id="cb104-8"><a href="#cb104-8"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb104-9"><a href="#cb104-9"></a><span class="st">  </span>t</span>
<span id="cb104-10"><a href="#cb104-10"></a><span class="kw">colnames</span>(f0) &lt;-<span class="st"> </span><span class="kw">colnames</span>(pe[[<span class="dv">1</span>]])</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Setup QFeatures object and perform MSqRob analysis</li>
</ol>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>sims &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(f0 <span class="op">%&gt;%</span><span class="st"> </span>as.data.frame, <span class="dt">ecol =</span> <span class="dv">1</span><span class="op">:</span>n, <span class="dt">name =</span> <span class="st">&quot;sim0&quot;</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="kw">colData</span>(sims) &lt;-<span class="st"> </span><span class="kw">colData</span>(pe)</span>
<span id="cb105-3"><a href="#cb105-3"></a>sims &lt;-<span class="st"> </span><span class="kw">msqrob</span>(<span class="dt">object =</span> sims, <span class="dt">i =</span> <span class="st">&quot;sim0&quot;</span>, <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>location<span class="op">*</span>tissue <span class="op">+</span><span class="st"> </span>patient)</span>
<span id="cb105-4"><a href="#cb105-4"></a>sims &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> sims, <span class="dt">i =</span> <span class="st">&quot;sim0&quot;</span>, <span class="dt">contrast =</span> L)</span></code></pre></div>
<div id="evaluate-pvalues-under-h_0" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Evaluate pvalues under H_0</h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb106-2"><a href="#cb106-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> pval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb106-3"><a href="#cb106-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb106-4"><a href="#cb106-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</span>
<span id="cb106-5"><a href="#cb106-5"></a>volcano</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Number of false positives without multiple testing?</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV <span class="op">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="st">  </span><span class="kw">filter</span>(pval <span class="op">&lt;</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3"></a><span class="st">  </span>nrow</span></code></pre></div>
<pre><code>## [1] 115</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">mean</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)    </span></code></pre></div>
<pre><code>## [1] 0.05665025</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="kw">hist</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval,<span class="dt">main =</span> <span class="st">&quot;simulation H0&quot;</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<ul>
<li>The p-values are uniform!</li>
<li>All p-values under the null are equally likely.</li>
<li>Statistical hypthesis testing leads to a uniform test strategy under <span class="math inline">\(H_0\)</span></li>
<li>If use p-value cutoff at 0.05 we expect to return 5% of the non-DE proteins as differentially expressed: many false positives can be expected!</li>
</ul>
</div>
</div>
<div id="pvalue-distribution-in-real-experiment" class="section level2">
<h2><span class="header-section-number">5.2</span> Pvalue distribution in real experiment</h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="kw">hist</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval, <span class="dt">main =</span> <span class="st">&quot;realData&quot;</span>)</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<ul>
<li>A mixture of null proteins (non-DE): uniform, and, DE proteins: enrichment of p-values at low p-values</li>
</ul>
</div>
</div>
<div id="correction-for-multiple-testing" class="section level1">
<h1><span class="header-section-number">6</span> Correction for multiple testing</h1>
<ul>
<li>We can adjust the p-values for multiple testing.</li>
</ul>
<div id="family-wise-error-rate-correction" class="section level2">
<h2><span class="header-section-number">6.1</span> Family wise error rate correction:</h2>
<ul>
<li><p>A list of returned proteins is considered to be in error as soon as it contains at most one false positive protein.</p></li>
<li><p><span class="math inline">\(\text{FWER} = P(FP \leq 1)\)</span></p></li>
<li><p>FWER: probability of making at least one false positive decision or probability to declare at least one protein differentially abundant which is truly non differentially abundant</p></li>
</ul>
<div id="bonferroni-method" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Bonferroni method</h3>
<ul>
<li>Simple method</li>
<li><span class="math inline">\(m\)</span> tests are performed at the level <span class="math inline">\(\alpha/m\)</span></li>
<li>FWER<span class="math inline">\(\leq\sum\limits_{p=1}^{m}P(reject H_{0p}\vert H_{0p}\text{ is true})=m \alpha/m=\alpha\)</span></li>
<li>Provides strong control</li>
<li>Bonferroni is very conservative</li>
<li>Works for dependent tests</li>
<li>Adjusted p-value: <span class="math inline">\(\tilde{p}_p=\min(m\ p_p,1)\)</span></li>
</ul>
<hr />
<div id="bonferroni-in-practise" class="section level4">
<h4><span class="header-section-number">6.1.1.1</span> Bonferroni in practise</h4>
<p>Via R functions</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>padj &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(</span>
<span id="cb113-2"><a href="#cb113-2"></a>  <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval,</span>
<span id="cb113-3"><a href="#cb113-3"></a>  <span class="dt">method =</span> <span class="st">&quot;bonferroni&quot;</span>)</span></code></pre></div>
<p>Own Implementation: adjust and make sure that p-value is smaller than 1.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>m &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval))</span>
<span id="cb114-2"><a href="#cb114-2"></a>padjSelf &lt;-<span class="st">  </span><span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval <span class="op">*</span><span class="st"> </span>m</span>
<span id="cb114-3"><a href="#cb114-3"></a>padjSelf[padjSelf <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb114-4"><a href="#cb114-4"></a></span>
<span id="cb114-5"><a href="#cb114-5"></a><span class="kw">range</span>(padj <span class="op">-</span><span class="st"> </span>padjSelf, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 0 0</code></pre>
</div>
<div id="illustration-in-simulation-under-h_0-and-heart-case-study" class="section level4">
<h4><span class="header-section-number">6.1.1.2</span> Illustration in simulation under <span class="math inline">\(H_0\)</span> and heart case study</h4>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb116-2"><a href="#cb116-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> <span class="kw">p.adjust</span>(pval,<span class="st">&quot;bonferroni&quot;</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb116-3"><a href="#cb116-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb116-4"><a href="#cb116-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb116-6"><a href="#cb116-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;simulated heart data under H0&quot;</span>)</span>
<span id="cb116-7"><a href="#cb116-7"></a>volcano</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<ul>
<li>No false positives are returned for simulation under H_0. List is correct according to FWER.</li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb117-2"><a href="#cb117-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> <span class="kw">p.adjust</span>(pval,<span class="st">&quot;bonferroni&quot;</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb117-3"><a href="#cb117-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb117-4"><a href="#cb117-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb117-5"><a href="#cb117-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb117-6"><a href="#cb117-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;real heart data&quot;</span>)</span>
<span id="cb117-7"><a href="#cb117-7"></a>volcano</span></code></pre></div>
<pre><code>## Warning: Removed 1263 rows containing missing values (geom_point).</code></pre>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<ul>
<li>Very few proteins are returned for real data. Very conservative!</li>
</ul>
</div>
</div>
<div id="fwer-step-down-method-of-holm" class="section level3">
<h3><span class="header-section-number">6.1.2</span> FWER: step down method of Holm</h3>
<ul>
<li>Compare smallest p-value with <span class="math inline">\(\alpha/m\)</span></li>
<li>If you can reject the smallest p-value at <span class="math inline">\(\alpha/m\)</span> level
<ul>
<li>asses second smallest p-value at the <span class="math inline">\(\alpha/(m-1)\)</span></li>
</ul></li>
<li>If you can reject the second smallest p-value at <span class="math inline">\(\alpha/(m-1)\)</span> level
<ul>
<li>asses third smallest p-value at the <span class="math inline">\(\alpha/(m-2)\)</span></li>
</ul></li>
<li>…</li>
<li>If you can reject the k-1 smallest p-value at <span class="math inline">\(\alpha/(m-k+2)\)</span> level
<ul>
<li>asses k smallest p-value at the <span class="math inline">\(\alpha/(m-k+1)\)</span> level</li>
</ul></li>
<li>continu as long as you can reject.</li>
</ul>
<p>The Holm is a step down method (from more to less significant) that corrects in each step for the number of null hypothesis that you still can falsely reject.</p>
<hr />
<p>Adjusted p-values:</p>
<ul>
<li>Order p-values with <span class="math inline">\((k)\)</span> the <span class="math inline">\(k^{th}\)</span> smallest p-value<br />
</li>
<li><span class="math inline">\(\tilde{p}_{(k)}=\min(p_{(k)}(m-k+1),1)\)</span></li>
</ul>
<p>Suppose 2 tests: <span class="math inline">\(p_{(1)}=0.001\)</span>, <span class="math inline">\(p_{(2)}=0.0015\)</span> <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(\tilde{p}_{(1)}=0.002\)</span>, <span class="math inline">\(\tilde{p}_{(2)}=0.0015\)</span></p>
<ul>
<li>Problem: Monotonicity is not the same as for original p-values!</li>
<li>Enforce monotonicity: <span class="math inline">\(\tilde{p}_{(k)}=\max\limits_{h=1,\ldots,k}\min(p_{(h)}(m-h+1),1)\)</span></li>
</ul>
<hr />
<div id="holm-example" class="section level4">
<h4><span class="header-section-number">6.1.2.1</span> Holm example</h4>
<p>With R functions:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>padj &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(</span>
<span id="cb119-2"><a href="#cb119-2"></a>  <span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval,</span>
<span id="cb119-3"><a href="#cb119-3"></a>  <span class="dt">method =</span> <span class="st">&quot;holm&quot;</span>)</span></code></pre></div>
<p>Own implementation</p>
<ol style="list-style-type: decimal">
<li>Order p-values</li>
</ol>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a>padjSelf &lt;-<span class="st">  </span><span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval</span>
<span id="cb120-2"><a href="#cb120-2"></a>ord &lt;-<span class="st"> </span><span class="kw">order</span>(padjSelf)</span>
<span id="cb120-3"><a href="#cb120-3"></a>pOrd &lt;-<span class="st"> </span>padjSelf[ord]</span>
<span id="cb120-4"><a href="#cb120-4"></a>m &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(padjSelf))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Adjust ordered p-values and ensure that value is not larger than 1</li>
</ol>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>pOrd[<span class="dv">1</span><span class="op">:</span>m] &lt;-<span class="st"> </span>pOrd[<span class="dv">1</span><span class="op">:</span>m]<span class="op">*</span>(m <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span>m) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb121-2"><a href="#cb121-2"></a>pOrd[pOrd<span class="op">&gt;</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Monotonicity</li>
</ol>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>pmax &lt;-<span class="st"> </span>pOrd[<span class="dv">1</span>]</span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>m)</span>
<span id="cb122-3"><a href="#cb122-3"></a>{</span>
<span id="cb122-4"><a href="#cb122-4"></a>  <span class="cf">if</span> (pOrd[i] <span class="op">&gt;</span><span class="st"> </span>pmax)</span>
<span id="cb122-5"><a href="#cb122-5"></a>    pmax &lt;-<span class="st"> </span>pOrd[i] <span class="cf">else</span></span>
<span id="cb122-6"><a href="#cb122-6"></a>    pOrd[i] &lt;-<span class="st"> </span>pmax</span>
<span id="cb122-7"><a href="#cb122-7"></a>}</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Put adjusted p-values in original order</li>
</ol>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>padjSelf[ord] &lt;-<span class="st"> </span>pOrd</span>
<span id="cb123-2"><a href="#cb123-2"></a><span class="kw">range</span>(padj <span class="op">-</span><span class="st"> </span>padjSelf, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 0 0</code></pre>
</div>
<div id="illustration-in-simulation-under-h_0-and-heart-case-study-1" class="section level4">
<h4><span class="header-section-number">6.1.2.2</span> Illustration in simulation under <span class="math inline">\(H_0\)</span> and heart case study</h4>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb125-2"><a href="#cb125-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> <span class="kw">p.adjust</span>(pval,<span class="st">&quot;holm&quot;</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb125-5"><a href="#cb125-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb125-6"><a href="#cb125-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;simulated heart data under H0&quot;</span>)</span>
<span id="cb125-7"><a href="#cb125-7"></a>volcano</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<ul>
<li>No false positives are returned for simulation under H_0. List is correct according to FWER.</li>
</ul>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb126-2"><a href="#cb126-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> <span class="kw">p.adjust</span>(pval,<span class="st">&quot;holm&quot;</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb126-3"><a href="#cb126-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb126-5"><a href="#cb126-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb126-6"><a href="#cb126-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;real heart data&quot;</span>)</span>
<span id="cb126-7"><a href="#cb126-7"></a>volcano</span></code></pre></div>
<pre><code>## Warning: Removed 1263 rows containing missing values (geom_point).</code></pre>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<ul>
<li>Very few proteins are returned for real data. Still very conservative!</li>
</ul>
</div>
</div>
</div>
<div id="false-discovery-rate" class="section level2">
<h2><span class="header-section-number">6.2</span> False discovery rate</h2>
<ul>
<li>Adjusted P-values with the Benjamini Hochberg correction correspond to the estimated FDR of the set that is returned when the significance level is set at this threshold. <span class="math display">\[\begin{eqnarray}
FDR(p_0) &amp;=&amp; \text{E}\left[\frac{FP}{(FP + TP)}\right]\\
&amp;\approx&amp;\frac{p_0 \times m}{\#p_p \leq p_0}\\
\end{eqnarray}\]</span></li>
</ul>
<p>So adjusted p-value for protein j equals <span class="math display">\[\tilde p_j = \frac{p_{0,j} \times m}{\#p_p \leq p_{0,j}}\]</span></p>
<p>However, the FDR always has to be between 0 and 1 so:</p>
<p><span class="math display">\[\tilde p_j = \min\left[\frac{p_{0,j} \times m}{\#p_p \leq p_{0,j}},1\right]\]</span></p>
<p>and the adjusted p-values should remain in the same order as the original p-values.</p>
<p><span class="math display">\[\tilde p_j =  \min\limits_{\forall k: p_k &gt; p_j} \min\left[\frac{p_{0,k} \times m}{\#p_p \leq p_{0,k}},1\right]\]</span></p>
<ol style="list-style-type: decimal">
<li>Order pvalues</li>
</ol>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>pvals &lt;-<span class="st"> </span><span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>pval</span>
<span id="cb128-2"><a href="#cb128-2"></a>naInd &lt;-<span class="st"> </span><span class="kw">is.na</span>(pvals)</span>
<span id="cb128-3"><a href="#cb128-3"></a>pHlp &lt;-<span class="st"> </span>pvals[<span class="op">!</span>naInd]</span>
<span id="cb128-4"><a href="#cb128-4"></a>ord &lt;-<span class="st"> </span>pHlp <span class="op">%&gt;%</span><span class="st"> </span>order</span>
<span id="cb128-5"><a href="#cb128-5"></a>pHlp &lt;-<span class="st"> </span>pHlp[ord]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Adjust ordered p-values</li>
</ol>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a>pHlp &lt;-<span class="st"> </span>pHlp<span class="op">*</span><span class="kw">length</span>(pHlp)<span class="op">/</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(pHlp))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Ensure adjust p-values are smaller are equal than 1</li>
</ol>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>pHlp[pHlp<span class="op">&gt;</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Monotonicity constraint</li>
</ol>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a>pmin &lt;-<span class="st"> </span>pHlp[<span class="kw">length</span>(pHlp)]</span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="cf">for</span> (j <span class="cf">in</span> (<span class="kw">length</span>(pHlp)<span class="op">-</span><span class="dv">1</span>)<span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb131-3"><a href="#cb131-3"></a>{</span>
<span id="cb131-4"><a href="#cb131-4"></a>  <span class="cf">if</span> (pHlp[j] <span class="op">&lt;</span><span class="st"> </span>pmin)</span>
<span id="cb131-5"><a href="#cb131-5"></a>    pmin &lt;-<span class="st"> </span>pHlp[j] <span class="cf">else</span></span>
<span id="cb131-6"><a href="#cb131-6"></a>    pHlp[j] &lt;-<span class="st"> </span>pmin   </span>
<span id="cb131-7"><a href="#cb131-7"></a>}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Put p-values back in original order</li>
</ol>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>pHlp[ord] &lt;-<span class="st"> </span>pHlp</span>
<span id="cb132-2"><a href="#cb132-2"></a>pAdj &lt;-<span class="st"> </span>pvals</span>
<span id="cb132-3"><a href="#cb132-3"></a>pAdj[<span class="op">!</span>naInd] &lt;-<span class="st"> </span>pHlp</span>
<span id="cb132-4"><a href="#cb132-4"></a></span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="kw">head</span>(pAdj)</span></code></pre></div>
<pre><code>## [1]        NA 0.8351039        NA        NA 0.9062353        NA</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="kw">head</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["logFC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["t"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pval"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["adjPval"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"A0M8Q6"},{"1":"0.20946392","2":"0.5601628","3":"7.914824","4":"0.3739340","5":"0.7182716","6":"0.8351039","_rn_":"A0PJW6"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"A0PJZ3"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"A0PK00"},{"1":"0.07123672","2":"0.3206733","3":"9.293515","4":"0.2221474","5":"0.8290044","6":"0.9062353","_rn_":"A1A4S6"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"A1A5D9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="kw">range</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV<span class="op">$</span>adjPval <span class="op">-</span><span class="st"> </span>pAdj,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] -2.220446e-16  2.220446e-16</code></pre>
<div id="illustration-in-simulation-under-h_0-and-heart-case-study-2" class="section level4">
<h4><span class="header-section-number">6.2.0.1</span> Illustration in simulation under <span class="math inline">\(H_0\)</span> and heart case study</h4>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(sims[[<span class="st">&quot;sim0&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb137-2"><a href="#cb137-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb137-3"><a href="#cb137-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb137-4"><a href="#cb137-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb137-5"><a href="#cb137-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;simulated heart data under H0&quot;</span>)</span>
<span id="cb137-7"><a href="#cb137-7"></a>volcano</span></code></pre></div>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<ul>
<li>No false positives are returned for simulation under H_0. List is correct according to FWER.</li>
<li>It can be shown that the FDR-method controls the FWER when <span class="math inline">\(H_0\)</span> is true for all features.</li>
</ul>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a>volcano &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;proteinRobust&quot;</span>]])<span class="op">$</span>tissueV,</span>
<span id="cb138-2"><a href="#cb138-2"></a>                 <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb138-3"><a href="#cb138-3"></a><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb138-4"><a href="#cb138-4"></a><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb138-5"><a href="#cb138-5"></a><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb138-6"><a href="#cb138-6"></a><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;real heart data&quot;</span>)</span>
<span id="cb138-7"><a href="#cb138-7"></a>volcano</span></code></pre></div>
<pre><code>## Warning: Removed 1263 rows containing missing values (geom_point).</code></pre>
<p><img src="technicalDetailsProteomics_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>The FDR method allows us to return much longer DA protein lists at the expense of a few false positives. The FDR controls the fraction of false positives in the list that you return on average on the significance level that is adopted. So if you use <span class="math inline">\(\alpha=0.05\)</span> we expect on average 5% of false positives in the list that we return.</p>
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiVGVjaG5pY2FsIGRldGFpbHMgb24gbGluZWFyIHJlZ3Jlc3Npb24gZm9yIHByb3Rlb21pY3Mgd2hlbiBzdGFydGluZyBmcm9tIHN1bW1hcml6ZWQgcHJvdGVpbiBleHByZXNzaW9uIHZhbHVlcyIKYXV0aG9yOiAiTGlldmVuIENsZW1lbnQiCmRhdGU6ICJzdGF0T21pY3MsIEdoZW50IFVuaXZlcnNpdHkgKGh0dHBzOi8vc3RhdG9taWNzLmdpdGh1Yi5pbykiCm91dHB1dDoKICAgIGh0bWxfZG9jdW1lbnQ6CiAgICAgIGNvZGVfZG93bmxvYWQ6IHRydWUKICAgICAgdGhlbWU6IGNvc21vCiAgICAgIHRvYzogdHJ1ZQogICAgICB0b2NfZmxvYXQ6IHRydWUKICAgICAgaGlnaGxpZ2h0OiB0YW5nbwogICAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKLS0tCgojIFByZWFtYmxlCgpSZWFkIHN0b3JlZCByZXN1bHRzIGZvciBoZWFydCBkYXRhCgpgYGB7ciwgd2FybmluZz1GQUxTRSwgbWVzc2FnZT1GQUxTRX0KbGlicmFyeSh0aWR5dmVyc2UpCmxpYnJhcnkobGltbWEpCmxpYnJhcnkoUUZlYXR1cmVzKQpsaWJyYXJ5KG1zcXJvYjIpCnBlIDwtIHJlYWRSRFMoCiAgdXJsKAogICAgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGF0T21pY3MvU0dBMjAyMC9naC1wYWdlcy9hc3NldHMvcGVIZWFydC5yZHMiLAogICAgInJiIikKICApCmBgYAoKIyBMaW5lYXIgcmVncmVzc2lvbgoKLSBDb25zaWRlciBhIHZlY3RvciBvZiBwcmVkaWN0b3JzICRcbWF0aGJme3h9X2k9KHhfMSxcbGRvdHMseF97cC0xfSkkIGFuZAotIGEgcmVhbC12YWx1ZWQgcmVzcG9uc2UgJFlfaSQKLSB3aXRoICRpID0gMSwgXGxkb3RzLCBuJAotIHRoZW4gdGhlIGxpbmVhciByZWdyZXNzaW9uIG1vZGVsIGNhbiBiZSB3cml0dGVuIGFzClxbCllfaT1mKFxtYXRoYmZ7eH0pICtcZXBzaWxvbj1cYmV0YV8wK1xzdW1cbGltaXRzX3tqPTF9XntwLTF9IHhfe2lqfVxiZXRhICsgXGVwc2lsb25faQpcXQp3aXRoIGkuaS5kLiAkXGVwc2lsb25faVxzaW0gTigwLFxzaWdtYV4yKSQKCi0tLQoKLSAkbiQgb2JzZXJ2YXRpb25zICQoXG1hdGhiZnt4fV8xLHlfMSkgXGxkb3RzIChcbWF0aGJme3h9X24seV9uKSQKLSBSZWdyZXNzaW9uIGluIG1hdHJpeCBub3RhdGlvbgpcW1xtYXRoYmZ7WX09XG1hdGhiZntYXGJldGF9ICsgXGJvbGRzeW1ib2x7XGVwc2lsb259XF0Kd2l0aCAkXG1hdGhiZntZfT1cbGVmdFtcYmVnaW57YXJyYXl9e2N9eV8xXFwgXHZkb3RzXFx5X25cZW5ke2FycmF5fVxyaWdodF0kLAokXG1hdGhiZntYfT1cbGVmdFtcYmVnaW57YXJyYXl9e2NjY2N9IDEmeF97MTF9JlxsZG90cyZ4X3sxcC0xfVxcClx2ZG90cyZcdmRvdHMmJlx2ZG90c1xcCjEmeF97bjF9JlxsZG90cyZ4X3tucC0xfQpcZW5ke2FycmF5fVxyaWdodF0kLAokXGJvbGRzeW1ib2x7XGJldGF9PVxsZWZ0W1xiZWdpbnthcnJheX17Y31cYmV0YV8wXFwgXHZkb3RzXFwgXGJldGFfe3AtMX1cZW5ke2FycmF5fVxyaWdodF0kIGFuZAokXGJvbGRzeW1ib2x7XGVwc2lsb259PVxsZWZ0W1xiZWdpbnthcnJheX17Y30gXGVwc2lsb25fMSBcXCBcdmRvdHMgXFwgXGVwc2lsb25fblxlbmR7YXJyYXl9XHJpZ2h0XSQKCi0tLQoKIyMgTGVhc3QgU3F1YXJlcyAoTFMpCgotIE1pbmltaXplIHRoZSByZXNpZHVhbCBzdW0gb2Ygc3F1YXJlcwpcYmVnaW57ZXFuYXJyYXkqfQpSU1MoXGJvbGRzeW1ib2x7XGJldGF9KSY9JlxzdW1cbGltaXRzX3tpPTF9Xm4gZV4yX2lcXAomPSZcc3VtXGxpbWl0c197aT0xfV5uIFxsZWZ0KHlfaS1cYmV0YV8wLVxzdW1cbGltaXRzX3tqPTF9XnAgeF97aWp9XGJldGFfalxyaWdodCleMgpcZW5ke2VxbmFycmF5Kn0KLSBvciBpbiBtYXRyaXggbm90YXRpb24KXGJlZ2lue2VxbmFycmF5Kn0KUlNTKFxib2xkc3ltYm9se1xiZXRhfSkmPSYoXG1hdGhiZntZfS1cbWF0aGJme1hcYmV0YX0pXlQoXG1hdGhiZntZfS1cbWF0aGJme1hcYmV0YX0pXFwKJj0mXFZlcnQgXG1hdGhiZntZfS1cbWF0aGJme1hcYmV0YX1cVmVydF4yClxlbmR7ZXFuYXJyYXkqfQp3aXRoIHRoZSAkTF8yJC1ub3JtIG9mIGEgJHAkLWRpbS4gdmVjdG9yICR2JCAkXFZlcnQgXG1hdGhiZnt2fSBcVmVydD1cc3FydHt2XzFeMitcbGRvdHMrdl9wXjJ9JAoKLSAkXHJpZ2h0YXJyb3ckICRcaGF0e1xib2xkc3ltYm9se1xiZXRhfX09XHRleHR7YXJnbWlufV9cYmV0YSBcVmVydCBcbWF0aGJme1l9LVxtYXRoYmZ7WFxiZXRhfVxWZXJ0XjIkfQoKCi0tLQoKIyMjIE1pbmltaXplIFJTUwpcWwpcYmVnaW57YXJyYXl9e2NjY30KXGZyYWN7XHBhcnRpYWwgUlNTfXtccGFydGlhbCBcYm9sZHN5bWJvbHtcYmV0YX19Jj0mXG1hdGhiZnswfVxcXFwKXGZyYWN7KFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KV5UKFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KX17XHBhcnRpYWwgXGJvbGRzeW1ib2x7XGJldGF9fSY9JlxtYXRoYmZ7MH1cXFxcCi0yXG1hdGhiZntYfV5UKFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KSY9JlxtYXRoYmZ7MH1cXFxcClxtYXRoYmZ7WH1eVFxtYXRoYmZ7WFxiZXRhfSY9JlxtYXRoYmZ7WH1eVFxtYXRoYmZ7WX1cXFxcClxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fSY9JihcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXG1hdGhiZntZfQpcZW5ke2FycmF5fQpcXQoKLS0tCgojIyMjIEhlYXJ0IGV4YW1wbGUKCmBgYHtyfQp5IDwtIGFzc2F5KHBlW1sicHJvdGVpblJvYnVzdCJdXSlbMixdCmZpdCA8LSBsbSh5IH4gbG9jYXRpb24qdGlzc3VlICsgcGF0aWVudCwgZGF0YSA9IGNvbERhdGEocGUpLCB4ID0gVFJVRSkKaGVhZChmaXQkeCw0KQpgYGAKClRoZSBtb2RlbCBtYXRyaXggY2FuIGFsc28gYmUgb2J0YWluZWQgd2l0aG91dCBmaXR0aW5nIHRoZSBtb2RlbDoKCmBgYHtyfQpYIDwtIG1vZGVsLm1hdHJpeCh+IGxvY2F0aW9uICogdGlzc3VlICsgcGF0aWVudCwgY29sRGF0YShwZSkpCmhlYWQoWCw0KQpgYGAKCkxlYXN0IHNxdWFyZXM6CmBgYHtyfQpiZXRhcyA8LSBzb2x2ZSh0KFgpJSolWCkgJSolIHQoWCkgJSolIHkKY2JpbmQoZml0JGNvZWYsIGJldGFzKQpgYGAKCi0tLQoKIyMjIFZhcmlhbmNlIEVzdGltYXRvcj8KXFsKXGJlZ2lue2FycmF5fXtjY2x9ClxoYXR7XGJvbGRzeW1ib2x7XFNpZ21hfX1fe1xoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX0KJj0mXHRleHR7dmFyfVxsZWZ0WyhcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXG1hdGhiZntZfVxyaWdodF1cXFxcCiY9JihcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXHRleHR7dmFyfVxsZWZ0W1xtYXRoYmZ7WX1ccmlnaHRdXG1hdGhiZntYfShcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XFxcXAomPSYoXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxtYXRoYmZ7WH1eVChcbWF0aGJme0l9XHNpZ21hXjIpXG1hdGhiZntYfShcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9ClxcXFwKJj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlRcbWF0aGJme0l9XHF1YWRcbWF0aGJme1h9KFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cc2lnbWFeMlxcXFwKJVxoYXR7XGJvbGRtYXRoe1xTaWdtYX19X3tcaGF0e1xib2xkc3ltYm9se1xiZXRhfX19Jj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlRcdmFyXGxlZnRbXG1hdGhiZntZfVxyaWdodF0oXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxtYXRoYmZ7WH1cXAomPSYoXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0oXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxzaWdtYV4yXFxcXAomPSYoXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxzaWdtYV4yClxlbmR7YXJyYXl9ClxdCgotLS0KCiMjIyMgaGVhcnQgZXhhbXBsZQoKCmBgYHtyfQpzdW1tYXJ5KGZpdCkkY292LnVuc2NhbGVkICogc2lnbWEoZml0KV4yCmBgYAoKYGBge3J9Cm4gPC0gbnJvdyhYKQpwIDwtIG5jb2woWCkKbXNlIDwtIHN1bSgoeS1YJSolYmV0YXMpXjIpLyhuLXApClNpZ21hQmV0YSA8LSBzb2x2ZSh0KFgpJSolWCkgKiBtc2UgICAKU2lnbWFCZXRhCnJhbmdlKFNpZ21hQmV0YSAtIHN1bW1hcnkoZml0KSRjb3YudW5zY2FsZWQgKiBzaWdtYShmaXQpXjIpCmBgYAoKYGBge3J9CmRhdGEuZnJhbWUoc3VtbWFyeShmaXQpJGNvZWZbLDE6Ml0sIGJldGFzID0gYmV0YXMsIHNlQmV0YXMgPSBkaWFnKFNpZ21hQmV0YSleLjUpCmBgYAoKIyMgQ29udHJhc3RzCgpXaGVuIHdlIGFzc2VzcyBhIGNvbnRyYXN0IHdlIGFzc2VzcyBhIGxpbmVhciBjb21iaW5hdGlvbiBvZiBtb2RlbCBwYXJhbWV0ZXJzOgoKXFsgSF8wOiBcbWF0aGJme0xeVFxiZXRhfSA9IDAgXHRleHR7IHZzIH0gSF8xOiBcbWF0aGJme0xeVFxiZXRhfSBcbmVxIDAgXF0KCkVzdGltYXRvciBvZiBDb250cmFzdD8KClxbXG1hdGhiZntMfV5UXGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19XF0KCgpWYXJpYW5jZT8KClxbClxib2xkc3ltYm9se1xTaWdtYX1fe1xtYXRoYmZ7TH1caGF0e1xib2xkc3ltYm9se1xiZXRhfX19PVxtYXRoYmZ7TH1eVFxib2xkc3ltYm9se1xTaWdtYX1fe1xoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX1cbWF0aGJme0x9ClxdCgotLS0KCiMjIyBoZWFydCBleGFtcGxlCgpgYGB7cn0KTCA8LSBtYWtlQ29udHJhc3QoCiAgYygKICAgICJ0aXNzdWVWID0gMCIsCiAgICAidGlzc3VlViArIGxvY2F0aW9uUjp0aXNzdWVWID0gMCIsCiAgICAidGlzc3VlViArIDAuNSpsb2NhdGlvblI6dGlzc3VlViA9IDAiLCJsb2NhdGlvblI6dGlzc3VlViA9IDAiKSwKICBwYXJhbWV0ZXJOYW1lcyA9CiAgICByb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkbXNxcm9iTW9kZWxzW1syXV0gJT4lCiAgICBnZXRDb2VmICU+JQogICAgbmFtZXMKICApCkwKYGBgCgpgYGB7cn0KY29udHJhc3RzIDwtIHQoTCkgJSolIGJldGFzClNpZ21hQ29udHJhc3RzIDwtIHQoTCkgJSolIFNpZ21hQmV0YSAlKiUgTApzZUNvbnRyYXN0cyA8LSBTaWdtYUNvbnRyYXN0cyAlPiUKICBkaWFnICU+JQogIHNxcnQKYGBgCgpDb21wYXJpc29uIHdpdGggbG0gYW5kIGdsaHQgcmVzdWx0cwoKYGBge3J9CmxpYnJhcnkobXVsdGNvbXApCmZpdEdsaHQgPC0gZ2xodChmaXQsIGxpbmZjdCA9IHQoTCkpCnN1bW1hcnkoZml0R2xodCwgdGVzdCA9IGFkanVzdGVkKCJub25lIikpCmRhdGEuZnJhbWUoY29udHJhc3RzLCBzZUNvbnRyYXN0cykKYGBgCgotIE5vdGUsIHRoYXQgdGhlIHBvd2VyIGZvciBhc3Nlc3NpbmcgJFxsb2dfMiQgRkMgYmV0d2VlbiB2ZW50cmljdWx1bSBhbmQgYXRyaXVtICBsZWZ0IGFuZCByaWdodCBpcyB0aGUgc2FtZS4gSW5kZWVkLCB0aGUgc3RhbmRhcmQgZXJyb3JzIGFyZSBlcXVhbCBmb3IgYm90aCBlZmZlY3RzLgoKCi0gTm90ZSwgdGhhdCB0aGUgcG93ZXIgZm9yIGFzc2Vzc2luZyAkXGxvZ18yJCBGQyBiZXR3ZWVuIHZlbnRyaWN1bHVtIGFuZCBhdHJpdW0gb3ZlciBib3RoIGhlYXJ0IHJlZ2lvbnMgaXMgaGlnaGVyIHRoYW4gd2hlbiBhc3Nlc3NpbmcgdGhlIGVmZmVjdCBsZWZ0IG9yIHJpZ2h0LgoKICAtIEluZGVlZCwgdGhlIHN0YW5kYXJkIGVycm9yIGlzIGEgZmFjdG9yICRcc3FydHsyfSQgc21hbGxlciBmb3IgdGhlIGZvcm1lciBlZmZlY3QKICAtIFdlIGludHVpdGl2ZWx5IGNhbiBleHBsYWluIHRoaXMgYmVjYXVzZSB3ZSBjYW4gdXNlIGFsbCBzYW1wbGVzIChkb3VibGUgdGhlIG51bWJlciBvZiBzYW1wbGVzKSB0byBhc3Nlc3MgdGhlIGF2ZXJhZ2UgZWZmZWN0LgogIC0gSGVuY2UgdGhlIHZhcmlhbmNlIGlzIGEgZmFjdG9yIHR3byBzbWFsbGVyLCBhbmQgdGhlIHNlIHdpdGggYSBmYWN0b3IgJFxzcXJ0ezJ9JAoKLSBOb3RlLCB0aGF0IHdlIGhhdmUgdGhlIGxvd2VzdCBwb3dlciB0byBwaWNrIHVwIGFuIGludGVyYWN0aW9uIGVmZmVjdC4gSW5kZWVkLCB0aGUgc2UgaXMgYSBmYWN0b3IgJFxzcXJ0ezJ9JCBsYXJnZXIgdGhhbiBmb3IgdGhlIHZlbnRyaWN1bHVtIC0gYXRyaXVtIGVmZmVjdCBsZWZ0IG9yIHJpZ2h0IGFuZCBhIGZhY3RvciAyIGxhcmdlciB0aGFuIGZvciB0aGUgYXZlcmFnZSBlZmZlY3QgYmV0d2VlbiB2ZW50cmljdWx1bSBhbmQgYXRyaXVtLgoKYGBge3J9CnNlQ29udHJhc3RzIC8gc2VDb250cmFzdHNbMV0Kc3FydCgyKQoxL3NxcnQoMikKYGBgCgojIyMgdC10ZXN0cwoKIC0gV2hlbiB0aGUgYXNzdW1wdGlvbnMgb2YgdGhlIGxpbmVhciBtb2RlbCBob2xkClxbClxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fSBcc2ltIE1WTlxsZWZ0W1xib2xkc3ltYm9se1xiZXRhfSxcbGVmdChcbWF0aGJme1h9XlRcbWF0aGJme1h9XHJpZ2h0KV57LTF9XHNpZ21hXjJccmlnaHRdClxdCi0gSGVuY2UsClxbClxtYXRoYmZ7TH1eVFxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fSBcc2ltIE1WTlxsZWZ0W1xtYXRoYmZ7TH1eVFxib2xkc3ltYm9se1xiZXRhfSxcbWF0aGJme0x9XlRcbGVmdFtcbGVmdChcbWF0aGJme1h9XlRcbWF0aGJme1h9XHJpZ2h0KV57LTF9XHNpZ21hXjJccmlnaHRdXG1hdGhiZntMfVxyaWdodF0KXF0KLSBXZSBlc3RpbWF0ZSAkXHNpZ21hXjIkIGJ5IE1TRQokJFxoYXR7XHNpZ21hfV4yPVxmcmFje1xtYXRoYmZ7ZX1eVFxtYXRoYmZ7ZX19e24tcH0gXHJpZ2h0YXJyb3cgXGhhdHtcYm9sZHN5bWJvbHtcU2lnbWF9fV97XGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19fT1cbGVmdChcbWF0aGJme1h9XlRcbWF0aGJme1h9XHJpZ2h0KV57LTF9XGhhdFxzaWdtYV4yJCQKCi0gV2hlbiB3ZSB0ZXN0IG9uZSBjb250cmFzdCBhdCB0aGUgdGltZSAoZS5nLiB0aGUgJGteXHRleHR7dGh9JCBjb250cmFzdCkgdGhlIHN0YXRpc3RpYyByZWR1Y2VzIHRvCgokJFQ9XGZyYWN7XG1hdGhiZntMfV9rXlRcaGF0e1xib2xkc3ltYm9se1xiZXRhfX19e1xzcXJ0e1xsZWZ0KFxtYXRoYmZ7TH1eVF9rXGhhdHtcYm9sZHN5bWJvbHtcU2lnbWF9fV97XGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19fVxtYXRoYmZ7TH1fa1xyaWdodCl9fSBcdW5kZXJzZXR7SF8wfXtcc2ltfSB0X3tuLXB9JCQKZm9sbG93cyBhIHQgZGlzdHJpYnV0aW9uIHdpdGggbi1wIGRlZ3JlZXMgb2YgZnJlZWRvbSB1bmRlciAkSF8wOiBcbWF0aGJme0x9XlRfa1xoYXR7XGJvbGRzeW1ib2x7XGJldGF9fT0wJAoKLS0tCgojIyMjIGhlYXJ0IGV4YW1wbGUKCmBgYHtyfQp0Q29udHJhc3RzIDwtIGNvbnRyYXN0cy9zZUNvbnRyYXN0cwpwQ29udHJhc3RzIDwtIHB0KGFicyh0Q29udHJhc3RzKSwKICBkZiA9IG4gLSBwLAogIGxvd2VyLnRhaWwgPSBGQUxTRSkgKiAyCmBgYAoKQ29tcGFyaXNvbiB3aXRoIGxtIGFuZCBnbGh0IHJlc3VsdHMKCmBgYHtyfQpzdW1tYXJ5KGZpdEdsaHQsIHRlc3QgPSBhZGp1c3RlZCgibm9uZSIpKQpkYXRhLmZyYW1lKGNvbnRyYXN0cywgc2VDb250cmFzdHMsIHRDb250cmFzdHMsIHBDb250cmFzdHMpCmBgYAoKCi0tLQoKIyMjIE9tbmlidXMgdGVzdAoKLSBXZSBjYW4gYWxzbyBhc3Nlc3MgYWxsIGNvbnRyYXN0cyBzaW11bHRhbmVvdXNseSB3aXRoIHRoZSBvbW5pYnVzIG51bGwgaHlwb3RoZXNpczoKXFtIXzA6IFxtYXRoYmZ7TH1eVFxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fT1cbWF0aGJmezB9XF0KCi0gU3RhdGlzdGljCiQkXG1hdGhiZntGfT1cZnJhY3tcaGF0e1xib2xkc3ltYm9se1xiZXRhfX1eVFxtYXRoYmZ7TH1cbGVmdChcbWF0aGJme0x9XlRcaGF0e1xib2xkc3ltYm9se1xTaWdtYX19X3tcaGF0e1xib2xkc3ltYm9se1xiZXRhfX19XG1hdGhiZntMfVxyaWdodCleey0xfVxtYXRoYmZ7TH1eVFxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX17bl9jfSBcdW5kZXJzZXR7SF8wfXtcc2ltfSBGX3tuX2Msbi1wfSQkCmZvbGxvd3MgYW4gRiBkaXN0cmlidXRpb24gd2l0aCAkbl9jJCBhbmQgbi1wIGRlZ3JlZXMgb2YgZnJlZWRvbSB1bmRlciB0aGUgb21uaWJ1cyBudWxsIGh5cG90aGVzaXMuCi0gTm90ZSwgdGhhdCAkbl9jJCBlcXVhbHMgdGhlIG51bWJlciBvZiBjb250cmFzdHMsIGFuZAotICRcbWF0aGJme0x9JCBpcyBhc3N1bWVkIHRvIGJlIGZ1bGwgcmFuawoKLS0tCgoKSWYgdGhlIG1hdHJpeCBcbWF0aGJme0x9IGlzIG5vdCBmdWxsIHJhbmssIGJ1dCBoYXMgcmFuayAkciA8IG5fYyQKCi0gaS5lLiBzb21lIG9mIHRoZSBjb250cmFzdHMgY2FuIGJlIHdyaXR0ZW4gYXMgbGluZWFyIGNvbWJpbmF0aW9ucyBvZiBvdGhlciBjb250cmFzdHMsCi0gdGhlIGludmVyc2Ugb2YgdGhlIHZhcmlhbmNlIGNvdmFyaWFuY2UgbWF0cml4IG9mIHRoZSBjb250cmFzdHMgZG9lcyBub3QgZXhpc3QKLSB3ZSBjYW4gdGhlbiBkZWNvbXBvc2UgTCBpbiAkciQgb3J0aG9nb25hbCBjb250cmFzdHMgJFxtYXRoYmZ7UX0kIHdpdGgKXFtcbWF0aGJme1F9X2peVCBcbWF0aGJme1F9X2teVCA9IFxkZWx0YV97amt9LFxdCgotICRqLGsgXGluIDEsXGxkb3RzLHIkLAoKLSAkXGRlbHRhe2prfSA9IDAkIGFuZCBpZiAkalxuZXEgayQgJFxkZWx0YXtqa30gPSAxJAoKLSBEZWNvbXBvc2l0aW9uIGNhbiBiZSBkb25lIHVzaW5nIHRoZSBRUiBkZWNvbXBvc2l0aW9uICAKCi0gV2UgY2FuIHRoYW4gYXNzZXNzIHRoZSBvbW5pYnVzIG51bGwgaHlwb3RoZXNpcyB1c2luZyB0aGUgc3RhdGlzdGljOgokJFxtYXRoYmZ7Rn09XGZyYWN7XGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19XlRcbWF0aGJme1F9X3JcbGVmdChcbWF0aGJme1F9XlRfclxoYXR7XGJvbGRzeW1ib2x7XFNpZ21hfX1fe1xoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX1cbWF0aGJme1F9X3JccmlnaHQpXnstMX1cbWF0aGJme1F9XlRfclxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX17cn0gXHVuZGVyc2V0e0hfMH17XHNpbX0gRl97cixuLXB9JCQKCi0tLQoKIyMjIyBIZWFydCBleGFtcGxlCgpgYGB7cn0KdHJ5KHNvbHZlKFNpZ21hQ29udHJhc3RzKSkKYGBgCgotIFdlIGNhbm5vdCBpbnZlcnQgdGhlIHZhcmlhbmNlIG1hdHJpeCBvZiB0aGUgY29udHJhc3RzIQotIEluZGVlZCwgdGhlIGNvbnRyYXN0cyBhcmUgbGluZWFyIGNvbWJpbmF0aW9ucyBvZiB0d28gcGFyYW1ldGVycyBhbmQgdGhlIGNvbnRyYXN0IG1hdHJpeCAkXG1hdGhiZntMfSQgd2lsbCB0aHVzIGhhdmUgcmFuayAyCi0gV2UgY2FsY3VsYXRlIG9ydGhvZ29uYWwgY29udHJhc3RzOgoKYGBge3J9CnFyTCA8LSBxcihMKQpyIDwtIHFyTCRyYW5rCnIKUSA8LSBxci5RKHFyTClbLDE6cl0Kcm93bmFtZXMoUSkgPC0gcm93bmFtZXMoTCkKUQpgYGAKCi0gUSBpcyBvcnRob25vcm1hbAoKYGBge3J9CnQoUSklKiVRCmBgYAoKRXhwbG9yaW5nIFEgc2hvd3MgdGhhdCBhc3Nlc3NpbmcgdGhlIG9tbmlidXMgaHlwb3RoZXNpcyBpcyB0aHVzIGVxdWl2YWxlbnQgdG8gYXNzZXNzaW5nIGlmIHRoZSBudWxsIGh5cG90aGVzaXMgdGhhdApcW0hfMDogXGJldGFfXHRleHR7dGlzc3VlfSA9IFxiZXRhX1x0ZXh0e3Rpc3N1ZTpsb2NhdGlvbn0gPSAwXF0KCmBgYHtyfQplc3QgPC0gdChRKSAlKiUgYmV0YXMKU2lnbWFFc3QgPC0gdChRKSAlKiUgU2lnbWFCZXRhICUqJSBRCkZzdGF0IDwtIHQoZXN0KSAlKiUgc29sdmUoU2lnbWFFc3QpICUqJSBlc3QgLyByCnBPbW5pYnVzIDwtIHBmKEZzdGF0LCByLCBwLCBsb3dlci50YWlsID0gRkFMU0UpCmBgYAoKLSBDb21wYXJpc29uIHdpdGggbG0gcmVzdWx0cwotIFdlIGNhbiBhc3Nlc3MgdGhlIG9tbmlidXMgaHlwb3RoZXNpcyBhbHNvIGJ5IGNvbXBhcmluZyB0d28gbW9kZWxzCiAgICAtIG1vZGVsIHdpdGggbG9jYXRpb24sIHRpc3N1ZSwgbG9jYXRpb24gLSB0aXNzdWUgaW50ZXJhY3Rpb24gYW5kIHBhdGllbnQgZWZmZWN0CiAgICAtIG51bGwgbW9kZWw6IG1vZGVsIHdpdGggbG9jYXRpb24gYW5kIHBhdGllbnQgZWZmZWN0CgpgYGB7cn0KZml0MCA8LSBsbSh5IH4gbG9jYXRpb24gKyBwYXRpZW50LCBjb2xEYXRhKHBlKSkKYW5vdmEoZml0LCBmaXQwKQpGc3RhdApwT21uaWJ1cwpgYGAKCiMgUm9idXN0IHJlZ3Jlc3Npb24KCi0gV2l0aCBtc3Fyb2IyIHdlIHBlcmZvcm0gcm9idXN0IHJlZ3Jlc3Npb24gdG8gZXN0aW1hdGUgdGhlIG1vZGVsIHBhcmFtZXRlcnMgb2YgdGhlIHJlZ3Jlc3Npb24gbW9kZWwKCi0gTm8gbm9ybWFsaXR5IGFzc3VtcHRpb24gbmVlZGVkCi0gUm9idXN0IGZpdCBtaW5pbWlzZXMgdGhlIG1heGltYWwgYmlhcyBvZiB0aGUgZXN0aW1hdG9ycwotIENJIGFuZCBzdGF0aXN0aWNhbCB0ZXN0cyBhcmUgYmFzZWQgb24gYXN5bXB0b3RpYyB0aGVvcnkKLSBJZiAkXGVwc2lsb24kIGlzIG5vcm1hbCwgdGhlIE0tZXN0aW1hdG9ycyBoYXZlIGEgaGlnaCBlZmZpY2llbmN5IQotIG9yZGluYXJ5IGxlYXN0IHNxdWFyZXMgKE9MUyk6IG1pbmltaXplIGxvc3MgZnVuY3Rpb24gXFtcc3VtXGxpbWl0c197aT0xfV5uICh5X2ktXG1hdGhiZnt4fV9pXlRcYm9sZHN5bWJvbHtcYmV0YX0pXjJcXQoKLSBNLWVzdGltYXRpb246IG1pbmltaXplIGxvc3MgZnVuY3Rpb24KXFtcc3VtXGxpbWl0c197aT0xfV5uICBccmhvXGxlZnQoeV9pLVxtYXRoYmZ7eH1faV5UXGJvbGRzeW1ib2x7XGJldGF9XHJpZ2h0KVxdCndpdGgKCiAgLSAkXHJobyQgaXMgc3ltbWV0cmljLCBpLmUuICRccmhvKHopPVxyaG8oLXopJAogIC0gJFxyaG8kIGhhcyBhIG1pbmltdW0gYXQgJFxyaG8oMCk9MCQsIGlzIHBvc2l0aXZlIGZvciBhbGwgJHpcbmVxIDAkCiAgLSAkXHJobyh6KSQgaW5jcmVhc2VzIGFzICRcdmVydCB6XHZlcnQkIGluY3JlYXNlcwoKLS0tCgogVGhlIGVzdGltYXRvciAkXGhhdHtcbXV9JCBpcyBhbHNvIHRoZSBzb2x1dGlvbiB0byB0aGUgZXF1YXRpb24KIFxbCiAgIFxzdW1fe2k9MX1ebiBcUHNpKHlfaSAtIFxtYXRoYmZ7eH1faVxib2xkc3ltYm9se1xiZXRhfSkgPTAsCiBcXQogd2hlcmUgJFxQc2kkIGlzIHRoZSBkZXJpdmF0aXZlIG9mICRccmhvJC4gRm9yICRcaGF0e1xiZXRhfSQgcG9zc2Vzc2luZyB0aGUgcm9idXN0bmVzcyBwcm9wZXJ0eSwgJFxQc2kkIHNob3VsZCBiZSBib3VuZGVkLgoKLS0tCgogRXhhbXBsZTogbGVhc3Qgc3F1YXJlcwoKIC0gJFxyaG8oeikgPSB6XjIkLCBhbmQgdGh1cyAkXFBzaSh6KT0yeiQgKHVuYm91bmRlZCEpLiBOb3Qgcm9idXN0IQoKLSAkXGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19JCBpcyB0aGUgc29sdXRpb24gb2YKIFxbCiAgIFxzdW1fe2k9MX1ebiAyIFxtYXRoYmZ7eH1faSAoeV9pIC0gXG1hdGhiZnt4fV9pXlRcYm9sZHN5bWJvbHtcYmV0YX0pID0gMCBcdGV4dHsgb3IgfSBcaGF0e1xib2xkc3ltYm9se1xiZXRhfX0gPSAoXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxtYXRoYmZ7WH1cbWF0aGJme3l9CiBcXQogd2l0aCAkXG1hdGhiZntYfT1bXG1hdGhiZnt4fV8xIFxsZG90cyBcbWF0aGJme3h9X0ddXlQkCgotLS0KCiBXaGVuIGEgbG9jYXRpb24gYW5kIGEgc2NhbGUgcGFyYW1ldGVyLCBzYXkgJFxzaWdtYSQsIGhhdmUgdG8gYmUgZXN0aW1hdGVkIHNpbXVsdGFuZW91c2x5LCB3ZSB3cml0ZQogXFsKICAgKFxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fSxcaGF0e1xzaWdtYX0pID0gXHRleHR7QXJnTWlufV97XGJvbGRzeW1ib2x7XGJldGF9LFxzaWdtYX0gXHN1bV97aT0xfV5uIFxyaG9cbGVmdChcZnJhY3t5X2kgLSBcbWF0aGJme3h9X2leVFxib2xkc3ltYm9se1xiZXRhfX17XHNpZ21hfVxyaWdodCkKICAgXHRleHR7IGFuZCB9IFxzdW1fe2k9MX1ebiBcUHNpXGxlZnQoXGZyYWN7eV9pIC0gXG1hdGhiZnt4fV9pXlRcYm9sZHN5bWJvbHtcYmV0YX19e1xzaWdtYX1ccmlnaHQpID0wLgogXF0KCiBEZWZpbmUgJHVfaSA9IFxmcmFje3lfaSAtIFxtYXRoYmZ7eH1faV5UXGJvbGRzeW1ib2x7XGJldGF9fXtcc2lnbWF9JC4gVGhlIGxhc3QgZXN0aW1hdGlvbiBlcXVhdGlvbiBpcyBlcXVpdmFsZW50IHRvCiBcWwogICBcc3VtX3tpPTF9Xm4gdyh1X2kpIHVfaSA9IDAgLAogXF0KIHdpdGggd2VpZ2h0IGZ1bmN0aW9uICR3KHUpPVxQc2kodSkvdSQuIFRoaXMgaXMgdGhlIHR5cGljYWwgZm9ybSB0aGF0IGFwcGVhcnMgd2hlbiBzb2x2aW5nIHRoZQogKml0ZXJhdGl2ZWx5IHJld2VpZ2h0ZWQgbGVhc3Qgc3F1YXJlcyBwcm9ibGVtKiwKIFxbCiAgIChcaGF0e1xib2xkc3ltYm9se1xiZXRhfX0sXGhhdHtcc2lnbWF9KSA9IFx0ZXh0e0FyZ01pbn1fe1xtdSxcc2lnbWF9IFxzdW1fe2k9MX1ebiB3KHVfaV57KGstMSl9KSBcbGVmdCh1X2leeyhrKX1ccmlnaHQpXjIgLAogXF0KIHdoZXJlICRrJCByZXByZXNlbnRzIHRoZSBpdGVyYXRpb24gbnVtYmVyLgoKLS0tCgojIyBTb21lIEV4YW1wbGVzIG9mIFJvYnVzdCBGdW5jdGlvbnMKCiFbXShodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL1NHQTIwMjAvZ2gtcGFnZXMvYXNzZXRzL1RhYmxlUm9idXN0LlBORykKClBoRCB0aGVzaXMgQm9sc3RhZCAyMDA0CgotLS0KCiMjIFRoZSAkXHJobyQgZnVuY3Rpb25zCgohW10oaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3N0YXRPbWljcy9TR0EyMDIwL2doLXBhZ2VzL2Fzc2V0cy9SaG9Sb2J1c3QuUE5HKQoKUGhEIHRoZXNpcyBCb2xzdGFkIDIwMDQKCi0tLQoKIyMjIENvbW1vbiAkXFBzaSQtRnVuY3Rpb25zCiFbXShodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL1NHQTIwMjAvZ2gtcGFnZXMvYXNzZXRzL3JvYnVzdFJlZ3Jlc3Npb25Qc2kucG5nKQoKUGhEIHRoZXNpcyBCb2xzdGFkIDIwMDQKCi0tLQoKIyMjIENvcnJlc3BvbmRpbmcgV2VpZ2h0IEZ1bmN0aW9ucwohW10oaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3N0YXRPbWljcy9TR0EyMDIwL2doLXBhZ2VzL2Fzc2V0cy9yb2J1c3RSZWdyZXNzaW9uV2VpZ2h0cy5wbmcpCgpQaEQgdGhlc2lzIEJvbHN0YWQgMjAwNAoKLS0tCgpgYGB7cn0KbGlicmFyeSgiTUFTUyIpCnJmaXQgPC0gcmxtKHkgfiBsb2NhdGlvbiAqIHRpc3N1ZSArIHBhdGllbnQsIGNvbERhdGEocGUpLCBtYXhpdD0xKQpxcGxvdChmaXQkY29lZmZpY2llbnRbLTFdLAogIHJmaXQkY29lZmZpY2llbnRbLTFdLAogIHhsYWI9ImZpdCIsCiAgeWxhYj0icm9idXN0IGZpdCIpICsKICBnZW9tX2FibGluZSgpICsKICB4bGltKHJhbmdlKGMoZml0JGNvZWZmaWNpZW50Wy0xXSxyZml0JGNvZWZmaWNpZW50Wy0xXSkpKSArCiAgeWxpbShyYW5nZShjKGZpdCRjb2VmZmljaWVudFstMV0scmZpdCRjb2VmZmljaWVudFstMV0pKSkKYGBgCgotLS0KCmBgYHtyfQpyZml0JHcKcGxvdCgKICByZml0JGZpdHRlZCwKICByZml0JHJlcywKICBjZXg9cmZpdCR3LAogIHBjaD0xOSxjb2w9MiwKICBjZXgubGFiPTEuNSwKICBjZXguYXhpcz0xLjUsCiAgeWxhYj0icmVzaWR1YWxzIiwKICB4bGFiPSJmaXQiKQpwb2ludHMocmZpdCRmaXR0ZWQsIHJmaXQkcmVzICwgY2V4PSAxLjUpCmBgYAoKLS0tCgpgYGB7cn0Kc3VtbWFyeShmaXQpCnN1bW1hcnkocmZpdCkKcm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJG1zcXJvYk1vZGVsc1tbMl1dICU+JSBnZXRDb2VmCmBgYAoKLS0tCgojIyBVbmRlcnN0YW5kaW5nIGltcGxlbWVudGF0aW9uIG9mIHJvYnVzdCByZWdyZXNzaW9uCgojIyMgU2ltdWxhdGUgMjAgb2JzZXJ2YXRpb25zIGZyb20gYSBsaW5lYXIgbW9kZWwgd2l0aCBlcnJvcnMgdGhhdCBmb2xsb3cgYSBub3JtYWwgZGlzdHJpYnV0aW9uCgpgYGB7cn0Kc2V0LnNlZWQgPC0gMTEyMzU4Cm5vYnMgPC0gMjAKc2R5IDwtIDEKeHNpbSA8LSBzZXEoMCwgMSwgbGVuZ3RoLm91dCA9IG5vYnMpCnlzaW0gPC0gMTAgKyA1KnhzaW0gKyBybm9ybShub2JzLCBzZCA9IHNkeSkKYGBgCgojIyMgYWRkIG91dGxpZXIgYXQgaGlnaCBsZXZlcmFnZSBwb2ludAoKYGBge3J9CnlzaW1bbm9ic10gPC0gNwpgYGAKCiMjIyBmaXQgbGluZWFyIG1vZGVsCgpgYGB7cn0Kb2xzIDwtIGxtKHlzaW0gfiB4c2ltKQpgYGAKCiMjIyBmaXQgcm9idXN0IGxpbmVhciBtb2RlbAoKYGBge3J9CmxpYnJhcnkoTUFTUykKbUVzdCA8LSBybG0oeXNpbSB+IHhzaW0pCmBgYAoKIyMjIyBwbG90IHJlc3VsdHMKCmBgYHtyfQpwbG90KHhzaW0sIHlzaW0pCmFibGluZShvbHMsIGx3ZCA9IDIpCmFibGluZShtRXN0LCBjb2wgPSAicmVkIiwgbHdkID0gMikKbGVnZW5kKCJ0b3BsZWZ0IiwKICBsZWdlbmQgPSBjKCJPTFMiLCAiTS1lc3RpbWF0aW9uIiksCiAgbHdkID0gMiwKICBjb2wgPSAxOjIpCnJvdW5kKG1Fc3QkdywzKQpgYGAKClRoZSBwbG90IGNsZWFybHkgc2hvd3MgdGhhdCB0aGUgb3V0bGllciBoYXMgYSBoaWdoIGltcGFjdCBvbiB0aGUgc2xvcGUgZXN0aW1hdGUuClRoaXMgaXMgYmVjYXVzZSB0aGUgb3V0bGllciBpcyBhdCBhIGhpZ2ggbGV2ZXJhZ2UgcG9pbnQsIGkuZS4gZmFyIGZyb20gdGhlIGF2ZXJhZ2UgY292YXJpYXRlIHBhdHRlcm4uCgojIyMgSW1wbGVtZW50IGl0IHlvdXJzZWxmCiMjIyMgc3RhcnQgZnJvbSBvbHMgZml0CgpgYGB7cn0KbG1Nb2QgPC0gb2xzCmBgYAoKIyMjIyBVc2Ugcm9idXN0IHZhcmlhbmNlIGVzdGltYXRvciB0byBjYWxjdWxhdGUgdGhlIHoKCmBgYHtyfQpyZXMgPC0gbG1Nb2QkcmVzCnN0ZGV2IDwtIG1hZChyZXMpCnN0ZGV2Cm1lZGlhbihhYnMocmVzLW1lZGlhbihyZXMpKSkqMS40ODI2CnogPC0gcmVzL3N0ZGV2CmBgYAoKIyMjIyBDYWxjdWxhdGUgd2VpZ2h0cyB1c2UgcHNpLmh1YmVyIGZ1bmN0aW9uCgpgYGB7cn0KdyA8LSBwc2kuaHViZXIoeikKcGxvdCh4c2ltLCB5c2ltKQpwbG90KHhzaW0sIGxtTW9kJHJlcywgY2V4ID0gdywgcGNoID0gMTksIGNvbCA9ICJyZWQiKQpwb2ludHMoeHNpbSxsbU1vZCRyZXMsIGNleCA9IDEuNSkKYGBgCgojIyMjIFBlcmZvcm0gYSB3ZWlnaHRlZCByZWdyZXNzaW9uIHVzZSBsbSB3aXRoIHdlaWdodHM9dwoKYGBge3J9CmxtTW9kIDwtIGxtKHlzaW1+eHNpbSwgd2VpZ2h0cyA9IHcpCmBgYAoKIyMjIyBQbG90IHJlc3VsdHMKCmBgYHtyfQpwbG90KHhzaW0sIHlzaW0pCmFibGluZShvbHMsIGx3ZCA9IDIpCmFibGluZShtRXN0LCBjb2wgPSAicmVkIiwgbHdkID0gMikKYWJsaW5lKGxtTW9kLCBjb2wgPSAiYmx1ZSIsIGx3ZCA9IDIpCmxlZ2VuZCgidG9wbGVmdCIsCiAgbGVnZW5kID0gYygiT0xTIiwiTS1lc3RpbWF0aW9uIiwiT3VyIEltcGwiKSwKICBsd2QgPSAyLAogIGNvbCA9IGMoImJsYWNrIiwgInJlZCIsICJibHVlIikpCmBgYAoKIyMjIyBSZXBlYXQgdGhpcyBtYW55IHRpbWVzCmBgYHtyfQpsbU1vZCA8LSBvbHMKZm9yIChrIGluIDE6MykKewojIyMjIyNyZXBlYXQgdGhpcyBwYXJ0IHNldmVyYWwgdGltZXMgdW50aWwgY29udmVyZ2VuY2UKI3VzZSByb2J1c3QgdmFyaWFuY2UgZXN0aW1hdG9yIHRvIGNhbGN1bGF0ZSB0aGUgegpyZXMgPC0gbG1Nb2QkcmVzCnN0ZGV2IDwtIG1hZChyZXMpCm1lZGlhbihhYnMocmVzLW1lZGlhbihyZXMpKSkqMS40ODI2Cgp6IDwtIHJlcy9zdGRldgoKI2NhbGN1bGF0ZSB3ZWlnaHRzCiN1c2UgcHNpLmh1YmVyIGZ1bmN0aW9uCncgPC0gcHNpLmh1YmVyKHopCgojcGVyZm9ybSBhIHdlaWdodGVkIHJlZ3Jlc3Npb24gdXNlIGxtIHdpdGggd2VpZ2h0cz13CmxtTW9kIDwtIGxtKHlzaW0gfiB4c2ltLCB3ZWlnaHRzID0gdykKCiNwbG90IHJlc3VsdHMKcGxvdCh4c2ltLHlzaW0pCmFibGluZShvbHMsIGx3ZCA9IDIpCmFibGluZShtRXN0LCBjb2wgPSAicmVkIiwgbHdkID0gMikKYWJsaW5lKGxtTW9kLCBjb2wgPSAiYmx1ZSIsIGx3ZCA9IDIpCmxlZ2VuZCgidG9wbGVmdCIsCiAgbGVnZW5kID0gYygiT0xTIiwiTS1lc3RpbWF0aW9uIiwiT3VyIEltcGwiKSwKICBsd2QgPSAyLAogIGNvbCA9IGMoImJsYWNrIiwgInJlZCIsICJibHVlIikKICApCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwp9CmBgYAoKIyBFbXBpcmljYWwgQmF5ZXMvTW9kZXJhdGVkICR0JC10ZXN0LgoKIEEgZ2VuZXJhbCBjbGFzcyBvZiBtb2RlcmF0ZWQgdGVzdCBzdGF0aXN0aWNzIGlzIGdpdmVuIGJ5CgogXFtcdGlsZGV7VH1fcCA9IFxmcmFje1xtYXRoYmZ7TH1fayBcaGF0eyBcYm9sZHN5bWJvbHtcYmV0YV9wfX19e1xtYXRoYmZ7TH1fa15UKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7V1h9KV57LTF9XG1hdGhiZntMfV9rXlQgXHRpbGRle3N9X3BeMn1cXQoKIHdoZXJlICRcdGlsZGV7c31fcCQgaXMgYSBtb2RlcmF0ZWQgdmFyaWFuY2UgZXN0aW1hdG9yLgoKU2ltcGxlIGFwcHJvYWNoOiBzZXQgJFx0aWxkZXtzfV9wPXNfcCArIHNfMCQ6IHNpbXBseSBhZGQgYSBzbWFsbCBwb3NpdGl2ZSBjb25zdGFudCB0byB0aGUgZGVub21pbmF0b3Igb2YgdGhlIHQtc3RhdGlzdGljCgpcdGV4dGJme2VtcGlyaWNhbCBCYXllc30gdGhlb3J5IHByb3ZpZGVzIGZvcm1hbCBmcmFtZXdvcmsgZm9yIGJvcnJvd2luZyBzdHJlbmd0aCBhY3Jvc3MgZ2VuZXMgb3IgcHJvdGVpbnMsCmUuZy4gcG9wdWxhciBiaW9jb25kdWN0b3IgcGFja2FnZSBcdGV4dGJme2xpbW1hfQpcW1x0aWxkZXtzfV9nPVxzcXJ0e1xmcmFje2RfcHNfcF4yK2RfMHNfMF4yfXtkX2crZF8wfX0sXF0KYW5kIHRoZSBtb2RlcmF0ZWQgdC1zdGF0aXN0aWMgaXMgdC1kaXN0cmlidXRlZCB3aXRoICRkXzArZF9nJCBkZWdyZWVzIG9mIGZyZWVkb20gdW5kZXIgdGhlIG51bGwgaHlwb3RoZXNpcyAkSF8wOiBcbWF0aGJme0x9XGJvbGRzeW1ib2x7XGJldGF9PTAkLgoKLSBOb3RlLCB0aGF0IHRoZSBkZWdyZWVzIG9mIGZyZWVkb20gaW5jcmVhc2UgYnkgYm9ycm93aW5nIHN0cmVuZ3RoIGFjcm9zcyBwcm90ZWlucy4KCi0tLQoKIyMgSW50ZXJtZXp6bzogQmF5ZXNpYW4gTWV0aG9kcwoKLSBGcmVxdWVudGlzdHMgY29uc2lkZXIgZGF0YSBhcyByYW5kb20gYW5kIHBvcHVsYXRpb24gcGFyYW1ldGVycyBhcyBmaXhlZCBidXQgdW5rbm93bgotIEluIEJheWVzaWFuIHZpZXdwb2ludCBhIHBlcnNvbiBoYXMgcHJpb3IgYmVsaWVmcyBhYm91dCB0aGUgcG9wdWxhdGlvbiBwYXJhbWV0ZXJzIGFuZCB0aGUgdW5jZXJ0YWludHkgb24gdGhpcyBwcmlvciBiZWxpZWZzIGFyZSByZXByZXNlbnRlZCBieSBhIHByb2JhYmlsaXR5IGRpc3RyaWJ1dGlvbiBwbGFjZWQgb24gdGhpcyBwYXJhbWV0ZXIuCgogIC0gVGhpcyBkaXN0cmlidXRpb24gcmVmbGVjdHMgdGhlIHBlcnNvbidzIHN1YmplY3RpdmUgcHJpb3Igb3BpbmlvbiBhYm91dCBwbGF1c2libGUgdmFsdWVzIG9mIHRoZSBwYXJhbWV0ZXIuCiAgLSBBbmQgaXMgcmVmZXJyZWQgdG8gYXMgdGhlIHByaW9yICRnKFxib2xkc3ltYm9se1x0aGV0YX0pJC4KCi0gQmF5ZXNpYW4gdGhpbmtpbmcgd2lsbCB1cGRhdGUgdGhlIHByaW9yIGluZm9ybWF0aW9uIG9uIHRoZSBwb3B1bGF0aW9uIHBhcmFtZXRlcnMgYnkgY29uZnJvbnRpbmcgdGhlIG1vZGVsIHRvIGRhdGEgKCRcbWF0aGJme1l9JCkuCgotIEJ5IHVzaW5nIEJheWVzIFRoZW9yZW0gdGhpcyByZXN1bHRzIGluIGEgcG9zdGVyaW9yIGRpc3RyaWJ1dGlvbiBvbiB0aGUgbW9kZWwgcGFyYW1ldGVycy4gIApcWwpnKFxib2xkc3ltYm9se1x0aGV0YX1cdmVydFxtYXRoYmZ7WX0pPVxmcmFje2YoWVx2ZXJ0IFxib2xkc3ltYm9se1x0aGV0YX0pZyhcYm9sZHN5bWJvbHtcdGhldGF9KX17XGludCBmKFlcdmVydCBcYm9sZHN5bWJvbHtcdGhldGF9KSBnKFxib2xkc3ltYm9se1x0aGV0YX0pIGRcYm9sZHN5bWJvbHtcdGhldGF9fSBcdGV4dHsgICAgIH1cbGVmdChcdGV4dHsgcG9zdGVyaW9yfT1cZnJhY3tcdGV4dHtwcmlvcn0gXHRpbWVzIFx0ZXh0eyBsaWtlbGlob29kfX17XHRleHR7TWFyZ2luYWwgZGlzdHJpYnV0aW9ufX1ccmlnaHQpClxdCgotLS0KCiMjIExpbW1hICBhcHByb2FjaAoKRGV2ZWxvcGVkIGZvciBnZW5lIGV4cHJlc3Npb24gYW5hbHlzaXMgd2l0aCBtaWNybyBhcnJheXMuCkxldCBnIGJlIHRoZSBpbmRleCBmb3IgZ2VuZSBnLgpcWwpcYmVnaW57YXJyYXl9e2NjfQomXGJldGFfe2drfVx2ZXJ0IFxzaWdtYV4yX2csXGJldGFfe2drfVxuZXEgMCBcc2ltIE4oMCx2X3swa31cc2lnbWFfZ14yKVxcXFwKXHRleHR7UHJpb3J9XFwKJlxmcmFjezF9e1xzaWdtYV4yX2d9XHNpbSBzXjJfMFxmcmFje1xjaGleMl97ZF8wfX17ZF8wfVxcXFxcXFxcCiZcaGF0IFxiZXRhX3tna30gfCBcYmV0YV97Z2t9ICwgXHNpZ21hX2deMiBcc2ltIE4oIFxiZXRhX3tna30gLCB2X3tna31cc2lnbWFfZ14yKVxcXFwKXHRleHR7RGF0YX1cXAomc19nXjJcc2ltIFxzaWdtYV4yX2dcZnJhY3tcY2hpXjJfe2RfZ319e2RfZ31cXFxcClxlbmR7YXJyYXl9ClxdCgotLS0KCiMjIExpbW1hICBhcHByb2FjaAoKVW5kZXIgdGhpcyBhc3N1bXB0aW9uLCBpdCBjYW4gYmUgc2hvd24gdGhhdAoKLSBQb3N0ZXJpb3IgTWVhbiBmb3IgdGhlIHZhcmlhbmNlIHBhcmFtZXRlcjogXFtcdGlsZGV7c31eMl9wID0gXHRleHR7RX1cbGVmdFtcc2lnbWFeMl9wXHZlcnQgc19wXjJccmlnaHRdPVxmcmFje2RfMCBzXzBeMitkX3BzX3BeMn17ZF8wK2RfcH1cXQoKLSBcW1x0aWxkZXtUfV9wPVxmcmFje1xtYXRoYmZ7TH1fayBcaGF0eyBcYm9sZHN5bWJvbHtcYmV0YV9wfX19e1xtYXRoYmZ7TH1fa15UKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7V1h9KV57LTF9XG1hdGhiZntMfV9rXlQgXHRpbGRle3N9X3BeMn1cXQoKaXMgdC1kaXN0cmlidXRlZCB1bmRlciAkSF8wOiBcbWF0aGJme0x9X2pcYm9sZHN5bWJvbHtcYmV0YX0gPSAwJAoKXFtcdGlsZGV7VH1fcCBcdmVydCBIXzAgXHNpbSB0KGRfMCArIGRfcClcXQoKLS0tCgojIyBFbXBpcmljYWwgQmF5ZXMKLSBBIGZ1bGx5IEJheWVzaWFuCiAgLSB3b3VsZCBkZWZpbmUgdGhlIHByaW9yIGRpc3RyaWJ1dGlvbiBieSBjYXJlZnVsbHkgY2hvb3NpbmcgdGhlIHByaW9yIHBhcmFtZXRlcnMgYmFzZWQgb24gcHJpb3Iga25vd2xlZGdlIG9uIHRoZSBwcm9jZXNzCiAgLSB3b3VsZCBjb25mcm9udCB0aGUgcHJpb3IgdG8gdGhlIGRhdGEgYW5kIHBlcmZvcm1zIGluZmVyZW5jZSB1c2luZyB0aGUgcG9zdGVyaW9yIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbW9kZWwgcGFyYW1ldGVycy4KLSBJbiBhbiBlbXBpcmljYWwgQmF5ZXNpYW4gYXBwcm9hY2ggb25lIGVzdGltYXRlcyB0aGUgcHJpb3IgcGFyYW1ldGVycyBiYXNlZCBvbiB0aGUgZGF0YS4KLSBJbiAqKkxpbW1hKiogbW9tZW50IGVzdGltYXRvcnMgZm9yICRzXzAkIGFuZCAkZF8wJCBhcmUgZGVyaXZlZCB1c2luZyB0aGUgaW5mb3JtYXRpb24gb24gdGhlIGdlbmUgKHByb3RlaW4pIHdpc2UgdmFyaWFuY2VzIG9mIGFsbCBnZW5lcyAocHJvdGVpbnMpLgotIEluICoqTGltbWEqKiBvbmUgYWxzbyBkb2VzIG5vdCB3b3JrIHdpdGggdGhlIGZ1bGwgcG9zdGVyaW9yIGRpc3RyaWJ1dGlvbiBmb3IgdGhlIHZhcmlhbmNlcywgYnV0IHdpdGggdGhlIG1heGltdW0gYS1wb3N0ZXJpb3IgZXN0aW1hdGUuCgotLS0KCiMjIElsbHVzdHJhdGlvbgoKV2UgYm9ycm93IHN0cmVuZ3RoIGFjcm9zcyBwcm90ZWlucyBieQoKMS4gcGxhY2luZyBhIHNjYWxlZCAkXGNoaV4yJCBwcmlvcjogJFxjaGleMihzX28sZF8wKSQgb24gdGhlIHByZWNpc2lvbnMgKCQxL1xzaWdtYV4yX3AkKQoyLiBlc3RpbWF0aW5nIHRoZSBwcmlvciBwYXJhbWV0ZXJzICRzXzAkIGFuZCAkZGZfMCQKMy4gcmVwbGFjaW5nIHRoZSBlc3RpbWF0ZWQgcHJvdGVpbi13aXNlIHZhcmlhbmNlcyAoJHNfcF4yJCkgd2l0aCB0aGUgbWF4aW11bSBhLXBvc3RlcmlvcmkgdmFyaWFuY2UKXFtcdGlsZGV7c31fcCA9IFxmcmFje2RfcCBzXjJfcCArIGRfMCBzXzBeMn17ZF9wK2RfMH1cXQoKCmBgYHtyfQpzZCA8LSBzYXBwbHkoCiAgcm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJG1zcXJvYk1vZGVscywKICBnZXRTaWdtYSkgJT4lCiAgbmEuZXhjbHVkZQpzZFBvc3QgPC0gc2FwcGx5KAogIHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSRtc3Fyb2JNb2RlbHMsCiAgZ2V0U2lnbWFQb3N0ZXJpb3IpICU+JQogIG5hLmV4Y2x1ZGUKCnAxIDwtIHFwbG90KHNkLHNkUG9zdCkgKwogIGdlb21fYWJsaW5lKCkKcDEKYGBgCgojIyMgSG93IGRvIHdlIGdldCB0byB0aGUgcG9zdGVyaW9yIHN0YW5kYXJkIGRldmlhdGlvbj8KCmBgYHtyfQpobHAgPC0gbGltbWE6OnNxdWVlemVWYXIoCiAgdmFyID0gc2FwcGx5KHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSRtc3Fyb2JNb2RlbHMsIGdldFZhciksCiAgZGYgPSBzYXBwbHkocm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJG1zcXJvYk1vZGVscywgZ2V0REYpCiAgKQpgYGAKCiMjIyMgRGVncmVlcyBvZiBmcmVlZG9tIG9mIHByaW9yCgpgYGB7cn0KaGxwJGRmLnByaW9yCgptb2RlbCA8LSByb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkbXNxcm9iTW9kZWxzW1syXV0KZ2V0RGZQb3N0ZXJpb3IobW9kZWwpIC0gZ2V0REYobW9kZWwpCmBgYAoKIyMjIyBwb3N0ZXJpb3IgdmFyaWFuY2UKCiQkXHRpbGRlIHNfcD1cc3FydHtcZnJhY3tkX3BcdGltZXMgc14yX3AgKyBkXzAgc18wXjJ9e2RfcCtkXzB9fSAkJAoKYGBge3J9CmhscCR2YXIucHJpb3IKCnZhclBvc3QgPC0gKGdldFZhcihtb2RlbCkgKiBnZXRERihtb2RlbCkgKyBobHAkZGYucHJpb3IgKiBobHAkdmFyLnByaW9yKS8oZ2V0REYobW9kZWwpK2hscCRkZi5wcmlvcikKc3FydCh2YXJQb3N0KQpnZXRTaWdtYVBvc3Rlcmlvcihtb2RlbCkKYGBgCgpIZW5jZSwgc3RhbmRhcmQgZGV2aWF0aW9ucyBhcmUgc2hydW5rZW4gdG93YXJkcyBwcmlvciBzdGFuZGFyZCBkZXZpYXRpb24hCkxhcmdlIHN0YW5kYXJkIGRldmlhdGlvbnMgYmVjb21lIHNtYWxsZXIgYW5kIHNtYWxsZXIgc3RhbmRhcmQgZGV2aWF0aW9ucyBiZWNvbWUgbGFyZ2VyIQoKYGBge3J9CnAxICsKICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSBobHAkdmFyLnByaW9yXi41KQpgYGAKCgoKIyMjIElsbHVzdHJhdGlvbiB2aWEgU2ltdWxhdGlvbgoKU3VwcG9zZSB0aGF0IHRoZSBzdGFuZGFyZCBkZXZpYXRpb25zIGZvciBhbGwgcHJvdGVpbnMgYXJlIHRoZSBzYW1lIGFuZCBhcmUgZXF1YWwgdG8gMS4KV2Ugc2ltdWxhdGUgcHJvdGVpbnMgd2l0aCB0aGUgc2FtZSBtZWFuIGFzIHRoZSBmaXR0ZWQgbWVhbiBpbiB0aGUgZXhwZXJpbWVudCBidXQgd2l0aCBzdGFuZGFyZCBkZXZpYXRpb24gb2YgMS4KCmBgYHtyIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9Cm5Db2VmcyA8LSBnZXRDb2VmKHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSRtc3Fyb2JNb2RlbHNbWzJdXSkgJT4lIGxlbmd0aApjb2VmcyA8LQpzYXBwbHkocm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJG1zcXJvYk1vZGVscywKICAgIGZ1bmN0aW9uKHgpIGdldENvZWYoeClbMTpuQ29lZnNdCiAgKSAlPiUKICB0ICU+JQogIG5hLmV4Y2x1ZGUKCgpwIDwtIG5yb3coY29lZnMpCm4gPC0gbmNvbChwZVtbMV1dKQpmMF9lcXVhbFZhciA8LSBzYXBwbHkoMTpwLAogIEZVTj1mdW5jdGlvbihpLCBuLCBiZXRhcywgc2QsIGRlc2lnbikgewogIHJub3JtKG4sIG1lYW4gPSBkZXNpZ24gJSolIGJldGFzW2ksXSwgc2QgPSBzZCl9LAogIG4gPSBuLAogIGJldGFzID0gY29lZnMsCiAgc2QgPSAxLAogIGRlc2lnbiA9IFgKICApICU+JQogIHQKY29sbmFtZXMoZjBfZXF1YWxWYXIpIDwtIGNvbG5hbWVzKHBlW1sxXV0pCnNpbXMgPC0gcmVhZFFGZWF0dXJlcyhmMF9lcXVhbFZhciAlPiUgYXMuZGF0YS5mcmFtZSwgZWNvbCA9IDE6biwgbmFtZSA9ICJzaW1fZXF1YWxWYXIiKQpjb2xEYXRhKHNpbXMpIDwtIGNvbERhdGEocGUpCnNpbXMgPC0gbXNxcm9iKG9iamVjdCA9IHNpbXMsIGkgPSAic2ltX2VxdWFsVmFyIiwgZm9ybXVsYSA9IH4gbG9jYXRpb24qdGlzc3VlICsgcGF0aWVudCkKCnNkMCA8LSBzYXBwbHkoCiAgcm93RGF0YShzaW1zW1sic2ltX2VxdWFsVmFyIl1dKSRtc3Fyb2JNb2RlbHMsCiAgZ2V0U2lnbWEpICU+JQogIG5hLmV4Y2x1ZGUKc2RQb3N0MCA8LSBzYXBwbHkoCiAgcm93RGF0YShzaW1zW1sic2ltX2VxdWFsVmFyIl1dKSRtc3Fyb2JNb2RlbHMsCiAgZ2V0U2lnbWFQb3N0ZXJpb3IpICU+JQogIG5hLmV4Y2x1ZGUKCnFwbG90KHNkMCxzZFBvc3QwKSArCiAgZ2VvbV9hYmxpbmUoKSArCiAgeWxpbShyYW5nZShzZDApKQpgYGAKCi0gV2Ugb2JzZXJ2ZSBhIGxhcmdlIHZhcmlhYmlsaXR5IGluIHRoZSBpbmRpdmlkdWFsIHByb3RlaW4gbGV2ZWwgc3RhbmRhcmQgZGV2aWF0aW9uIGVzdGltYXRlcy4KLSBXZSBzaW11bGF0ZWQgcHJvdGVpbnMgd2l0aCBzdGFuZGFyZCBkZXZpYXRpb24gb2YgMSwgYnV0IHRoZSBwcm90ZWluIGVzdGltYXRlcyB2YXJ5IGZyb20gYHIgcGFzdGUocm91bmQocmFuZ2Uoc2QwKSwyKSxjb2xsYXBzZT0iLCAuLi4gLCAiKWAuCi0gTGFyZ2UgdW5jZXJ0YWludHkgb24gdGhlIGVzdGltYXRpb24gb2YgdmFyaWFuY2VzIGluIHNtYWxsIHNhbXBsZXMKLSBUaGUgZW1waXJpY2FsIEJheWVzIG1ldGhvZCwgaG93ZXZlciwgcmVjb2duaXNlcyB0aGF0IGFsbCBwcm90ZWlucyBhcmUgc2ltdWxhdGVkIHdpdGggdGhlIHNhbWUgdmFyaWFuY2UuCi0gSGVuY2UsIGl0IGNhbiBib3Jyb3cgdHJlbWVuZG91cyBzdHJlbmd0aCBhY3Jvc3MgcHJvdGVpbnMgdG8gc3RhYmlsaXplIHRoZSB2YXJpYW5jZSBlc3RpbWF0aW9uCi0gSGVyZSwgaXQgc2hyaW5rcyBhbGwgcHJvdGVpbiB2YXJpYW5jZSB0byB0aGUgcHJpb3IgdmFyaWFuY2UsIHdoaWNoIGlzIGluZGVlZCB2ZXJ5IGNsb3NlIHRvIDEsIHRoZSB2YWx1ZSB3ZSBoYXZlIGFkb3B0ZWQgaW4gdGhlIHNpbXVsYXRpb24uCgpOb3RlLCB0aGF0IHRoZSBwcmlvciBkZWdyZWUgb2YgZnJlZWRvbSBhbHNvIGlzIHNldCB0byBpbmZpbml0eToKYGBge3J9CmdldERGKHJvd0RhdGEoc2ltc1tbInNpbV9lcXVhbFZhciJdXSkkbXNxcm9iTW9kZWxzW1sxXV0pCmdldERmUG9zdGVyaW9yKHJvd0RhdGEoc2ltc1tbInNpbV9lcXVhbFZhciJdXSkkbXNxcm9iTW9kZWxzW1sxXV0pCmBgYAoKd2hpY2ggaW1wb3NlcyBzaHJpbmthZ2UgdG8gdGhlIHByaW9yIHN0YW5kYXJkIGRldmlhdGlvbiEKClRoZSBlbXBpcmljYWwgQmF5ZXMgbWV0aG9kIGNhbiB0aHVzIGluZGVlZCByZWNvZ25pc2UgdGhlIGNvbW1vbiB2YXJpYW5jZSB0aGF0IGlzIHNoYXJlZCBhY3Jvc3MgcHJvdGVpbnMhCgojIFAtdmFsdWVzCgojIyBTaW11bGF0aW9uIHVuZGVyIEhfMC4KCi0gTWVhbiBsb2cyIHByb3RlaW4gaW50ZW5zaXR5IGZvciBhdHJpdW0gZXF1YWxzIG1lYW4gbG9nMiBwcm90ZWluIGludGVuc2l0eSBmb3IgdmVudHJpY3VsdW0gaW4gdGhlIGxlZnQgaGVhcnQgcmVnaW9uLgotIHNkIGVxdWFscyB0aGUgc2QgZm9yIHRoZSBwcm90ZWluLgoKCjEuIEV4dHJhY3QgJFxoYXQgXHNpZ21hJCBhbmQgJFxiZXRhJCdzICAKYGBge3J9CnNkIDwtIHNhcHBseSgKICByb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkbXNxcm9iTW9kZWxzLAogIGdldFNpZ21hKSAlPiUKICBuYS5leGNsdWRlCgpjb2VmcyA8LQpzYXBwbHkocm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJG1zcXJvYk1vZGVscywKICAgIGZ1bmN0aW9uKHgpIGdldENvZWYoeClbMTpuQ29lZnNdCiAgKSAlPiUKICB0ICU+JQogIG5hLmV4Y2x1ZGUKYGBgCgoyLiBTZXQgJFxiZXRhX1x0ZXh0e3Rpc3N1ZX0kIGVxdWFsIHRvIDAuIE5vIEZDIGJldHdlZW4gYXRyaXVtIGFuZCB2ZW50cmljdWx1bSBsZWZ0LgoKYGBge3J9CmNvZWZzMCA8LSBjb2Vmcwpjb2VmczBbLDNdIDwtIDAKYGBgCgozLiBTaW11bGF0ZSBwcm90ZWluIGV4cHJlc3Npb25zIGZvciBlYWNoIHByb3RlaW4gZnJvbSBhIE5vcm1hbCBkaXN0cmlidXRpb24gdW5kZXIgJEhfMCQgZm9yIGxlZnQgaGVhcnQgcmVnaW9uIChubyBGQyBiZXR3ZWVuIGF0cml1bSBhbmQgdmVudHJpY3VsdW0gbGVmdCkgYW5kIHNkIHRoZSBzZCBmb3IgdGhlIHByb3RlaW4uCmBgYHtyfQpzZXQuc2VlZCgxMDQpCmYwIDwtIHNhcHBseSgxOnAsCiAgZnVuY3Rpb24oaSwgYmV0YXMsIHNkLCBkZXNpZ24pCiAgcm5vcm0obiwgbWVhbiA9IGRlc2lnbiAlKiUgYmV0YXNbaSxdLCBzZCA9IHNkW2ldKSwKICBiZXRhcyA9IGNvZWZzMCwKICBzZCA9IHNkLAogIGRlc2lnbiA9IFgKICApICU+JQogIHQKY29sbmFtZXMoZjApIDwtIGNvbG5hbWVzKHBlW1sxXV0pCmBgYAoKNC4gU2V0dXAgUUZlYXR1cmVzIG9iamVjdCBhbmQgcGVyZm9ybSBNU3FSb2IgYW5hbHlzaXMKCmBgYHtyIHdhcm5pbmcgPSBGQUxTRSwgbWVzc2FnZSA9IEZBTFNFfQpzaW1zIDwtIHJlYWRRRmVhdHVyZXMoZjAgJT4lIGFzLmRhdGEuZnJhbWUsIGVjb2wgPSAxOm4sIG5hbWUgPSAic2ltMCIpCmNvbERhdGEoc2ltcykgPC0gY29sRGF0YShwZSkKc2ltcyA8LSBtc3Fyb2Iob2JqZWN0ID0gc2ltcywgaSA9ICJzaW0wIiwgZm9ybXVsYSA9IH4gbG9jYXRpb24qdGlzc3VlICsgcGF0aWVudCkKc2ltcyA8LSBoeXBvdGhlc2lzVGVzdChvYmplY3QgPSBzaW1zLCBpID0gInNpbTAiLCBjb250cmFzdCA9IEwpCmBgYAoKIyMjIEV2YWx1YXRlICBwdmFsdWVzICB1bmRlciBIXzAKCmBgYHtyfQp2b2xjYW5vIDwtIGdncGxvdChyb3dEYXRhKHNpbXNbWyJzaW0wIl1dKSR0aXNzdWVWLAogICAgICAgICAgICAgICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gcHZhbCA8IDAuMDUpKSArCiBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArIHRoZW1lX21pbmltYWwoKQp2b2xjYW5vCmBgYAoKTnVtYmVyIG9mIGZhbHNlIHBvc2l0aXZlcyB3aXRob3V0IG11bHRpcGxlIHRlc3Rpbmc/CgpgYGB7cn0Kcm93RGF0YShzaW1zW1sic2ltMCJdXSkkdGlzc3VlViAlPiUKICBmaWx0ZXIocHZhbCA8MC4wNSkgJT4lCiAgbnJvdwptZWFuKHJvd0RhdGEoc2ltc1tbInNpbTAiXV0pJHRpc3N1ZVYkcHZhbCA8IDAuMDUpICAgIApoaXN0KHJvd0RhdGEoc2ltc1tbInNpbTAiXV0pJHRpc3N1ZVYkcHZhbCxtYWluID0gInNpbXVsYXRpb24gSDAiKQpgYGAKCgotIFRoZSBwLXZhbHVlcyBhcmUgdW5pZm9ybSEKLSBBbGwgcC12YWx1ZXMgdW5kZXIgdGhlIG51bGwgYXJlIGVxdWFsbHkgbGlrZWx5LgotIFN0YXRpc3RpY2FsIGh5cHRoZXNpcyB0ZXN0aW5nIGxlYWRzIHRvIGEgdW5pZm9ybSB0ZXN0IHN0cmF0ZWd5IHVuZGVyICRIXzAkCi0gSWYgdXNlIHAtdmFsdWUgY3V0b2ZmIGF0IDAuMDUgd2UgZXhwZWN0IHRvIHJldHVybiA1JSBvZiB0aGUgbm9uLURFIHByb3RlaW5zICBhcyBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQ6IG1hbnkgZmFsc2UgcG9zaXRpdmVzIGNhbiBiZSBleHBlY3RlZCEKCgojIyBQdmFsdWUgZGlzdHJpYnV0aW9uIGluIHJlYWwgZXhwZXJpbWVudAoKYGBge3J9Cmhpc3Qocm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJHRpc3N1ZVYkcHZhbCwgbWFpbiA9ICJyZWFsRGF0YSIpCmBgYAoKLSBBIG1peHR1cmUgb2YgbnVsbCBwcm90ZWlucyAobm9uLURFKTogdW5pZm9ybSwgYW5kLCBERSBwcm90ZWluczogZW5yaWNobWVudCBvZiBwLXZhbHVlcyBhdCBsb3cgcC12YWx1ZXMKCgojIENvcnJlY3Rpb24gZm9yIG11bHRpcGxlIHRlc3RpbmcKCi0gV2UgY2FuIGFkanVzdCB0aGUgcC12YWx1ZXMgZm9yIG11bHRpcGxlIHRlc3RpbmcuCgojIyBGYW1pbHkgd2lzZSBlcnJvciByYXRlIGNvcnJlY3Rpb246CgotIEEgbGlzdCBvZiByZXR1cm5lZCBwcm90ZWlucyBpcyBjb25zaWRlcmVkIHRvIGJlIGluIGVycm9yIGFzIHNvb24gYXMgaXQgY29udGFpbnMgYXQgbW9zdCBvbmUgZmFsc2UgcG9zaXRpdmUgcHJvdGVpbi4KCi0gJFx0ZXh0e0ZXRVJ9ID0gUChGUCBcbGVxIDEpJAoKLSBGV0VSOiBwcm9iYWJpbGl0eSBvZiBtYWtpbmcgYXQgbGVhc3Qgb25lIGZhbHNlIHBvc2l0aXZlIGRlY2lzaW9uIG9yCnByb2JhYmlsaXR5IHRvIGRlY2xhcmUgYXQgbGVhc3Qgb25lIHByb3RlaW4gZGlmZmVyZW50aWFsbHkgYWJ1bmRhbnQgd2hpY2ggaXMgdHJ1bHkgbm9uIGRpZmZlcmVudGlhbGx5IGFidW5kYW50CgojIyMgQm9uZmVycm9uaSBtZXRob2QKCi0gU2ltcGxlIG1ldGhvZAotICRtJCB0ZXN0cyBhcmUgcGVyZm9ybWVkIGF0IHRoZSBsZXZlbCAkXGFscGhhL20kCi0gRldFUiRcbGVxXHN1bVxsaW1pdHNfe3A9MX1ee219UChyZWplY3QgSF97MHB9XHZlcnQgSF97MHB9XHRleHR7IGlzIHRydWV9KT1tIFxhbHBoYS9tPVxhbHBoYSQKLSBQcm92aWRlcyBzdHJvbmcgY29udHJvbAotIEJvbmZlcnJvbmkgaXMgdmVyeSBjb25zZXJ2YXRpdmUKLSBXb3JrcyBmb3IgZGVwZW5kZW50IHRlc3RzCi0gQWRqdXN0ZWQgcC12YWx1ZTogJFx0aWxkZXtwfV9wPVxtaW4obVwgcF9wLDEpJAoKLS0tCgojIyMjIEJvbmZlcnJvbmkgaW4gcHJhY3Rpc2UKClZpYSBSIGZ1bmN0aW9ucwoKYGBge3J9CnBhZGogPC0gcC5hZGp1c3QoCiAgcm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJHRpc3N1ZVYkcHZhbCwKICBtZXRob2QgPSAiYm9uZmVycm9uaSIpCmBgYAoKT3duIEltcGxlbWVudGF0aW9uOiBhZGp1c3QgYW5kIG1ha2Ugc3VyZSB0aGF0IHAtdmFsdWUgaXMgc21hbGxlciB0aGFuIDEuCgpgYGB7cn0KbSA8LSBzdW0oIWlzLm5hKHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSR0aXNzdWVWJHB2YWwpKQpwYWRqU2VsZiA8LSAgcm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJHRpc3N1ZVYkcHZhbCAqIG0KcGFkalNlbGZbcGFkalNlbGYgPiAxXSA8LSAxCgpyYW5nZShwYWRqIC0gcGFkalNlbGYsIG5hLnJtID0gVFJVRSkKYGBgCiMjIyMgSWxsdXN0cmF0aW9uIGluIHNpbXVsYXRpb24gdW5kZXIgJEhfMCQgYW5kIGhlYXJ0IGNhc2Ugc3R1ZHkKCmBgYHtyfQp2b2xjYW5vIDwtIGdncGxvdChyb3dEYXRhKHNpbXNbWyJzaW0wIl1dKSR0aXNzdWVWLAogICAgICAgICAgICAgICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gcC5hZGp1c3QocHZhbCwiYm9uZmVycm9uaSIpIDwgMC4wNSkpICsKIGdlb21fcG9pbnQoY2V4ID0gMi41KSArCiBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYWxwaGEoYygiYmxhY2siLCAicmVkIiksIDAuNSkpICsKIHRoZW1lX21pbmltYWwoKSArCiBnZ3RpdGxlKCJzaW11bGF0ZWQgaGVhcnQgZGF0YSB1bmRlciBIMCIpCnZvbGNhbm8KYGBgCgotIE5vIGZhbHNlIHBvc2l0aXZlcyBhcmUgcmV0dXJuZWQgZm9yIHNpbXVsYXRpb24gdW5kZXIgSF8wLiBMaXN0IGlzIGNvcnJlY3QgYWNjb3JkaW5nIHRvIEZXRVIuCgpgYGB7cn0Kdm9sY2FubyA8LSBnZ3Bsb3Qocm93RGF0YShwZVtbInByb3RlaW5Sb2J1c3QiXV0pJHRpc3N1ZVYsCiAgICAgICAgICAgICAgICAgYWVzKHggPSBsb2dGQywgeSA9IC1sb2cxMChwdmFsKSwgY29sb3IgPSBwLmFkanVzdChwdmFsLCJib25mZXJyb25pIikgPCAwLjA1KSkgKwogZ2VvbV9wb2ludChjZXggPSAyLjUpICsKIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogdGhlbWVfbWluaW1hbCgpICsKIGdndGl0bGUoInJlYWwgaGVhcnQgZGF0YSIpCnZvbGNhbm8KYGBgCgotIFZlcnkgZmV3IHByb3RlaW5zIGFyZSByZXR1cm5lZCBmb3IgcmVhbCBkYXRhLiBWZXJ5IGNvbnNlcnZhdGl2ZSEKCiMjIyBGV0VSOiBzdGVwIGRvd24gbWV0aG9kIG9mIEhvbG0KCi0gQ29tcGFyZSBzbWFsbGVzdCBwLXZhbHVlIHdpdGggJFxhbHBoYS9tJAotIElmIHlvdSBjYW4gcmVqZWN0IHRoZSBzbWFsbGVzdCBwLXZhbHVlIGF0ICRcYWxwaGEvbSQgbGV2ZWwKICAtIGFzc2VzIHNlY29uZCBzbWFsbGVzdCBwLXZhbHVlIGF0IHRoZSAkXGFscGhhLyhtLTEpJAotIElmIHlvdSBjYW4gcmVqZWN0IHRoZSBzZWNvbmQgc21hbGxlc3QgcC12YWx1ZSBhdCAkXGFscGhhLyhtLTEpJCBsZXZlbAogICAgLSBhc3NlcyB0aGlyZCBzbWFsbGVzdCBwLXZhbHVlIGF0IHRoZSAkXGFscGhhLyhtLTIpJAotIC4uLgotIElmIHlvdSBjYW4gcmVqZWN0IHRoZSBrLTEgc21hbGxlc3QgcC12YWx1ZSBhdCAkXGFscGhhLyhtLWsrMikkIGxldmVsCiAgLSBhc3NlcyBrIHNtYWxsZXN0IHAtdmFsdWUgYXQgdGhlICRcYWxwaGEvKG0taysxKSQgbGV2ZWwKLSBjb250aW51IGFzIGxvbmcgYXMgeW91IGNhbiByZWplY3QuCgpUaGUgSG9sbSBpcyBhIHN0ZXAgZG93biBtZXRob2QgKGZyb20gbW9yZSB0byBsZXNzIHNpZ25pZmljYW50KSB0aGF0IGNvcnJlY3RzIGluIGVhY2ggc3RlcCBmb3IgdGhlIG51bWJlciBvZiBudWxsIGh5cG90aGVzaXMgdGhhdCB5b3Ugc3RpbGwgY2FuIGZhbHNlbHkgcmVqZWN0LgoKLS0tCgpBZGp1c3RlZCBwLXZhbHVlczoKCi0gT3JkZXIgcC12YWx1ZXMgd2l0aCAkKGspJCB0aGUgJGtee3RofSQgc21hbGxlc3QgcC12YWx1ZSAgCi0gJFx0aWxkZXtwfV97KGspfT1cbWluKHBfeyhrKX0obS1rKzEpLDEpJAoKU3VwcG9zZSAyIHRlc3RzOiAkcF97KDEpfT0wLjAwMSQsICRwX3soMil9PTAuMDAxNSQKJFxyaWdodGFycm93JCAkXHRpbGRle3B9X3soMSl9PTAuMDAyJCwgJFx0aWxkZXtwfV97KDIpfT0wLjAwMTUkCgotIFByb2JsZW06IE1vbm90b25pY2l0eSBpcyBub3QgdGhlIHNhbWUgYXMgZm9yIG9yaWdpbmFsIHAtdmFsdWVzIQotIEVuZm9yY2UgbW9ub3RvbmljaXR5OgokXHRpbGRle3B9X3soayl9PVxtYXhcbGltaXRzX3toPTEsXGxkb3RzLGt9XG1pbihwX3soaCl9KG0taCsxKSwxKSQKCi0tLQoKIyMjIyBIb2xtIGV4YW1wbGUgIAoKV2l0aCBSIGZ1bmN0aW9uczoKCmBgYHtyfQpwYWRqIDwtIHAuYWRqdXN0KAogIHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSR0aXNzdWVWJHB2YWwsCiAgbWV0aG9kID0gImhvbG0iKQpgYGAKCk93biBpbXBsZW1lbnRhdGlvbgoKMS4gT3JkZXIgcC12YWx1ZXMKYGBge3J9CnBhZGpTZWxmIDwtICByb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkdGlzc3VlViRwdmFsCm9yZCA8LSBvcmRlcihwYWRqU2VsZikKcE9yZCA8LSBwYWRqU2VsZltvcmRdCm0gPC0gc3VtKCFpcy5uYShwYWRqU2VsZikpCmBgYAoKMi4gQWRqdXN0IG9yZGVyZWQgcC12YWx1ZXMgYW5kIGVuc3VyZSB0aGF0IHZhbHVlIGlzIG5vdCBsYXJnZXIgdGhhbiAxCmBgYHtyfQpwT3JkWzE6bV0gPC0gcE9yZFsxOm1dKihtIC0gKDE6bSkgKyAxKQpwT3JkW3BPcmQ+MV0gPC0gMQpgYGAKCjMuIE1vbm90b25pY2l0eQpgYGB7cn0KcG1heCA8LSBwT3JkWzFdCmZvciAoaSBpbiAyOm0pCnsKICBpZiAocE9yZFtpXSA+IHBtYXgpCiAgICBwbWF4IDwtIHBPcmRbaV0gZWxzZQogICAgcE9yZFtpXSA8LSBwbWF4Cn0KYGBgCgo0LiBQdXQgYWRqdXN0ZWQgcC12YWx1ZXMgaW4gb3JpZ2luYWwgb3JkZXIKYGBge3J9CnBhZGpTZWxmW29yZF0gPC0gcE9yZApyYW5nZShwYWRqIC0gcGFkalNlbGYsIG5hLnJtID0gVFJVRSkKYGBgCgojIyMjIElsbHVzdHJhdGlvbiBpbiBzaW11bGF0aW9uIHVuZGVyICRIXzAkIGFuZCBoZWFydCBjYXNlIHN0dWR5CgpgYGB7cn0Kdm9sY2FubyA8LSBnZ3Bsb3Qocm93RGF0YShzaW1zW1sic2ltMCJdXSkkdGlzc3VlViwKICAgICAgICAgICAgICAgICBhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IHAuYWRqdXN0KHB2YWwsImhvbG0iKSA8IDAuMDUpKSArCiBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArCiB0aGVtZV9taW5pbWFsKCkgKwogZ2d0aXRsZSgic2ltdWxhdGVkIGhlYXJ0IGRhdGEgdW5kZXIgSDAiKQp2b2xjYW5vCmBgYAoKLSBObyBmYWxzZSBwb3NpdGl2ZXMgYXJlIHJldHVybmVkIGZvciBzaW11bGF0aW9uIHVuZGVyIEhfMC4gTGlzdCBpcyBjb3JyZWN0IGFjY29yZGluZyB0byBGV0VSLgoKYGBge3J9CnZvbGNhbm8gPC0gZ2dwbG90KHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSR0aXNzdWVWLAogICAgICAgICAgICAgICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gcC5hZGp1c3QocHZhbCwiaG9sbSIpIDwgMC4wNSkpICsKIGdlb21fcG9pbnQoY2V4ID0gMi41KSArCiBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYWxwaGEoYygiYmxhY2siLCAicmVkIiksIDAuNSkpICsKIHRoZW1lX21pbmltYWwoKSArCiBnZ3RpdGxlKCJyZWFsIGhlYXJ0IGRhdGEiKQp2b2xjYW5vCmBgYAoKLSBWZXJ5IGZldyBwcm90ZWlucyBhcmUgcmV0dXJuZWQgZm9yIHJlYWwgZGF0YS4gU3RpbGwgdmVyeSBjb25zZXJ2YXRpdmUhCgoKIyMgRmFsc2UgZGlzY292ZXJ5IHJhdGUKCi0gQWRqdXN0ZWQgUC12YWx1ZXMgd2l0aCB0aGUgQmVuamFtaW5pIEhvY2hiZXJnIGNvcnJlY3Rpb24gY29ycmVzcG9uZCB0byB0aGUgZXN0aW1hdGVkIEZEUiBvZiB0aGUgc2V0IHRoYXQgaXMgcmV0dXJuZWQgd2hlbiB0aGUgc2lnbmlmaWNhbmNlIGxldmVsIGlzIHNldCBhdCB0aGlzIHRocmVzaG9sZC4KXGJlZ2lue2VxbmFycmF5fQpGRFIocF8wKSAmPSYgXHRleHR7RX1cbGVmdFtcZnJhY3tGUH17KEZQICsgVFApfVxyaWdodF1cXAomXGFwcHJveCZcZnJhY3twXzAgXHRpbWVzIG19e1wjcF9wIFxsZXEgcF8wfVxcClxlbmR7ZXFuYXJyYXl9CgpTbyBhZGp1c3RlZCBwLXZhbHVlIGZvciBwcm90ZWluIGogZXF1YWxzClxbXHRpbGRlIHBfaiA9IFxmcmFje3BfezAsan0gXHRpbWVzIG19e1wjcF9wIFxsZXEgcF97MCxqfX1cXQoKSG93ZXZlciwgdGhlIEZEUiBhbHdheXMgaGFzIHRvIGJlIGJldHdlZW4gMCBhbmQgMSBzbzoKClxbXHRpbGRlIHBfaiA9IFxtaW5cbGVmdFtcZnJhY3twX3swLGp9IFx0aW1lcyBtfXtcI3BfcCBcbGVxIHBfezAsan19LDFccmlnaHRdXF0KCmFuZCB0aGUgYWRqdXN0ZWQgcC12YWx1ZXMgc2hvdWxkIHJlbWFpbiBpbiB0aGUgc2FtZSBvcmRlciBhcyB0aGUgb3JpZ2luYWwgcC12YWx1ZXMuCgpcW1x0aWxkZSBwX2ogPSAgXG1pblxsaW1pdHNfe1xmb3JhbGwgazogcF9rID4gcF9qfSBcbWluXGxlZnRbXGZyYWN7cF97MCxrfSBcdGltZXMgbX17XCNwX3AgXGxlcSBwX3swLGt9fSwxXHJpZ2h0XVxdCgoxLiBPcmRlciBwdmFsdWVzCmBgYHtyfQpwdmFscyA8LSByb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkdGlzc3VlViRwdmFsCm5hSW5kIDwtIGlzLm5hKHB2YWxzKQpwSGxwIDwtIHB2YWxzWyFuYUluZF0Kb3JkIDwtIHBIbHAgJT4lIG9yZGVyCnBIbHAgPC0gcEhscFtvcmRdCmBgYAoKMi4gQWRqdXN0IG9yZGVyZWQgcC12YWx1ZXMKYGBge3J9CnBIbHAgPC0gcEhscCpsZW5ndGgocEhscCkvKDE6bGVuZ3RoKHBIbHApKQpgYGAKCjMuIEVuc3VyZSBhZGp1c3QgcC12YWx1ZXMgYXJlIHNtYWxsZXIgYXJlIGVxdWFsIHRoYW4gMQpgYGB7cn0KcEhscFtwSGxwPjFdIDwtIDEKYGBgCgo0LiBNb25vdG9uaWNpdHkgY29uc3RyYWludApgYGB7cn0KcG1pbiA8LSBwSGxwW2xlbmd0aChwSGxwKV0KZm9yIChqIGluIChsZW5ndGgocEhscCktMSk6MSkKewogIGlmIChwSGxwW2pdIDwgcG1pbikKICAgIHBtaW4gPC0gcEhscFtqXSBlbHNlCiAgICBwSGxwW2pdIDwtIHBtaW4gICAKfQpgYGAKCjUuIFB1dCBwLXZhbHVlcyBiYWNrIGluIG9yaWdpbmFsIG9yZGVyCgpgYGB7cn0KcEhscFtvcmRdIDwtIHBIbHAKcEFkaiA8LSBwdmFscwpwQWRqWyFuYUluZF0gPC0gcEhscAoKaGVhZChwQWRqKQpoZWFkKHJvd0RhdGEocGVbWyJwcm90ZWluUm9idXN0Il1dKSR0aXNzdWVWKQpyYW5nZShyb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkdGlzc3VlViRhZGpQdmFsIC0gcEFkaixuYS5ybT1UUlVFKQpgYGAKCiMjIyMgSWxsdXN0cmF0aW9uIGluIHNpbXVsYXRpb24gdW5kZXIgJEhfMCQgYW5kIGhlYXJ0IGNhc2Ugc3R1ZHkKCmBgYHtyfQp2b2xjYW5vIDwtIGdncGxvdChyb3dEYXRhKHNpbXNbWyJzaW0wIl1dKSR0aXNzdWVWLAogICAgICAgICAgICAgICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpKSArCiBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArCiB0aGVtZV9taW5pbWFsKCkgKwogZ2d0aXRsZSgic2ltdWxhdGVkIGhlYXJ0IGRhdGEgdW5kZXIgSDAiKQp2b2xjYW5vCmBgYAoKLSBObyBmYWxzZSBwb3NpdGl2ZXMgYXJlIHJldHVybmVkIGZvciBzaW11bGF0aW9uIHVuZGVyIEhfMC4gTGlzdCBpcyBjb3JyZWN0IGFjY29yZGluZyB0byBGV0VSLgotIEl0IGNhbiBiZSBzaG93biB0aGF0IHRoZSBGRFItbWV0aG9kIGNvbnRyb2xzIHRoZSBGV0VSIHdoZW4gJEhfMCQgaXMgdHJ1ZSBmb3IgYWxsIGZlYXR1cmVzLiAgIAoKCmBgYHtyfQp2b2xjYW5vIDwtIGdncGxvdChyb3dEYXRhKHBlW1sicHJvdGVpblJvYnVzdCJdXSkkdGlzc3VlViwKICAgICAgICAgICAgICAgICBhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IGFkalB2YWwgPCAwLjA1KSkgKwogZ2VvbV9wb2ludChjZXggPSAyLjUpICsKIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogdGhlbWVfbWluaW1hbCgpICsKIGdndGl0bGUoInJlYWwgaGVhcnQgZGF0YSIpCnZvbGNhbm8KYGBgCgpUaGUgRkRSIG1ldGhvZCBhbGxvd3MgdXMgdG8gcmV0dXJuIG11Y2ggbG9uZ2VyIERBIHByb3RlaW4gbGlzdHMgYXQgdGhlIGV4cGVuc2Ugb2YgYSBmZXcgZmFsc2UgcG9zaXRpdmVzLgpUaGUgRkRSIGNvbnRyb2xzIHRoZSBmcmFjdGlvbiBvZiBmYWxzZSBwb3NpdGl2ZXMgaW4gdGhlIGxpc3QgdGhhdCB5b3UgcmV0dXJuIG9uIGF2ZXJhZ2Ugb24gdGhlIHNpZ25pZmljYW5jZSBsZXZlbCB0aGF0IGlzIGFkb3B0ZWQuClNvIGlmIHlvdSB1c2UgJFxhbHBoYT0wLjA1JCB3ZSBleHBlY3Qgb24gYXZlcmFnZSA1JSBvZiBmYWxzZSBwb3NpdGl2ZXMgaW4gdGhlIGxpc3QgdGhhdCB3ZSByZXR1cm4uCg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("technicalDetailsProteomics.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
