<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Koen Van den Berge" />


<title>Sequencing: Working with count data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SGA21</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="sequencing_intro.html">Sequencing - Introduction to sequencing</a>
    </li>
    <li>
      <a href="sequencing_countData.html">Sequencing - Working with count data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/SGA21">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Sequencing: Working with count data</h1>
<h4 class="author">Koen Van den Berge</h4>
<h4 class="date">7/5/2021</h4>

</div>


<div id="the-poisson-distribution" class="section level1">
<h1><span class="header-section-number">1</span> The Poisson distribution</h1>
<ul>
<li>The Poisson distribution is a typical count distribution that is generally popular and fairly easy to work with. It is defined by a single parameter: its mean <span class="math inline">\(\mu\)</span>. For a Poisson distributed random variable <span class="math inline">\(Y_i\)</span> with observations <span class="math inline">\(i \in \{1, \ldots, n\}\)</span>, its variance is equal to its mean. That is, if <span class="math inline">\(Y_i \sim Poi(\mu)\)</span>, then <span class="math inline">\(E(Y_i) = Var(Y_i) = \mu\)</span>.</li>
<li>This immediately shows an important feature of count data: the <strong>mean-variance relationship</strong>. Indeed, in count data, the variance will always be a function of the mean.</li>
<li>This is quite intuitive. Consider the following example. You have two bird cages, where in one bird cage there are <span class="math inline">\(10\)</span> birds, while in the other there are <span class="math inline">\(100\)</span> birds. You let a sample of people count the number of birds in either one of the cages. It seems unlikely that a person in front of the 10-bird cage would come up with an estimate of <span class="math inline">\(5\)</span>, while it seems quite likely that someone in front of the 100-bird cage would come up with an estimate of <span class="math inline">\(95\)</span>. Even though the difference from the true value is the same, the exact value has an impact on the plausible deviation around it.</li>
</ul>
<p><strong>TODO</strong>: Make into discrete barplot.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>y1 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">500</span>, <span class="dt">lambda=</span><span class="dv">10</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>y2 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">500</span>, <span class="dt">lambda=</span><span class="dv">100</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">hist</span>(y1, <span class="dt">main=</span><span class="st">&quot;Poisson(10)&quot;</span>, <span class="dt">breaks=</span><span class="dv">40</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">hist</span>(y2, <span class="dt">main=</span><span class="st">&quot;Poisson(100)&quot;</span>, <span class="dt">breaks=</span><span class="dv">40</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div id="the-poisson-distribution-in-rna-seq" class="section level2">
<h2><span class="header-section-number">1.1</span> The Poisson distribution in RNA-seq</h2>
<ul>
<li>In RNA-seq, technical replicates represent different aliquots of the same sample being repeatedly. The underlying true expression of a gene can hence safely be assumed to be equal across these technical replicates.</li>
<li><a href="https://genome.cshlp.org/content/18/9/1509">Marioni <em>et al.</em> (2008)</a> have shown that, for most genes, the distribution of observed gene expression counts across technical replicates follow a Poisson distribution. A small proportion of genes (<span class="math inline">\(\sim 0.5\%\)</span>) do not follow this Poisson model, however, and actually show evidence for <em>`extra-Poisson variation’</em>.</li>
</ul>
<div class="figure">
<img src="images_sequencing/marioniFigs_cropped.png" alt="" />
<p class="caption">Figure: Technical replication in RNA-seq. Figures from Marioni et al. (2008).</p>
</div>
</div>
<div id="relative-uncertainty-for-poisson-distributed-random-variables" class="section level2">
<h2><span class="header-section-number">1.2</span> Relative uncertainty for Poisson distributed random variables</h2>
<p>Take a minute to consider the following question:</p>
<ul>
<li>Suppose that we have a solid tumor sample from a cancer patient, as well as a sample of surrounding healthy tissue. For each sample, we have three technical replicates at our disposal. Let <span class="math inline">\(Y_{grt}\)</span> denote the observed gene expression values of gene <span class="math inline">\(g\)</span> in replicate <span class="math inline">\(r\)</span> from tissue <span class="math inline">\(t \in \{0,1\}\)</span>, where <span class="math inline">\(t=0\)</span> denotes healthy tissue and <span class="math inline">\(t=1\)</span> denotes tumoral tissue.</li>
<li>We then know that the random variables <span class="math inline">\(Y_{gr0}\)</span> and <span class="math inline">\(Y_{gr1}\)</span> follow a Poisson distribution, and we would estimate its mean as <span class="math inline">\(\bar{Y}_{g0} = \frac{1}{3} \sum_{r=1}^3 Y_{gr0}\)</span> and <span class="math inline">\(\bar{Y}_{g1} = \frac{1}{3} \sum_{r=1}^3 Y_{gr1}\)</span>, respectively.</li>
<li>Similar, for another gene <span class="math inline">\(k\)</span>, we observe <span class="math inline">\(Y_{krt}\)</span>, and estimate <span class="math inline">\(\bar{Y}_{k0}\)</span> and <span class="math inline">\(\bar{Y}_{k1}\)</span> correspondingly.</li>
<li>Now suppose that <span class="math inline">\(\beta_{k} = \bar{Y}_{k1} / \bar{Y}_{k0} = 5\)</span>, but also <span class="math inline">\(\beta_g = \bar{Y}_{g1} / \bar{Y}_{g0} = 5\)</span>, i.e., the two genes have the same average expression ratio (also often called a fold-change) across samples. However, they are differently expressed as <span class="math inline">\(\bar{Y}_{k1} = 100\)</span>, and <span class="math inline">\(\bar{Y}_{g1} = 10\)</span> (making <span class="math inline">\(\bar{Y}_{k0} = 20\)</span>, and <span class="math inline">\(\bar{Y}_{g0} = 2\)</span>).</li>
<li>For which of the two genes is the uncertainty on the expression ratio the highest? In other words, do we trust <span class="math inline">\(\beta_k\)</span> more or do we trust <span class="math inline">\(\beta_g\)</span> more?</li>
</ul>
<hr />
<p>Let’s approximate the uncertainty in <span class="math inline">\(beta_g\)</span> and <span class="math inline">\(\beta_k\)</span> using simulation:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>N &lt;-<span class="st"> </span><span class="fl">1e3</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>beta_g &lt;-<span class="st"> </span>beta_k &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length=</span>N)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb2-4"><a href="#cb2-4"></a>  ygr1 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">3</span>, <span class="dt">lambda=</span><span class="dv">10</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>  ygr0 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">3</span>, <span class="dt">lambda=</span><span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>  ykr1 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">3</span>, <span class="dt">lambda=</span><span class="dv">100</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>  ykr0 &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n=</span><span class="dv">3</span>, <span class="dt">lambda=</span><span class="dv">20</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a>  beta_g[ii] &lt;-<span class="st"> </span><span class="kw">mean</span>(ygr1) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(ygr0)</span>
<span id="cb2-9"><a href="#cb2-9"></a>  beta_k[ii] &lt;-<span class="st"> </span><span class="kw">mean</span>(ykr1) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(ykr0)</span>
<span id="cb2-10"><a href="#cb2-10"></a>}</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="kw">hist</span>(beta_g, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dt">by=</span><span class="dv">1</span>), <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">hist</span>(beta_k, <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dt">by=</span><span class="dv">1</span>), <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<hr />
<p>We clearly see that the uncertainty on <span class="math inline">\(\beta_g\)</span> is much lower than on <span class="math inline">\(\beta_k\)</span>. Even though the variance on the counts of gene <span class="math inline">\(g\)</span> is higher, since its mean is higher and it is distributed as a Poisson variable. How do we explain this?</p>
<ul>
<li>We may explain this by considering the relative uncertainty on the mean. Relative uncertainty can be defined as the coefficient of variation <span class="math inline">\(CV = \frac{\sigma}{\mu}\)</span> (this is, the standard deviation divided by the mean). Indeed, the CV describes the relative deviation of the distribution relative to its mean, where a low CV indicates low dispersion with respect to the mean.</li>
<li>Calculating the CV shows that <strong>the relative uncertainty for gene <span class="math inline">\(k\)</span> than for gene <span class="math inline">\(g\)</span>, even though the variance on the raw counts is higher for gene <span class="math inline">\(k\)</span> than for gene <span class="math inline">\(g\)</span></strong>.</li>
<li>This lower relative uncertainty on the mean then propagates further to a lower uncertainty on the fold-change. This basic result will be essential for understanding the results of a differential expression analysis!</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">sqrt</span>(<span class="dv">100</span>)<span class="op">/</span><span class="dv">100</span> <span class="co">#CV for gene k</span></span></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">sqrt</span>(<span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span> <span class="co">#CV for gene g</span></span></code></pre></div>
<pre><code>## [1] 0.3162278</code></pre>
</div>
</div>
<div id="modeling-count-data-generalized-linear-models" class="section level1">
<h1><span class="header-section-number">2</span> Modeling count data: Generalized linear models</h1>
<p>Just like we have modeled protein abundances in the proteomics part of this course to assess differential protein abundance, we can model gene expression counts to identify genes with differences in average expression between groups of samples.</p>
<div id="why-we-cant-use-linear-models-to-model-count-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Why we can(’t) use linear models to model count data</h2>
<ul>
<li>If we’re using a linear model to model a response <span class="math inline">\(Y_i\)</span>, with <span class="math inline">\(i \in \{1, \ldots, n\}\)</span> in function of a single covariate <span class="math inline">\(X_i\)</span>, the linear model can be defined as follows:</li>
</ul>
<p><span class="math display">\[
\left\{
\begin{array}{ccc}
Y_i &amp; = &amp; \beta_0 + \beta_1 X_i + \epsilon_i \\
Y_i | X_i &amp; \sim &amp; N(\beta_0 + \beta_1 X_i, \sigma^2 \mathbf{I}).
\end{array}
\right.
\]</span></p>
<ul>
<li>Or, equivalently, in matrix form we would write <span class="math display">\[
  \left\{
  \begin{array}{ccc}
  Y_i &amp; = &amp; \mathbf{X}^T_i \mathbf{\beta} + \epsilon_i \\
  Y_i | \mathbf{X}_i &amp; \sim &amp; N(\mathbf{X}^T_i \beta, \sigma^2 \mathbf{I}),
  \end{array}
  \right.
  \]</span> where <span class="math inline">\(\mathbf{X}\)</span> now represents our <span class="math inline">\(n \times p\)</span> design matrix, with row <span class="math inline">\(i\)</span> corresponding to observation <span class="math inline">\(i\)</span>.</li>
</ul>
<hr />
<ul>
<li>The variance-covariance matrix of <span class="math inline">\(\mathbf{Y}\)</span> is assumed a diagonal matrix with <span class="math inline">\(\sigma^2\)</span> on the diagonal elements and zero everywhere else. This means that the data points are uncorrelated, and that every observation has the same variance <span class="math inline">\(\sigma^2\)</span>, also referred to as homoscedasticity. The latter obviously doesn’t hold for count data, due to the mean-variance relationship. This makes linear models unsuitable to model count data.</li>
</ul>
</div>
<div id="generalized-linear-models" class="section level2">
<h2><span class="header-section-number">2.2</span> Generalized linear models</h2>
<ul>
<li>As the name suggests, generalized linear models (GLMs) extend linear models. In GLMs, we extend two things with respect to the linear model:
<ul>
<li>The <strong>conditional distribution of the response variable <span class="math inline">\(Y_i | X_i\)</span></strong> can be assumed to follow any distribution that belongs to the <strong>exponential family</strong> of distributions, which includes the Gaussian but also other commonly known distributions, such as the Binomial, Gamma and Poisson distribution.</li>
<li>The linear model assumed a linear relationship between <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(X_i\)</span>, since we assumed that <span class="math inline">\(E(Y_i | X_i) = \mathbf{X}^T_i \mathbf{\beta}\)</span>. In GLMs, we will allow a <strong>link function</strong> <span class="math inline">\(g()\)</span> that links the conditional mean to the covariates. Hence, in GLMs we have that <span class="math inline">\(g(E(Y_i | X_i)) = \mathbf{X}^T_i \mathbf{\beta}\)</span>. Note that each family has got a canonical link function, which is the identity link function <span class="math inline">\(g(\mu) = \mu\)</span> for Gaussian, the log link function <span class="math inline">\(g(\mu) = \log \mu\)</span> for Poisson, or the logit link function <span class="math inline">\(g(\mu) = \log(\frac{\mu}{1-\mu})\)</span> for Binomial.</li>
</ul></li>
</ul>
<hr />
<ul>
<li>Remember that for a linear model we have a closed-form solution for estimating the regression coefficients <span class="math inline">\(\mathbf{\beta}\)</span>, i.e., <span class="math inline">\(\hat{\mathbf{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\)</span>.</li>
<li>Fitting a GLM is much harder, however, since for many distributions that belong to the exponential family, the variance depends on the mean, and this mean-variance relationship must be taken into account.</li>
<li>The <strong>iterative reweighted least squares (IRLS)</strong> algorithm is usually adopted for fitting GLMs. As the name suggests, it is an iterative algorithm (so no closed-form solutions!), where each data point is reweighted in each iteration according to its variance, which is a function of its estimated mean of the previous iteration. Indeed, observations with high variance will be downweighted and vice versa.</li>
<li>The objective function used in the IRLS algorithm is the log-likelihood of the data under the posited model. This function is being maximized with respect to the regression coefficients <span class="math inline">\(\mathbf{\beta}\)</span> to find a solution <span class="math inline">\(\hat{\mathbf{\beta}}\)</span>.</li>
<li>In the absence of a mean-variance relationship (such as is the case with the Gaussian distribution), the IRLS algorithm reduces to the closed-form solutions of a linear model.</li>
</ul>
<div id="a-poisson-glm" class="section level3">
<h3><span class="header-section-number">2.2.1</span> A Poisson GLM</h3>
<ul>
<li>We can define a Poisson GLM as follows <span class="math display">\[
  \left\{
  \begin{array}{ccc}
  Y_i &amp; \sim &amp; Poi(\mu_i) \\
  \log \mu_i &amp; = &amp; \eta_i \\
  \eta_i &amp; = &amp; \mathbf{X}^T_i \mathbf{\beta} \\
  \end{array}
  \right.
  \]</span> where <span class="math inline">\(Y_i\)</span> is the response variable, with mean <span class="math inline">\(\mu_i\)</span>, <span class="math inline">\(\eta_i\)</span> is the linear predictor, <span class="math inline">\(\mathbf{X}\)</span> is the <span class="math inline">\(n \times p\)</span> model matrix and <span class="math inline">\(\mathbf{\beta}\)</span> is the <span class="math inline">\(p \times 1\)</span> matrix of regression coefficients.</li>
<li>It is insightful to compare this model to a linear model where <span class="math inline">\(Y_i\)</span> is log-transformed. Indeed, in the linear model case, we would be modeling <span class="math inline">\(E(\log Y_i )\)</span>, while in the GLM we are modeling <span class="math inline">\(\log E(Y_i)\)</span>.</li>
<li>This shows that in the GLM setting we are modeling a transformed version of the expected value, and after retransforming we can interpret the fit in terms of the mean of our response variable. In the transformed linear model, however, we are working with the expected value of a transformed version of our response variable, and we will not be able to interpret the fit in terms of the mean (because <span class="math inline">\(E( \log Y_i) \ne \log E(Y_i)\)</span>. In this specific case, we would have to resort to interpreting changes in terms of a geometric mean.</li>
<li>Also note that <span class="math inline">\(\mathbf{X}^T_i \mathbf{\beta} \in ]-\infty, \infty[\)</span>, while <span class="math inline">\(Y_i\)</span> must be non-negative <span class="math inline">\([0, \infty[\)</span>. The link function helps with this, since the exponential function transforms any real number to a non-negative number, i.e., <span class="math inline">\(\exp(\mathbf{X}^T_i \mathbf{\beta}) \in [0, \infty[\)</span>.</li>
</ul>
</div>
<div id="generalized-linear-models-in-r" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Generalized linear models in <code>R</code></h3>
<p>Goals: - Fit Poisson GLM on bike data - Use it to explain GLM output - Use it to interpret coefficients: show importance of link - Then look at assumptions and pinpoint overdispersion. Solution will be for next lecture.</p>
<ul>
<li><p>In order to get familiar with GLMs, we will fit a Poisson GLM in <code>R</code>, using the <code>Bikeshare</code> dataset as part of the <code>ISLR2</code> package. This dataset records how many bikes were being used from a bike-sharing service, every hour of the day over a full year (365 days).</p></li>
<li><p>Full information of the dataset is provided <a href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset">here</a>. Variables of interest for us are:</p>
<ul>
<li><p><code>bikers</code>: Discrete count variable; the number of bikes being used that hour.</p></li>
<li><p><code>hum</code>: Continuous variable ranging between 0 and 1; normalized humidity.</p></li>
<li><p><code>hr</code>: Categorical variable between 0 and 23; the hour of the day. Note that one could also consider this variable to be numeric and model it as such.</p></li>
<li><p><code>weathersit</code>: Categorical variable; the weather condition of that hour, with</p>
<ol style="list-style-type: decimal">
<li>Clear, Few clouds, Partly cloudy.</li>
<li>Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist.</li>
<li>Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds.</li>
<li>Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog.</li>
</ol></li>
</ul></li>
</ul>
<hr />
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># if ISLR2 isn&#39;t installed, install it:</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;ISLR2&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="dv">1</span>]){</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="kw">install.packages</span>(<span class="st">&quot;ISLR2&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>}</span></code></pre></div>
<pre><code>## Installing package into &#39;/Users/runner/work/_temp/Library&#39;
## (as &#39;lib&#39; is unspecified)</code></pre>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpLD1wkd/downloaded_packages</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># load and preview the dataset:</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">data</span>(<span class="st">&quot;Bikeshare&quot;</span>, <span class="dt">package=</span><span class="st">&quot;ISLR2&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">head</span>(Bikeshare)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["season"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mnth"],"name":[2],"type":["fct"],"align":["left"]},{"label":["day"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["hr"],"name":[4],"type":["fct"],"align":["left"]},{"label":["holiday"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["weekday"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["workingday"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["weathersit"],"name":[8],"type":["fct"],"align":["left"]},{"label":["temp"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["atemp"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["hum"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["windspeed"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["casual"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["registered"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["bikers"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Jan","3":"1","4":"0","5":"0","6":"6","7":"0","8":"clear","9":"0.24","10":"0.2879","11":"0.81","12":"0.0000","13":"3","14":"13","15":"16","_rn_":"1"},{"1":"1","2":"Jan","3":"1","4":"1","5":"0","6":"6","7":"0","8":"clear","9":"0.22","10":"0.2727","11":"0.80","12":"0.0000","13":"8","14":"32","15":"40","_rn_":"2"},{"1":"1","2":"Jan","3":"1","4":"2","5":"0","6":"6","7":"0","8":"clear","9":"0.22","10":"0.2727","11":"0.80","12":"0.0000","13":"5","14":"27","15":"32","_rn_":"3"},{"1":"1","2":"Jan","3":"1","4":"3","5":"0","6":"6","7":"0","8":"clear","9":"0.24","10":"0.2879","11":"0.75","12":"0.0000","13":"3","14":"10","15":"13","_rn_":"4"},{"1":"1","2":"Jan","3":"1","4":"4","5":"0","6":"6","7":"0","8":"clear","9":"0.24","10":"0.2879","11":"0.75","12":"0.0000","13":"0","14":"1","15":"1","_rn_":"5"},{"1":"1","2":"Jan","3":"1","4":"5","5":"0","6":"6","7":"0","8":"cloudy/misty","9":"0.24","10":"0.2576","11":"0.75","12":"0.0896","13":"0","14":"1","15":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># association with weather on count and log scale</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">barplot</span>(<span class="kw">table</span>(Bikeshare<span class="op">$</span>weathersit))</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">boxplot</span>(bikers <span class="op">~</span><span class="st"> </span>weathersit, <span class="dt">data=</span>Bikeshare,</span>
<span id="cb12-2"><a href="#cb12-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Weather&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Bikers&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">boxplot</span>(<span class="kw">log1p</span>(bikers) <span class="op">~</span><span class="st"> </span>weathersit, <span class="dt">data=</span>Bikeshare,</span>
<span id="cb13-2"><a href="#cb13-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Weather&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Log (bikers +1)&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-3.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># association with humidity on count and log scale</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">hist</span>(Bikeshare<span class="op">$</span>hum, <span class="dt">breaks=</span><span class="dv">40</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-4.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">plot</span>(bikers <span class="op">~</span><span class="st"> </span>hum, <span class="dt">data=</span>Bikeshare, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb15-2"><a href="#cb15-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Humidity&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Bikers&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>loHum &lt;-<span class="st"> </span><span class="kw">loess</span>(bikers <span class="op">~</span><span class="st"> </span>hum, <span class="dt">data=</span>Bikeshare)</span>
<span id="cb15-4"><a href="#cb15-4"></a>xGrid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span><span class="dv">50</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>yhat &lt;-<span class="st"> </span><span class="kw">predict</span>(loHum, <span class="kw">data.frame</span>(<span class="dt">hum =</span> xGrid))</span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="kw">lines</span>(<span class="dt">x=</span>xGrid, <span class="dt">y=</span>yhat, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-5.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">plot</span>(<span class="kw">log1p</span>(bikers) <span class="op">~</span><span class="st"> </span>hum, <span class="dt">data=</span>Bikeshare, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb16-2"><a href="#cb16-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Humidity&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Log (bikers +1)&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>loHum &lt;-<span class="st"> </span><span class="kw">loess</span>(<span class="kw">log1p</span>(bikers) <span class="op">~</span><span class="st"> </span>hum, <span class="dt">data=</span>Bikeshare)</span>
<span id="cb16-4"><a href="#cb16-4"></a>xGrid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span><span class="dv">50</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a>yhat &lt;-<span class="st"> </span><span class="kw">predict</span>(loHum, <span class="kw">data.frame</span>(<span class="dt">hum =</span> xGrid))</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="kw">lines</span>(<span class="dt">x=</span>xGrid, <span class="dt">y=</span>yhat, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-6.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># association with hour on count and log scale</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">barplot</span>(<span class="kw">table</span>(Bikeshare<span class="op">$</span>hr))</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-7.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">plot</span>(bikers <span class="op">~</span><span class="st"> </span>hr, <span class="dt">data=</span>Bikeshare, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb18-2"><a href="#cb18-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Hour of day&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Bikers&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-8.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">plot</span>(<span class="kw">log1p</span>(bikers) <span class="op">~</span><span class="st"> </span>hr, <span class="dt">data=</span>Bikeshare, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb19-2"><a href="#cb19-2"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Hour of day&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Log (bikers +1)&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-5-9.png" width="672" /></p>
<p>The data exploration shows that</p>
<ul>
<li>More bikes are being used when the weather is better.</li>
<li>There seems to be a non-linear association between bicycle rentals and humidity, where in both low and high humidity conditions relatively few bikes are used, possibly reflecting very hot and very wet days respectively, while most bikes are being used at moderate humidity.</li>
<li>Bicycle rental is associated to the hour of the day, however, in a non-linear way, with clear peaks in usage at typical commute hours (6h-8h and 17h-19h). Here, we will add <code>hr</code> as a categorical variable to the model, estimating one parameter for each hour. However, note that this may not be the most efficient approach statistically, as one may be able to incorporate <code>hr</code> as a numerical variable and model the non-linearity using a lower number of parameters.</li>
<li><em>Disclaimer</em>: Note that there are likely interactions between the variables, which here we will not evaluate as our goal is to introduce a Poisson GLM rather than a full analysis of the <code>Bikeshare</code> dataset. For example, it seems likely that more people commute by bike in good weather, while fewer people will commute by bike in terrible weather. This would motivate an interaction between the variables <code>weathersit</code> and <code>hr</code>.</li>
</ul>
<hr />
<ul>
<li>Below, we fit a Poisson GLM using the <code>glm</code> function. The number of bikers is used as a response variable, which is modeled as a function of <code>weathersit</code>, <code>hum</code> and <code>hr</code>.</li>
<li>Note that there seems to be a non-linear, though fairly simple, association between our response variable and the humidity. We will therefore add a quadratic term for humidity to the model. In order to avoid multicollinearity between the linear and quadratic humidity effects, we will first center the humidity variable and store this in a new variable called <code>humc</code>. This means that when <code>humc=0</code>, this corresponds to the average humidity in the dataset.</li>
<li>The argument <code>family = "poisson"</code> specifies the Poisson distribution for the response variable and by default the canonical link function, which is the log link, will be used.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>Bikeshare<span class="op">$</span>humc &lt;-<span class="st"> </span>Bikeshare<span class="op">$</span>hum <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Bikeshare<span class="op">$</span>hum)</span>
<span id="cb20-2"><a href="#cb20-2"></a>m &lt;-<span class="st"> </span><span class="kw">glm</span>(bikers <span class="op">~</span><span class="st"> </span>weathersit <span class="op">+</span><span class="st"> </span>humc <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(humc<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(humc<span class="op">^</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>hr,</span>
<span id="cb20-3"><a href="#cb20-3"></a>         <span class="dt">data =</span> Bikeshare,</span>
<span id="cb20-4"><a href="#cb20-4"></a>         <span class="dt">family =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="kw">summary</span>(m)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = bikers ~ weathersit + humc + I(humc^2) + I(humc^3) + 
##     hr, family = &quot;poisson&quot;, data = Bikeshare)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -23.3408   -4.6201   -0.9922    3.4605   27.4153  
## 
## Coefficients:
##                            Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)                3.893651   0.008083  481.708   &lt;2e-16 ***
## weathersitcloudy/misty    -0.146618   0.002277  -64.401   &lt;2e-16 ***
## weathersitlight rain/snow -0.556153   0.004585 -121.292   &lt;2e-16 ***
## weathersitheavy rain/snow -1.855194   0.166742  -11.126   &lt;2e-16 ***
## humc                       0.091751   0.009233    9.938   &lt;2e-16 ***
## I(humc^2)                 -2.233919   0.029421  -75.929   &lt;2e-16 ***
## I(humc^3)                 -1.823066   0.091428  -19.940   &lt;2e-16 ***
## hr1                       -0.476470   0.012999  -36.654   &lt;2e-16 ***
## hr2                       -0.806959   0.014646  -55.099   &lt;2e-16 ***
## hr3                       -1.433648   0.018842  -76.090   &lt;2e-16 ***
## hr4                       -2.058714   0.024796  -83.027   &lt;2e-16 ***
## hr5                       -1.061695   0.016074  -66.051   &lt;2e-16 ***
## hr6                        0.315691   0.010607   29.761   &lt;2e-16 ***
## hr7                        1.317856   0.009052  145.586   &lt;2e-16 ***
## hr8                        1.830026   0.008653  211.480   &lt;2e-16 ***
## hr9                        1.352135   0.009022  149.871   &lt;2e-16 ***
## hr10                       1.129497   0.009271  121.831   &lt;2e-16 ***
## hr11                       1.308554   0.009102  143.766   &lt;2e-16 ***
## hr12                       1.522234   0.008947  170.131   &lt;2e-16 ***
## hr13                       1.536827   0.008959  171.542   &lt;2e-16 ***
## hr14                       1.499506   0.008999  166.633   &lt;2e-16 ***
## hr15                       1.535043   0.008974  171.062   &lt;2e-16 ***
## hr16                       1.745128   0.008800  198.318   &lt;2e-16 ***
## hr17                       2.140488   0.008565  249.925   &lt;2e-16 ***
## hr18                       2.037740   0.008588  237.279   &lt;2e-16 ***
## hr19                       1.711545   0.008747  195.667   &lt;2e-16 ***
## hr20                       1.393901   0.008976  155.284   &lt;2e-16 ***
## hr21                       1.132543   0.009216  122.895   &lt;2e-16 ***
## hr22                       0.882534   0.009537   92.539   &lt;2e-16 ***
## hr23                       0.481354   0.010207   47.157   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1052921  on 8644  degrees of freedom
## Residual deviance:  375265  on 8615  degrees of freedom
## AIC: 428362
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div id="interpretation-of-estimated-model-parameters" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Interpretation of estimated model parameters</h4>
<ul>
<li>Remember that the Poisson GLM can be defined as <span class="math display">\[
  \left\{
  \begin{array}{ccc}
  Y_i &amp; \sim &amp; Poi(\mu_i) \\
  \log \mu_i &amp; = &amp; \eta_i \\
  \eta_i &amp; = &amp; \mathbf{X}^T_i \mathbf{\beta} \\
  \end{array}
  \right.
  \]</span></li>
</ul>
<p><em>Interpretation of the intercept.</em></p>
<ul>
<li>We will first interpret the intercept, in terms of the average number of bikes being used. Note that the intercept corresponds to hour 0, at good weather (<code>weathersit</code> level 1), and average humidity. We will denote the intercept as <span class="math inline">\(\beta_0\)</span> and its estimate, given the data, as <span class="math inline">\(\hat{\beta}_0\)</span>. All other coefficients will thus denote a relative change with respect to that reference level.</li>
<li>The model definition shows that <span class="math inline">\(\log \mu_i = \mathbf{X}^T_i \mathbf{\beta}\)</span>, with <span class="math inline">\(\mu\)</span> the average number of bikes being used. Since we’re only working with the intercept here, we may write <span class="math inline">\(\log \mu_i = \beta_0\)</span>, and thus <span class="math inline">\(\mu_i = \exp \beta_0\)</span>.</li>
<li>Plugging in the estimated intercept <span class="math inline">\(\hat{\beta}_0\)</span>, we have <span class="math inline">\(\exp \hat{\beta}_0 =\)</span> 49.09. In other words, in clear weather with few clouds, at zero humidity and at hour 0, an average of <span class="math inline">\(40.82\)</span> bikes are being used.</li>
</ul>
<hr />
<p><em>Interpretation of <code>weathersitcloudy/misty</code>.</em></p>
<ul>
<li>We will denote this coefficient as <span class="math inline">\(\beta_1\)</span> and its estimate as <span class="math inline">\(\hat{\beta}_1\)</span>.</li>
<li>Note that this coefficient defines the difference in linear predictor between <code>weathersit=2</code> and <code>weathersit=1</code>, all other variables being equal (say, at their reference level). Indeed, define <span class="math inline">\(\eta_{w2}\)</span> and <span class="math inline">\(\eta_{w1}\)</span> to denote the linear predictor at <code>weathersit=2</code>, and <code>weathersit=1</code>, respectively. Then, <span class="math inline">\(\eta_{w2} - \eta_{w1} = (\beta_0 + \beta_1) - \beta_0 = \beta_1\)</span>.</li>
<li>This also means that <span class="math inline">\(\beta_1 = \log \mu_{w2} - \log \mu_{w1} = \log \frac{\mu_{w2}}{\mu_{21}}\)</span>, and thus <span class="math inline">\(\exp \beta_1 = \frac{\mu_{w2}}{\mu_{21}}\)</span>.</li>
<li>In our case, <span class="math inline">\(\exp \hat{\beta}_1 =\)</span> 0.86. In words: All other variables being equal, the average number of bikes being used in cloudy/misty weather is <span class="math inline">\(0.85\)</span> times (or, also, <span class="math inline">\(85\%\)</span> of) the number of bikes being used in good weather.</li>
<li>This exercise has shown us that, due to the <span class="math inline">\(\log\)</span> link function, the parameters in a Poisson GLM cannot be interpreted in terms of absolute differences in averages of the response variable but instead must be interpreted in terms of multiplicative differences!</li>
<li>If you’re in a meeting and you need a quick way to interpret these parameters, remember that <span class="math inline">\(exp(1) = 2.72 \approx 3\)</span> and thus an estimated coefficient of <span class="math inline">\(1\)</span> (<span class="math inline">\(-1\)</span>) means the average of the response variable is about three times higher (lower).</li>
</ul>
<hr />
<p><em>Interpretation of the humidity effect.</em></p>
<ul>
<li>The humidity effect is a bit more involved to interpret. Due to the quadratic and cubic terms, we cannot interpret the linear term separately (nor can we interpret the quadratic or cubic term separately); we must interpret both the linear, quadratic and cubic term simultaneously.</li>
<li>Also due to the higher-order terms, the rate of change in average bikers will not be constant across the range of humidity. We can therefore not interpret the humidity effect using a single number as we’ve done previously.</li>
<li>We can, however, provide some examples for specific humidity values, along with a visualization of its global effect.</li>
<li>For example, let’s derive the change in average bikes being used at a humidity that is <span class="math inline">\(0.2\)</span> above average, versus average humidity. For average humidity <span class="math inline">\(+0.2\)</span> the linear predictor <span class="math inline">\(\eta_{0.2} = \beta_0 + \beta_4 x_{hum} + \beta_5 x_{hum}^2 + \beta_6 x_{hum}^3 = \beta_0 + \beta_4 0.2 + \beta_5 0.2^2 + \beta_6 0.2^3\)</span>. For average humidity, the linear predictor <span class="math inline">\(\eta_{0} = \beta_0 + \beta_4 x_{hum} + \beta_5 x_{hum}^2 + \beta_6 x_{hum}^3 = \beta_0 + \beta_4 0 + \beta_5 0^2 + \beta_6 0^3 = \beta_0\)</span>. We thus have <span class="math inline">\(\log \frac{\mu_{0.2}}{\mu_0} = \beta_4 0.2 + \beta_5 0.2^2 + \beta_6 0.2^3\)</span>. In our case, <span class="math inline">\(\log \frac{\hat{\mu}_{0.2}}{\hat{\mu}_0} = 0.091751*0.2 - 2.233919 * 0.2^2 - 1.823066 * 0.2^3 = -0.0856\)</span> and thus <span class="math inline">\(\frac{\hat{\mu}_{0.2}}{\hat{\mu}_0} = 0.92\)</span>. Therefore, at humidity that is <span class="math inline">\(0.2\)</span> above average, the average number of bikes being used are <span class="math inline">\(0.92\)</span> times the average number of bikes used at average humidity.</li>
<li>Just like with linear models, the <code>predict</code> function is extremely helpful when trying to visualize and understand a fitted GLM. In GLMs, the <code>type</code> argument becomes essential when using the <code>predict</code> function. Indeed, by default, estimates are provided on the linear predictor scale: in our case, on the <span class="math inline">\(\log\)</span> scale. If we’d like predictions on the scale of the response variable, we need to set <code>type="response"</code>. You can find more information in the help file using <code>?predict.glm</code>.</li>
<li>The visualization shows that the highest number of bikes are being used at around average humidity, with a decreased usage at higher and lower humidities.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>humidityGrid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(Bikeshare<span class="op">$</span>humc), <span class="kw">max</span>(Bikeshare<span class="op">$</span>humc), </span>
<span id="cb22-2"><a href="#cb22-2"></a>                    <span class="dt">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>newDf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">weathersit =</span> <span class="kw">factor</span>(<span class="st">&quot;clear&quot;</span>),</span>
<span id="cb22-4"><a href="#cb22-4"></a>                    <span class="dt">hr =</span> <span class="kw">factor</span>(<span class="dv">8</span>),</span>
<span id="cb22-5"><a href="#cb22-5"></a>                    <span class="dt">humc =</span> humidityGrid,</span>
<span id="cb22-6"><a href="#cb22-6"></a>                    <span class="st">&quot;I(humc^2)&quot;</span> =<span class="st"> </span>humidityGrid<span class="op">^</span><span class="dv">2</span>,</span>
<span id="cb22-7"><a href="#cb22-7"></a>                    <span class="st">&quot;I(humc^3)&quot;</span> =<span class="st"> </span>humidityGrid<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb22-8"><a href="#cb22-8"></a>yhat &lt;-<span class="st"> </span><span class="kw">predict</span>(m, </span>
<span id="cb22-9"><a href="#cb22-9"></a>                <span class="dt">newdata =</span> newDf,</span>
<span id="cb22-10"><a href="#cb22-10"></a>                <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="kw">plot</span>(<span class="dt">x =</span> humidityGrid,</span>
<span id="cb22-13"><a href="#cb22-13"></a>     <span class="dt">y =</span> yhat,</span>
<span id="cb22-14"><a href="#cb22-14"></a>     <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>,</span>
<span id="cb22-15"><a href="#cb22-15"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Centered humidity&quot;</span>,</span>
<span id="cb22-16"><a href="#cb22-16"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Average number of bikers&quot;</span>)</span></code></pre></div>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<hr />
<p><em>Setting up a contrast.</em></p>
<ul>
<li>Suppose we’re interested in whether there are more bikers at (A) maximum humidity (centered humidity value of <span class="math inline">\(0.357\)</span>), hour 17, in the <code>light rain/snow</code> weather category, versus (B) average humidity, hour 8, in the <code>clear</code> weather category. This requires us to set up a contrast in terms of a linear combination of the model parameters.</li>
<li><strong>Manually</strong>: <span class="math display">\[ \log \mu_A = \beta_0 + \beta_2 x_{rainSnow} + \beta_4 x_{hum} + \beta_5 x_{hum}^2 + \beta_6 x_{hum}^3 + \beta_{23} x_{hr17} \\= 3.894 - 0.556 + 0.092 * 0.357 - 2.234 * 0.357^2 - 1.823 * 0.357^3 + 2.140 = 5.143.\\
\log \mu_B = \beta_0 + \beta_{14} x_{hr8} = 3.894 + 1.830 = 5.724.\\
\frac{\mu_A}{\mu_B} = \exp(5.143 - 5.724) = 0.559.
\]</span> Thus, at maximum humidity, hour 17, in the <code>light rain/snow</code> weather category the average number of bikers is 56% times the average number of bikers in the average humidity, hour 8, in the <code>clear</code> weather category.</li>
<li><strong>Manually in <code>R</code></strong>: We can also use matrix multiplication to derive the estimates. We know from our manual calculations above, that the contrast of interest is <span class="math inline">\((\beta_0 + \beta_2 x_{rainSnow} + \beta_4 x_{hum} + \beta_5 x_{hum}^+ \beta_6 x_{hum}^3 + \beta_{23} x_{hr17}) - (\beta_0 + \beta_{14} x_{hr8})\)</span>. We can store this in a contrast matrix, and then multiply it with the coefficients of our model:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>L &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, </span>
<span id="cb23-2"><a href="#cb23-2"></a>            <span class="dt">nrow =</span> <span class="kw">length</span>(<span class="kw">coef</span>(m)),</span>
<span id="cb23-3"><a href="#cb23-3"></a>            <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="kw">rownames</span>(L) &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">coef</span>(m))</span>
<span id="cb23-5"><a href="#cb23-5"></a>L[<span class="st">&quot;weathersitlight rain/snow&quot;</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>L[<span class="st">&quot;humc&quot;</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">0.357</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>L[<span class="st">&quot;I(humc^2)&quot;</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">0.357</span><span class="op">^</span><span class="dv">2</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>L[<span class="st">&quot;I(humc^3)&quot;</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">0.357</span><span class="op">^</span><span class="dv">3</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>L[<span class="st">&quot;hr17&quot;</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>L[<span class="st">&quot;hr8&quot;</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>L</span></code></pre></div>
<pre><code>##                                  [,1]
## (Intercept)                0.00000000
## weathersitcloudy/misty     0.00000000
## weathersitlight rain/snow  1.00000000
## weathersitheavy rain/snow  0.00000000
## humc                       0.35700000
## I(humc^2)                  0.12744900
## I(humc^3)                  0.04549929
## hr1                        0.00000000
## hr2                        0.00000000
## hr3                        0.00000000
## hr4                        0.00000000
## hr5                        0.00000000
## hr6                        0.00000000
## hr7                        0.00000000
## hr8                       -1.00000000
## hr9                        0.00000000
## hr10                       0.00000000
## hr11                       0.00000000
## hr12                       0.00000000
## hr13                       0.00000000
## hr14                       0.00000000
## hr15                       0.00000000
## hr16                       0.00000000
## hr17                       1.00000000
## hr18                       0.00000000
## hr19                       0.00000000
## hr20                       0.00000000
## hr21                       0.00000000
## hr22                       0.00000000
## hr23                       0.00000000</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>beta &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">coef</span>(m), <span class="dt">ncol=</span><span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">exp</span>(<span class="kw">t</span>(L) <span class="op">%*%</span><span class="st"> </span>beta) <span class="co"># equals our manual calculation.</span></span></code></pre></div>
<pre><code>##           [,1]
## [1,] 0.5595652</code></pre>
<ul>
<li><strong>Using <code>predict</code> in <code>R</code></strong>:</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># set up data frames with relevant predictor variables&#39; values.</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>dfA &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">weathersit =</span> <span class="kw">factor</span>(<span class="st">&quot;light rain/snow&quot;</span>),</span>
<span id="cb27-3"><a href="#cb27-3"></a>                    <span class="dt">hr =</span> <span class="kw">factor</span>(<span class="dv">17</span>),</span>
<span id="cb27-4"><a href="#cb27-4"></a>                    <span class="dt">humc =</span> <span class="fl">0.357</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>                    <span class="st">&quot;I(humc^2)&quot;</span> =<span class="st"> </span><span class="fl">0.357</span><span class="op">^</span><span class="dv">2</span>,</span>
<span id="cb27-6"><a href="#cb27-6"></a>                    <span class="st">&quot;I(humc^3)&quot;</span> =<span class="st"> </span><span class="fl">0.357</span><span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb27-7"><a href="#cb27-7"></a>dfB &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">weathersit =</span> <span class="kw">factor</span>(<span class="st">&quot;clear&quot;</span>),</span>
<span id="cb27-8"><a href="#cb27-8"></a>                    <span class="dt">hr =</span> <span class="kw">factor</span>(<span class="dv">8</span>),</span>
<span id="cb27-9"><a href="#cb27-9"></a>                    <span class="dt">humc =</span> <span class="dv">0</span>,</span>
<span id="cb27-10"><a href="#cb27-10"></a>                    <span class="st">&quot;I(humc^2)&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>                    <span class="st">&quot;I(humc^3)&quot;</span> =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co"># calculate estimated average number of bikers</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>yhatA &lt;-<span class="st"> </span><span class="kw">predict</span>(m, </span>
<span id="cb27-15"><a href="#cb27-15"></a>                <span class="dt">newdata =</span> dfA,</span>
<span id="cb27-16"><a href="#cb27-16"></a>                <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb27-17"><a href="#cb27-17"></a>yhatB &lt;-<span class="st"> </span><span class="kw">predict</span>(m, </span>
<span id="cb27-18"><a href="#cb27-18"></a>                <span class="dt">newdata =</span> dfB,</span>
<span id="cb27-19"><a href="#cb27-19"></a>                <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb27-20"><a href="#cb27-20"></a></span>
<span id="cb27-21"><a href="#cb27-21"></a>yhatA <span class="op">/</span><span class="st"> </span>yhatB <span class="co"># also equal to above.</span></span></code></pre></div>
<pre><code>##         1 
## 0.5595652</code></pre>
<hr />
<p><strong>Exercise</strong>: try to derive the change in average number of bikers between (a) humidity of 0.1 above average, clear weather (<code>weathersit=1</code>), at hour 10 and (b) humidity of 0.1 below average, cloudy weather (<code>weathersit=2</code>), at hour 20, using all three methods.</p>
</div>
<div id="model-deviance-residuals-and-goodness-of-fit" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Model deviance, residuals and goodness-of-fit</h4>
<ul>
<li>In linear models, we often use residuals <span class="math inline">\(e_i = y_i - \hat{\mu}_i\)</span> to check model assumptions (linearity, homoscedasticity). However, in a GLM setting, we know that the variance of our residuals will depend on the mean, i.e., <span class="math inline">\(Var(\epsilon_i) = f(\mu_i)\)</span>. Using ordinary residuals such as <span class="math inline">\(e_i\)</span> therefore is no longer appropriate.</li>
<li>We have seen that the objective function that is used to fit a GLM is the log-likelihood of the data under the posited model. For example, the log likelihood of a Poisson GLM with response variable <span class="math inline">\(\mathbf{Y}\)</span>, with elements <span class="math inline">\(Y_i, i \in \{1, \ldots, n\}\)</span> and model matrix <span class="math inline">\(\mathbf{X}\)</span> is <span class="math display">\[ \ell(\mathbf{Y};  \mathbf{\beta}) = \log \prod_{i=1}^n \left( \frac{\exp (\mathbf{X}_i^T \mathbf{\beta})^{Y_i} \exp( - \exp(\mathbf{X}_i^T \mathbf{\beta}))}{Y_i!} \right) = \sum_{i=1}^n \log \left( \frac{\exp(\mathbf{X}_i^T \mathbf{\beta})^{Y_i} \exp( - \exp(\mathbf{X}_i^T \mathbf{\beta}))}{Y_i!} \right) \\ = \sum_{i=1}^n Y_i (\mathbf{X}_i^T \mathbf{\beta}) + \exp(\mathbf{X}_i^T \mathbf{\beta})  - \log Y_i!. \]</span> The estimates <span class="math inline">\(\hat{\mathbf{\beta}}\)</span> are then found by maximizing <span class="math inline">\(\ell(\mathbf{\beta} | \mathbf{Y}, \mathbf{X} )\)</span> with respect to <span class="math inline">\(\mathbf{\beta}\)</span>. This is analogous to maximizing a Gaussian likelihood in the linear model setting.</li>
<li>A goodness-of-fit measure used in the GLM setting is then the <strong>residual deviance</strong>, that is twice the difference in log-likelihood between a ‘saturated model’ and the current model. Here, a saturated model, is a model where we fit one parameter per data point and therefore fit the data perfectly, in other words <span class="math inline">\(\hat{\mu}_i = y_i\)</span>. This is, <span class="math display">\[ 2 * \left\{ \ell(\mathbf{Y};  \mathbf{\beta} | \hat{\mu}_i = y_i) - \ell(\mathbf{Y};  \mathbf{\beta} | \hat{\mu}_i = \exp(\mathbf{X}_i^T \mathbf{\beta})) \right\}.\]</span></li>
<li>A low residual deviance can thus be interpreted as a model that is fitting the data well, since your current model will be close in log-likelihood to the saturated model. The deviance is a very useful statistic that is also important in statistical inference and model selection, e.g., for testing if a smaller model fits significantly worse than a larger model.</li>
<li>Finally, a <strong>deviance residual</strong> <span class="math inline">\(D_i\)</span> can then be defined as the square root of the contribution of the <span class="math inline">\(i\)</span>th datum to the residual deviance <span class="math display">\[ D_i = \sqrt{ 2* \left\{ \ell(\mathbf{Y};  \mathbf{\beta} | \hat{\mu}_i = y_i) - \ell(\mathbf{Y};  \mathbf{\beta} | \hat{\mu}_i = \exp(\mathbf{X}_i^T \mathbf{\beta})) \right\} } \]</span></li>
</ul>
<p><strong>Exercise</strong>: See if you can come up with the residual deviance that is reported in the summary of our model above. Also check if you can recover the correct deviance residuals by calculating them yourself. You can get the deviance residuals in <code>R</code> by <code>resid(m, type="deviance")</code>.</p>
</div>
</div>
</div>
<div id="overdispersion" class="section level2">
<h2><span class="header-section-number">2.3</span> Overdispersion</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">library</span>(MASS)</span>
<span id="cb29-2"><a href="#cb29-2"></a>m &lt;-<span class="st"> </span><span class="kw">glm.nb</span>(bikers <span class="op">~</span><span class="st"> </span>weathersit <span class="op">+</span><span class="st"> </span>hum <span class="op">+</span><span class="st"> </span>hr,</span>
<span id="cb29-3"><a href="#cb29-3"></a>         <span class="dt">data =</span> Bikeshare)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="kw">summary</span>(m)</span></code></pre></div>
<pre><code>## 
## Call:
## glm.nb(formula = bikers ~ weathersit + hum + hr, data = Bikeshare, 
##     init.theta = 2.390699586, link = log)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.9691  -0.9332  -0.1646   0.5012   5.2091  
## 
## Coefficients:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                3.64207    0.04649  78.334  &lt; 2e-16 ***
## weathersitcloudy/misty    -0.16140    0.01757  -9.184  &lt; 2e-16 ***
## weathersitlight rain/snow -0.69553    0.02826 -24.613  &lt; 2e-16 ***
## weathersitheavy rain/snow -2.06808    0.66910  -3.091    0.002 ** 
## hum                        0.26576    0.04562   5.825 5.71e-09 ***
## hr1                       -0.47649    0.04995  -9.539  &lt; 2e-16 ***
## hr2                       -0.80343    0.05068 -15.853  &lt; 2e-16 ***
## hr3                       -1.43821    0.05243 -27.431  &lt; 2e-16 ***
## hr4                       -2.06572    0.05504 -37.529  &lt; 2e-16 ***
## hr5                       -1.07629    0.05112 -21.055  &lt; 2e-16 ***
## hr6                        0.30646    0.04936   6.208 5.35e-10 ***
## hr7                        1.32138    0.04897  26.984  &lt; 2e-16 ***
## hr8                        1.85945    0.04890  38.023  &lt; 2e-16 ***
## hr9                        1.39286    0.04904  28.402  &lt; 2e-16 ***
## hr10                       1.15904    0.04924  23.537  &lt; 2e-16 ***
## hr11                       1.33625    0.04937  27.066  &lt; 2e-16 ***
## hr12                       1.54463    0.04954  31.182  &lt; 2e-16 ***
## hr13                       1.55491    0.04971  31.282  &lt; 2e-16 ***
## hr14                       1.52081    0.04979  30.543  &lt; 2e-16 ***
## hr15                       1.54852    0.04980  31.094  &lt; 2e-16 ***
## hr16                       1.76237    0.04968  35.477  &lt; 2e-16 ***
## hr17                       2.17811    0.04947  44.026  &lt; 2e-16 ***
## hr18                       2.07910    0.04936  42.122  &lt; 2e-16 ***
## hr19                       1.75246    0.04917  35.643  &lt; 2e-16 ***
## hr20                       1.42493    0.04910  29.023  &lt; 2e-16 ***
## hr21                       1.15080    0.04903  23.470  &lt; 2e-16 ***
## hr22                       0.89518    0.04907  18.243  &lt; 2e-16 ***
## hr23                       0.49554    0.04919  10.073  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(2.3907) family taken to be 1)
## 
##     Null deviance: 26318.1  on 8644  degrees of freedom
## Residual deviance:  9315.3  on 8617  degrees of freedom
## AIC: 93328
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  2.3907 
##           Std. Err.:  0.0369 
## 
##  2 x log-likelihood:  -93269.5260</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">plot</span>(m)</span></code></pre></div>
<pre><code>## Warning: not plotting observations with leverage one:
##   586</code></pre>
<p><img src="sequencing_countData_files/figure-html/unnamed-chunk-10-1.png" width="672" /><img src="sequencing_countData_files/figure-html/unnamed-chunk-10-2.png" width="672" /><img src="sequencing_countData_files/figure-html/unnamed-chunk-10-3.png" width="672" /><img src="sequencing_countData_files/figure-html/unnamed-chunk-10-4.png" width="672" /></p>
</div>
</div>
<div id="a-final-note-and-summary" class="section level1">
<h1><span class="header-section-number">3</span> A final note and summary</h1>
<p><img src="images_sequencing/xkcd-1725-linear_regression_2x.png" /><!-- --></p>
</div>
<div id="references" class="section level1">
<h1><span class="header-section-number">4</span> References</h1>
<ul>
<li><a href="https://genome.cshlp.org/content/18/9/1509">Marioni <em>et al.</em> (2008)</a> describe the distribution of gene expression counts across technical replicates, and in addition discuss lane effects in RNA-seq, as well as a comparison between RNA-seq and array-based platforms.</li>
<li>The count data chapter of Modern Statistics for Modern Biology by Wolfgang Huber and Susan Holmes handles similar topics also in the context of RNA-seq: <a href="https://www.huber.embl.de/msmb/Chap-CountData.html" class="uri">https://www.huber.embl.de/msmb/Chap-CountData.html</a></li>
</ul>
</div>
<div id="junk" class="section level1">
<h1><span class="header-section-number">5</span> Junk</h1>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># downloaded from https://epistat.wiv-isp.be/covid/ </span></span>
<span id="cb33-3"><a href="#cb33-3"></a>data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Downloads/COVID19BE_CASES_AGESEX.csv&quot;</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co"># remove rows with NA</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>data &lt;-<span class="st"> </span>data[<span class="op">!</span><span class="kw">apply</span>(data, <span class="dv">1</span> , <span class="cf">function</span>(x) <span class="kw">any</span>(<span class="kw">is.na</span>(x))),]</span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co"># convert to R Date format</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>data<span class="op">$</span>DATE &lt;-<span class="st"> </span><span class="kw">as.Date</span>(data<span class="op">$</span>DATE)</span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="co"># convert date to day of the week</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>data<span class="op">$</span>day &lt;-<span class="st"> </span><span class="kw">weekdays</span>(data<span class="op">$</span>DATE)</span>
<span id="cb33-10"><a href="#cb33-10"></a></span>
<span id="cb33-11"><a href="#cb33-11"></a>dataGrouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(data, DATE) <span class="op">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">nCases =</span> <span class="kw">sum</span>(CASES),</span>
<span id="cb33-13"><a href="#cb33-13"></a>            <span class="dt">day =</span> <span class="kw">unique</span>(day))</span>
<span id="cb33-14"><a href="#cb33-14"></a></span>
<span id="cb33-15"><a href="#cb33-15"></a><span class="kw">plot</span>(<span class="dt">x=</span>dataGrouped<span class="op">$</span>DATE, <span class="dt">y=</span>dataGrouped<span class="op">$</span>nCases,</span>
<span id="cb33-16"><a href="#cb33-16"></a>     <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb33-17"><a href="#cb33-17"></a></span>
<span id="cb33-18"><a href="#cb33-18"></a><span class="co"># less reporting on weekends</span></span>
<span id="cb33-19"><a href="#cb33-19"></a><span class="kw">plot</span>(<span class="dt">x=</span>dataGrouped<span class="op">$</span>DATE, <span class="dt">y=</span>dataGrouped<span class="op">$</span>nCases,</span>
<span id="cb33-20"><a href="#cb33-20"></a>     <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">col=</span><span class="kw">factor</span>(dataGrouped<span class="op">$</span>day))</span></code></pre></div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAnU2VxdWVuY2luZzogV29ya2luZyB3aXRoIGNvdW50IGRhdGEnCmF1dGhvcjogIktvZW4gVmFuIGRlbiBCZXJnZSIKZGF0ZTogIjcvNS8yMDIxIgpvdXRwdXQ6IAogIHBkZl9kb2N1bWVudDoKICAgIHRvYzogdHJ1ZQogICAgbnVtYmVyX3NlY3Rpb25zOiB0cnVlCiAgICBsYXRleF9lbmdpbmU6IHhlbGF0ZXgKICBodG1sX2RvY3VtZW50OgogICAgdG9jOiB0cnVlCiAgICB0b2NfZmxvYXQ6IHRydWUKICAgIHRvY19kZXB0aDogNAotLS0KCmBgYHtyIHNldHVwLCBpbmNsdWRlPUZBTFNFfQprbml0cjo6b3B0c19jaHVuayRzZXQoZWNobyA9IFRSVUUpCnN1cHByZXNzUGFja2FnZVN0YXJ0dXBNZXNzYWdlcyh7CiAgbGlicmFyeShrbml0cikKICBsaWJyYXJ5KHJtYXJrZG93bikKICBsaWJyYXJ5KGdncGxvdDIpCn0pCmBgYAoKCiMgVGhlIFBvaXNzb24gZGlzdHJpYnV0aW9uCgogLSBUaGUgUG9pc3NvbiBkaXN0cmlidXRpb24gaXMgYSB0eXBpY2FsIGNvdW50IGRpc3RyaWJ1dGlvbiB0aGF0IGlzIGdlbmVyYWxseSBwb3B1bGFyIGFuZCBmYWlybHkgZWFzeSB0byB3b3JrIHdpdGguIEl0IGlzIGRlZmluZWQgYnkgYSBzaW5nbGUgcGFyYW1ldGVyOiBpdHMgbWVhbiAkXG11JC4gRm9yIGEgUG9pc3NvbiBkaXN0cmlidXRlZCByYW5kb20gdmFyaWFibGUgJFlfaSQgd2l0aCBvYnNlcnZhdGlvbnMgJGkgXGluIFx7MSwgXGxkb3RzLCBuXH0kLCBpdHMgdmFyaWFuY2UgaXMgZXF1YWwgdG8gaXRzIG1lYW4uIFRoYXQgaXMsIGlmICRZX2kgXHNpbSBQb2koXG11KSQsIHRoZW4gJEUoWV9pKSA9IFZhcihZX2kpID0gXG11JC4KIC0gVGhpcyBpbW1lZGlhdGVseSBzaG93cyBhbiBpbXBvcnRhbnQgZmVhdHVyZSBvZiBjb3VudCBkYXRhOiB0aGUgKiptZWFuLXZhcmlhbmNlIHJlbGF0aW9uc2hpcCoqLiBJbmRlZWQsIGluIGNvdW50IGRhdGEsIHRoZSB2YXJpYW5jZSB3aWxsIGFsd2F5cyBiZSBhIGZ1bmN0aW9uIG9mIHRoZSBtZWFuLgogLSBUaGlzIGlzIHF1aXRlIGludHVpdGl2ZS4gQ29uc2lkZXIgdGhlIGZvbGxvd2luZyBleGFtcGxlLiBZb3UgaGF2ZSB0d28gYmlyZCBjYWdlcywgd2hlcmUgaW4gb25lIGJpcmQgY2FnZSB0aGVyZSBhcmUgJDEwJCBiaXJkcywgd2hpbGUgaW4gdGhlIG90aGVyIHRoZXJlIGFyZSAkMTAwJCBiaXJkcy4gWW91IGxldCBhIHNhbXBsZSBvZiBwZW9wbGUgY291bnQgdGhlIG51bWJlciBvZiBiaXJkcyBpbiBlaXRoZXIgb25lIG9mIHRoZSBjYWdlcy4gSXQgc2VlbXMgdW5saWtlbHkgdGhhdCBhIHBlcnNvbiBpbiBmcm9udCBvZiB0aGUgMTAtYmlyZCBjYWdlIHdvdWxkIGNvbWUgdXAgd2l0aCBhbiBlc3RpbWF0ZSBvZiAkNSQsIHdoaWxlIGl0IHNlZW1zIHF1aXRlIGxpa2VseSB0aGF0IHNvbWVvbmUgaW4gZnJvbnQgb2YgdGhlIDEwMC1iaXJkIGNhZ2Ugd291bGQgY29tZSB1cCB3aXRoIGFuIGVzdGltYXRlIG9mICQ5NSQuIEV2ZW4gdGhvdWdoIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHRydWUgdmFsdWUgaXMgdGhlIHNhbWUsIHRoZSBleGFjdCB2YWx1ZSBoYXMgYW4gaW1wYWN0IG9uIHRoZSBwbGF1c2libGUgZGV2aWF0aW9uIGFyb3VuZCBpdC4KIAoKKipUT0RPKio6IE1ha2UgaW50byBkaXNjcmV0ZSBiYXJwbG90LgogCmBgYHtyfQpzZXQuc2VlZCgxMSkKeTEgPC0gcnBvaXMobj01MDAsIGxhbWJkYT0xMCkKeTIgPC0gcnBvaXMobj01MDAsIGxhbWJkYT0xMDApCgpwYXIobWZyb3cgPSBjKDEsMikpCmhpc3QoeTEsIG1haW49IlBvaXNzb24oMTApIiwgYnJlYWtzPTQwKQpoaXN0KHkyLCBtYWluPSJQb2lzc29uKDEwMCkiLCBicmVha3M9NDApCmBgYAoKIyMgVGhlIFBvaXNzb24gZGlzdHJpYnV0aW9uIGluIFJOQS1zZXEKCiAtIEluIFJOQS1zZXEsIHRlY2huaWNhbCByZXBsaWNhdGVzIHJlcHJlc2VudCBkaWZmZXJlbnQgYWxpcXVvdHMgb2YgdGhlIHNhbWUgc2FtcGxlIGJlaW5nIHJlcGVhdGVkbHkuIFRoZSB1bmRlcmx5aW5nIHRydWUgZXhwcmVzc2lvbiBvZiBhIGdlbmUgY2FuIGhlbmNlIHNhZmVseSBiZSBhc3N1bWVkIHRvIGJlIGVxdWFsIGFjcm9zcyB0aGVzZSB0ZWNobmljYWwgcmVwbGljYXRlcy4KIC0gW01hcmlvbmkgKmV0IGFsLiogKDIwMDgpXShodHRwczovL2dlbm9tZS5jc2hscC5vcmcvY29udGVudC8xOC85LzE1MDkpIGhhdmUgc2hvd24gdGhhdCwgZm9yIG1vc3QgZ2VuZXMsIHRoZSBkaXN0cmlidXRpb24gb2Ygb2JzZXJ2ZWQgZ2VuZSBleHByZXNzaW9uIGNvdW50cyBhY3Jvc3MgdGVjaG5pY2FsIHJlcGxpY2F0ZXMgZm9sbG93IGEgUG9pc3NvbiBkaXN0cmlidXRpb24uIEEgc21hbGwgcHJvcG9ydGlvbiBvZiBnZW5lcyAoJFxzaW0gMC41XCUkKSBkbyBub3QgZm9sbG93IHRoaXMgUG9pc3NvbiBtb2RlbCwgaG93ZXZlciwgYW5kIGFjdHVhbGx5IHNob3cgZXZpZGVuY2UgZm9yICpgZXh0cmEtUG9pc3NvbiB2YXJpYXRpb24nKi4KIApgYGB7ciwgZWNobz1GQUxTRSwgZmlnLmNhcD1wYXN0ZSgiRmlndXJlOiBUZWNobmljYWwgcmVwbGljYXRpb24gaW4gUk5BLXNlcS4gRmlndXJlcyBmcm9tIE1hcmlvbmkgZXQgYWwuICgyMDA4KS4iKX0KIyBBbGwgZGVmYXVsdHMKaW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy9tYXJpb25pRmlnc19jcm9wcGVkLnBuZyIpCmBgYAoKIyMgUmVsYXRpdmUgdW5jZXJ0YWludHkgZm9yIFBvaXNzb24gZGlzdHJpYnV0ZWQgcmFuZG9tIHZhcmlhYmxlcwoKVGFrZSBhIG1pbnV0ZSB0byBjb25zaWRlciB0aGUgZm9sbG93aW5nIHF1ZXN0aW9uOgoKIC0gU3VwcG9zZSB0aGF0IHdlIGhhdmUgYSBzb2xpZCB0dW1vciBzYW1wbGUgZnJvbSBhIGNhbmNlciBwYXRpZW50LCBhcyB3ZWxsIGFzIGEgc2FtcGxlIG9mIHN1cnJvdW5kaW5nIGhlYWx0aHkgdGlzc3VlLiBGb3IgZWFjaCBzYW1wbGUsIHdlIGhhdmUgdGhyZWUgdGVjaG5pY2FsIHJlcGxpY2F0ZXMgYXQgb3VyIGRpc3Bvc2FsLiBMZXQgJFlfe2dydH0kIGRlbm90ZSB0aGUgb2JzZXJ2ZWQgZ2VuZSBleHByZXNzaW9uIHZhbHVlcyBvZiBnZW5lICRnJCBpbiByZXBsaWNhdGUgJHIkIGZyb20gdGlzc3VlICR0IFxpbiBcezAsMVx9JCwgd2hlcmUgJHQ9MCQgZGVub3RlcyBoZWFsdGh5IHRpc3N1ZSBhbmQgJHQ9MSQgZGVub3RlcyB0dW1vcmFsIHRpc3N1ZS4gCiAtIFdlIHRoZW4ga25vdyB0aGF0IHRoZSByYW5kb20gdmFyaWFibGVzICRZX3tncjB9JCBhbmQgJFlfe2dyMX0kIGZvbGxvdyBhIFBvaXNzb24gZGlzdHJpYnV0aW9uLCBhbmQgd2Ugd291bGQgZXN0aW1hdGUgaXRzIG1lYW4gYXMgJFxiYXJ7WX1fe2cwfSA9IFxmcmFjezF9ezN9IFxzdW1fe3I9MX1eMyBZX3tncjB9JCBhbmQgJFxiYXJ7WX1fe2cxfSA9IFxmcmFjezF9ezN9IFxzdW1fe3I9MX1eMyBZX3tncjF9JCwgcmVzcGVjdGl2ZWx5LiAKIC0gU2ltaWxhciwgZm9yIGFub3RoZXIgZ2VuZSAkayQsIHdlIG9ic2VydmUgJFlfe2tydH0kLCBhbmQgZXN0aW1hdGUgJFxiYXJ7WX1fe2swfSQgYW5kICRcYmFye1l9X3trMX0kIGNvcnJlc3BvbmRpbmdseS4KIC0gTm93IHN1cHBvc2UgdGhhdCAkXGJldGFfe2t9ID0gXGJhcntZfV97azF9IC8gXGJhcntZfV97azB9ID0gNSQsIGJ1dCBhbHNvICRcYmV0YV9nID0gXGJhcntZfV97ZzF9IC8gXGJhcntZfV97ZzB9ID0gNSQsIGkuZS4sIHRoZSB0d28gZ2VuZXMgaGF2ZSB0aGUgc2FtZSBhdmVyYWdlIGV4cHJlc3Npb24gcmF0aW8gKGFsc28gb2Z0ZW4gY2FsbGVkIGEgZm9sZC1jaGFuZ2UpIGFjcm9zcyBzYW1wbGVzLiBIb3dldmVyLCB0aGV5IGFyZSBkaWZmZXJlbnRseSBleHByZXNzZWQgYXMgJFxiYXJ7WX1fe2sxfSA9IDEwMCQsIGFuZCAkXGJhcntZfV97ZzF9ID0gMTAkIChtYWtpbmcgJFxiYXJ7WX1fe2swfSA9IDIwJCwgYW5kICRcYmFye1l9X3tnMH0gPSAyJCkuCiAtIEZvciB3aGljaCBvZiB0aGUgdHdvIGdlbmVzIGlzIHRoZSB1bmNlcnRhaW50eSBvbiB0aGUgZXhwcmVzc2lvbiByYXRpbyB0aGUgaGlnaGVzdD8gSW4gb3RoZXIgd29yZHMsIGRvIHdlIHRydXN0ICRcYmV0YV9rJCBtb3JlIG9yIGRvIHdlIHRydXN0ICRcYmV0YV9nJCBtb3JlPwogCiAtLS0KCkxldCdzIGFwcHJveGltYXRlIHRoZSB1bmNlcnRhaW50eSBpbiAkYmV0YV9nJCBhbmQgJFxiZXRhX2skIHVzaW5nIHNpbXVsYXRpb246CiAKYGBge3J9Ck4gPC0gMWUzCmJldGFfZyA8LSBiZXRhX2sgPC0gdmVjdG9yKGxlbmd0aD1OKQpmb3IoaWkgaW4gMTpOKXsKICB5Z3IxIDwtIHJwb2lzKG49MywgbGFtYmRhPTEwKQogIHlncjAgPC0gcnBvaXMobj0zLCBsYW1iZGE9MikKICB5a3IxIDwtIHJwb2lzKG49MywgbGFtYmRhPTEwMCkKICB5a3IwIDwtIHJwb2lzKG49MywgbGFtYmRhPTIwKQogIGJldGFfZ1tpaV0gPC0gbWVhbih5Z3IxKSAvIG1lYW4oeWdyMCkKICBiZXRhX2tbaWldIDwtIG1lYW4oeWtyMSkgLyBtZWFuKHlrcjApCn0KCnBhcihtZnJvdz1jKDEsMiksIG1hcj1jKDQsMiwzLDEpKQpoaXN0KGJldGFfZywgYnJlYWtzPXNlcSgwLDUwLGJ5PTEpLCB4bGltPWMoMCw1MCkpCmhpc3QoYmV0YV9rLCBicmVha3M9c2VxKDAsNTAsYnk9MSksIHhsaW09YygwLDUwKSkKYGBgCiAKIC0tLSAKIAogV2UgY2xlYXJseSBzZWUgdGhhdCB0aGUgdW5jZXJ0YWludHkgb24gJFxiZXRhX2ckIGlzIG11Y2ggbG93ZXIgdGhhbiBvbiAkXGJldGFfayQuIEV2ZW4gdGhvdWdoIHRoZSB2YXJpYW5jZSBvbiB0aGUgY291bnRzIG9mIGdlbmUgJGckIGlzIGhpZ2hlciwgc2luY2UgaXRzIG1lYW4gaXMgaGlnaGVyIGFuZCBpdCBpcyBkaXN0cmlidXRlZCBhcyBhIFBvaXNzb24gdmFyaWFibGUuIEhvdyBkbyB3ZSBleHBsYWluIHRoaXM/CiAKIC0gV2UgbWF5IGV4cGxhaW4gdGhpcyBieSBjb25zaWRlcmluZyB0aGUgcmVsYXRpdmUgdW5jZXJ0YWludHkgb24gdGhlIG1lYW4uIFJlbGF0aXZlIHVuY2VydGFpbnR5IGNhbiBiZSBkZWZpbmVkIGFzIHRoZSBjb2VmZmljaWVudCBvZiB2YXJpYXRpb24gJENWID0gXGZyYWN7XHNpZ21hfXtcbXV9JCAodGhpcyBpcywgdGhlIHN0YW5kYXJkIGRldmlhdGlvbiBkaXZpZGVkIGJ5IHRoZSBtZWFuKS4gSW5kZWVkLCB0aGUgQ1YgZGVzY3JpYmVzIHRoZSByZWxhdGl2ZSBkZXZpYXRpb24gb2YgdGhlIGRpc3RyaWJ1dGlvbiByZWxhdGl2ZSB0byBpdHMgbWVhbiwgd2hlcmUgYSBsb3cgQ1YgaW5kaWNhdGVzIGxvdyBkaXNwZXJzaW9uIHdpdGggcmVzcGVjdCB0byB0aGUgbWVhbi4KIC0gQ2FsY3VsYXRpbmcgdGhlIENWIHNob3dzIHRoYXQgKip0aGUgcmVsYXRpdmUgdW5jZXJ0YWludHkgZm9yIGdlbmUgJGskIHRoYW4gZm9yIGdlbmUgJGckLCBldmVuIHRob3VnaCB0aGUgdmFyaWFuY2Ugb24gdGhlIHJhdyBjb3VudHMgaXMgaGlnaGVyIGZvciBnZW5lICRrJCB0aGFuIGZvciBnZW5lICRnJCoqLiAKIC0gVGhpcyBsb3dlciByZWxhdGl2ZSB1bmNlcnRhaW50eSBvbiB0aGUgbWVhbiB0aGVuIHByb3BhZ2F0ZXMgZnVydGhlciB0byBhIGxvd2VyIHVuY2VydGFpbnR5IG9uIHRoZSBmb2xkLWNoYW5nZS4gVGhpcyBiYXNpYyByZXN1bHQgd2lsbCBiZSBlc3NlbnRpYWwgZm9yIHVuZGVyc3RhbmRpbmcgdGhlIHJlc3VsdHMgb2YgYSBkaWZmZXJlbnRpYWwgZXhwcmVzc2lvbiBhbmFseXNpcyEKIApgYGB7cn0Kc3FydCgxMDApLzEwMCAjQ1YgZm9yIGdlbmUgawoKc3FydCgxMCkvMTAgI0NWIGZvciBnZW5lIGcKYGBgCiAKIyBNb2RlbGluZyBjb3VudCBkYXRhOiBHZW5lcmFsaXplZCBsaW5lYXIgbW9kZWxzCgpKdXN0IGxpa2Ugd2UgaGF2ZSBtb2RlbGVkIHByb3RlaW4gYWJ1bmRhbmNlcyBpbiB0aGUgcHJvdGVvbWljcyBwYXJ0IG9mIHRoaXMgY291cnNlIHRvIGFzc2VzcyBkaWZmZXJlbnRpYWwgcHJvdGVpbiBhYnVuZGFuY2UsIHdlIGNhbiBtb2RlbCBnZW5lIGV4cHJlc3Npb24gY291bnRzIHRvIGlkZW50aWZ5IGdlbmVzIHdpdGggZGlmZmVyZW5jZXMgaW4gYXZlcmFnZSBleHByZXNzaW9uIGJldHdlZW4gZ3JvdXBzIG9mIHNhbXBsZXMuCgojIyBXaHkgd2UgY2FuKCd0KSB1c2UgbGluZWFyIG1vZGVscyB0byBtb2RlbCBjb3VudCBkYXRhCgogLSBJZiB3ZSdyZSB1c2luZyBhIGxpbmVhciBtb2RlbCB0byBtb2RlbCBhIHJlc3BvbnNlICRZX2kkLCB3aXRoICRpIFxpbiBcezEsIFxsZG90cywgblx9JCBpbiBmdW5jdGlvbiBvZiBhIHNpbmdsZSBjb3ZhcmlhdGUgJFhfaSQsIHRoZSBsaW5lYXIgbW9kZWwgY2FuIGJlIGRlZmluZWQgYXMgZm9sbG93czoKClxbClxsZWZ0XHsKXGJlZ2lue2FycmF5fXtjY2N9CllfaSAmID0gJiBcYmV0YV8wICsgXGJldGFfMSBYX2kgKyBcZXBzaWxvbl9pIFxcCllfaSB8IFhfaSAmIFxzaW0gJiBOKFxiZXRhXzAgKyBcYmV0YV8xIFhfaSwgXHNpZ21hXjIgXG1hdGhiZntJfSkuClxlbmR7YXJyYXl9ClxyaWdodC4KXF0KCiAtIE9yLCBlcXVpdmFsZW50bHksIGluIG1hdHJpeCBmb3JtIHdlIHdvdWxkIHdyaXRlIAogICQkCiAgXGxlZnRcewogIFxiZWdpbnthcnJheX17Y2NjfQogIFlfaSAmID0gJiBcbWF0aGJme1h9XlRfaSBcbWF0aGJme1xiZXRhfSArIFxlcHNpbG9uX2kgXFwKICBZX2kgfCBcbWF0aGJme1h9X2kgJiBcc2ltICYgTihcbWF0aGJme1h9XlRfaSBcYmV0YSwgXHNpZ21hXjIgXG1hdGhiZntJfSksCiAgXGVuZHthcnJheX0KICBccmlnaHQuCiAgJCQKd2hlcmUgJFxtYXRoYmZ7WH0kIG5vdyByZXByZXNlbnRzIG91ciAkbiBcdGltZXMgcCQgZGVzaWduIG1hdHJpeCwgd2l0aCByb3cgJGkkIGNvcnJlc3BvbmRpbmcgdG8gb2JzZXJ2YXRpb24gJGkkLgoKIC0tLQoKIC0gVGhlIHZhcmlhbmNlLWNvdmFyaWFuY2UgbWF0cml4IG9mICRcbWF0aGJme1l9JCBpcyBhc3N1bWVkIGEgZGlhZ29uYWwgbWF0cml4IHdpdGggJFxzaWdtYV4yJCBvbiB0aGUgZGlhZ29uYWwgZWxlbWVudHMgYW5kIHplcm8gZXZlcnl3aGVyZSBlbHNlLiBUaGlzIG1lYW5zIHRoYXQgdGhlIGRhdGEgcG9pbnRzIGFyZSB1bmNvcnJlbGF0ZWQsIGFuZCB0aGF0IGV2ZXJ5IG9ic2VydmF0aW9uIGhhcyB0aGUgc2FtZSB2YXJpYW5jZSAkXHNpZ21hXjIkLCBhbHNvIHJlZmVycmVkIHRvIGFzIGhvbW9zY2VkYXN0aWNpdHkuIFRoZSBsYXR0ZXIgb2J2aW91c2x5IGRvZXNuJ3QgaG9sZCBmb3IgY291bnQgZGF0YSwgZHVlIHRvIHRoZSBtZWFuLXZhcmlhbmNlIHJlbGF0aW9uc2hpcC4gVGhpcyBtYWtlcyBsaW5lYXIgbW9kZWxzIHVuc3VpdGFibGUgdG8gbW9kZWwgY291bnQgZGF0YS4KCiMjIEdlbmVyYWxpemVkIGxpbmVhciBtb2RlbHMKCiAtIEFzIHRoZSBuYW1lIHN1Z2dlc3RzLCBnZW5lcmFsaXplZCBsaW5lYXIgbW9kZWxzIChHTE1zKSBleHRlbmQgbGluZWFyIG1vZGVscy4gSW4gR0xNcywgd2UgZXh0ZW5kIHR3byB0aGluZ3Mgd2l0aCByZXNwZWN0IHRvIHRoZSBsaW5lYXIgbW9kZWw6CiAgICAtIFRoZSAqKmNvbmRpdGlvbmFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcmVzcG9uc2UgdmFyaWFibGUgJFlfaSB8IFhfaSQqKiBjYW4gYmUgYXNzdW1lZCB0byBmb2xsb3cgYW55IGRpc3RyaWJ1dGlvbiB0aGF0IGJlbG9uZ3MgdG8gdGhlICoqZXhwb25lbnRpYWwgZmFtaWx5Kiogb2YgZGlzdHJpYnV0aW9ucywgd2hpY2ggaW5jbHVkZXMgdGhlIEdhdXNzaWFuIGJ1dCBhbHNvIG90aGVyIGNvbW1vbmx5IGtub3duIGRpc3RyaWJ1dGlvbnMsIHN1Y2ggYXMgdGhlIEJpbm9taWFsLCBHYW1tYSBhbmQgUG9pc3NvbiBkaXN0cmlidXRpb24uCiAgICAtIFRoZSBsaW5lYXIgbW9kZWwgYXNzdW1lZCBhIGxpbmVhciByZWxhdGlvbnNoaXAgYmV0d2VlbiAkWV9pJCBhbmQgJFhfaSQsIHNpbmNlIHdlIGFzc3VtZWQgdGhhdCAkRShZX2kgfCBYX2kpID0gXG1hdGhiZntYfV5UX2kgXG1hdGhiZntcYmV0YX0kLiBJbiBHTE1zLCB3ZSB3aWxsIGFsbG93IGEgKipsaW5rIGZ1bmN0aW9uKiogJGcoKSQgdGhhdCBsaW5rcyB0aGUgY29uZGl0aW9uYWwgbWVhbiB0byB0aGUgY292YXJpYXRlcy4gSGVuY2UsIGluIEdMTXMgd2UgaGF2ZSB0aGF0ICRnKEUoWV9pIHwgWF9pKSkgPSBcbWF0aGJme1h9XlRfaSBcbWF0aGJme1xiZXRhfSQuIE5vdGUgdGhhdCBlYWNoIGZhbWlseSBoYXMgZ290IGEgY2Fub25pY2FsIGxpbmsgZnVuY3Rpb24sIHdoaWNoIGlzIHRoZSBpZGVudGl0eSBsaW5rIGZ1bmN0aW9uICRnKFxtdSkgPSBcbXUkIGZvciBHYXVzc2lhbiwgdGhlIGxvZyBsaW5rIGZ1bmN0aW9uICRnKFxtdSkgPSBcbG9nIFxtdSQgZm9yIFBvaXNzb24sIG9yIHRoZSBsb2dpdCBsaW5rIGZ1bmN0aW9uICRnKFxtdSkgPSBcbG9nKFxmcmFje1xtdX17MS1cbXV9KSQgZm9yIEJpbm9taWFsLgogICAgCiAtLS0KIAogLSBSZW1lbWJlciB0aGF0IGZvciBhIGxpbmVhciBtb2RlbCB3ZSBoYXZlIGEgY2xvc2VkLWZvcm0gc29sdXRpb24gZm9yIGVzdGltYXRpbmcgdGhlIHJlZ3Jlc3Npb24gY29lZmZpY2llbnRzICRcbWF0aGJme1xiZXRhfSQsIGkuZS4sICRcaGF0e1xtYXRoYmZ7XGJldGF9fSA9IChcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXG1hdGhiZntZfSQuCiAtIEZpdHRpbmcgYSBHTE0gaXMgbXVjaCBoYXJkZXIsIGhvd2V2ZXIsIHNpbmNlIGZvciBtYW55IGRpc3RyaWJ1dGlvbnMgdGhhdCBiZWxvbmcgdG8gdGhlIGV4cG9uZW50aWFsIGZhbWlseSwgdGhlIHZhcmlhbmNlIGRlcGVuZHMgb24gdGhlIG1lYW4sIGFuZCB0aGlzIG1lYW4tdmFyaWFuY2UgcmVsYXRpb25zaGlwIG11c3QgYmUgdGFrZW4gaW50byBhY2NvdW50LgogLSBUaGUgKippdGVyYXRpdmUgcmV3ZWlnaHRlZCBsZWFzdCBzcXVhcmVzIChJUkxTKSoqIGFsZ29yaXRobSBpcyB1c3VhbGx5IGFkb3B0ZWQgZm9yIGZpdHRpbmcgR0xNcy4gQXMgdGhlIG5hbWUgc3VnZ2VzdHMsIGl0IGlzIGFuIGl0ZXJhdGl2ZSBhbGdvcml0aG0gKHNvIG5vIGNsb3NlZC1mb3JtIHNvbHV0aW9ucyEpLCB3aGVyZSBlYWNoIGRhdGEgcG9pbnQgaXMgcmV3ZWlnaHRlZCBpbiBlYWNoIGl0ZXJhdGlvbiBhY2NvcmRpbmcgdG8gaXRzIHZhcmlhbmNlLCB3aGljaCBpcyBhIGZ1bmN0aW9uIG9mIGl0cyBlc3RpbWF0ZWQgbWVhbiBvZiB0aGUgcHJldmlvdXMgaXRlcmF0aW9uLiBJbmRlZWQsIG9ic2VydmF0aW9ucyB3aXRoIGhpZ2ggdmFyaWFuY2Ugd2lsbCBiZSBkb3dud2VpZ2h0ZWQgYW5kIHZpY2UgdmVyc2EuCiAtIFRoZSBvYmplY3RpdmUgZnVuY3Rpb24gdXNlZCBpbiB0aGUgSVJMUyBhbGdvcml0aG0gaXMgdGhlIGxvZy1saWtlbGlob29kIG9mIHRoZSBkYXRhIHVuZGVyIHRoZSBwb3NpdGVkIG1vZGVsLiBUaGlzIGZ1bmN0aW9uIGlzIGJlaW5nIG1heGltaXplZCB3aXRoIHJlc3BlY3QgdG8gdGhlIHJlZ3Jlc3Npb24gY29lZmZpY2llbnRzICRcbWF0aGJme1xiZXRhfSQgdG8gZmluZCBhIHNvbHV0aW9uICRcaGF0e1xtYXRoYmZ7XGJldGF9fSQuCiAtIEluIHRoZSBhYnNlbmNlIG9mIGEgbWVhbi12YXJpYW5jZSByZWxhdGlvbnNoaXAgKHN1Y2ggYXMgaXMgdGhlIGNhc2Ugd2l0aCB0aGUgR2F1c3NpYW4gZGlzdHJpYnV0aW9uKSwgdGhlIElSTFMgYWxnb3JpdGhtIHJlZHVjZXMgdG8gdGhlIGNsb3NlZC1mb3JtIHNvbHV0aW9ucyBvZiBhIGxpbmVhciBtb2RlbC4KICAgIAogICAgCiMjIyBBIFBvaXNzb24gR0xNCgogLSBXZSBjYW4gZGVmaW5lIGEgUG9pc3NvbiBHTE0gYXMgZm9sbG93cwogICQkCiAgXGxlZnRcewogIFxiZWdpbnthcnJheX17Y2NjfQogIFlfaSAmIFxzaW0gJiBQb2koXG11X2kpIFxcCiAgXGxvZyBcbXVfaSAmID0gJiBcZXRhX2kgXFwKICBcZXRhX2kgJiA9ICYgXG1hdGhiZntYfV5UX2kgXG1hdGhiZntcYmV0YX0gXFwKICBcZW5ke2FycmF5fQogIFxyaWdodC4KICAkJAp3aGVyZSAkWV9pJCBpcyB0aGUgcmVzcG9uc2UgdmFyaWFibGUsIHdpdGggbWVhbiAkXG11X2kkLCAkXGV0YV9pJCBpcyB0aGUgbGluZWFyIHByZWRpY3RvciwgJFxtYXRoYmZ7WH0kIGlzIHRoZSAkbiBcdGltZXMgcCQgbW9kZWwgbWF0cml4IGFuZCAkXG1hdGhiZntcYmV0YX0kIGlzIHRoZSAkcCBcdGltZXMgMSQgbWF0cml4IG9mIHJlZ3Jlc3Npb24gY29lZmZpY2llbnRzLgogIC0gSXQgaXMgaW5zaWdodGZ1bCB0byBjb21wYXJlIHRoaXMgbW9kZWwgdG8gYSBsaW5lYXIgbW9kZWwgd2hlcmUgJFlfaSQgaXMgbG9nLXRyYW5zZm9ybWVkLiBJbmRlZWQsIGluIHRoZSBsaW5lYXIgbW9kZWwgY2FzZSwgd2Ugd291bGQgYmUgbW9kZWxpbmcgJEUoXGxvZyBZX2kgKSQsIHdoaWxlIGluIHRoZSBHTE0gd2UgYXJlIG1vZGVsaW5nICRcbG9nIEUoWV9pKSQuCiAgLSBUaGlzIHNob3dzIHRoYXQgaW4gdGhlIEdMTSBzZXR0aW5nIHdlIGFyZSBtb2RlbGluZyBhIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgdGhlIGV4cGVjdGVkIHZhbHVlLCBhbmQgYWZ0ZXIgcmV0cmFuc2Zvcm1pbmcgd2UgY2FuIGludGVycHJldCB0aGUgZml0IGluIHRlcm1zIG9mIHRoZSBtZWFuIG9mIG91ciByZXNwb25zZSB2YXJpYWJsZS4gSW4gdGhlIHRyYW5zZm9ybWVkIGxpbmVhciBtb2RlbCwgaG93ZXZlciwgd2UgYXJlIHdvcmtpbmcgd2l0aCB0aGUgZXhwZWN0ZWQgdmFsdWUgb2YgYSB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIG91ciByZXNwb25zZSB2YXJpYWJsZSwgYW5kIHdlIHdpbGwgbm90IGJlIGFibGUgdG8gaW50ZXJwcmV0IHRoZSBmaXQgaW4gdGVybXMgb2YgdGhlIG1lYW4gKGJlY2F1c2UgJEUoIFxsb2cgWV9pKSBcbmUgXGxvZyBFKFlfaSkkLiBJbiB0aGlzIHNwZWNpZmljIGNhc2UsIHdlIHdvdWxkIGhhdmUgdG8gcmVzb3J0IHRvIGludGVycHJldGluZyBjaGFuZ2VzIGluIHRlcm1zIG9mIGEgZ2VvbWV0cmljIG1lYW4uCiAgLSBBbHNvIG5vdGUgdGhhdCAkXG1hdGhiZntYfV5UX2kgXG1hdGhiZntcYmV0YX0gXGluIF0tXGluZnR5LCBcaW5mdHlbJCwgd2hpbGUgJFlfaSQgbXVzdCBiZSBub24tbmVnYXRpdmUgJFswLCBcaW5mdHlbJC4gVGhlIGxpbmsgZnVuY3Rpb24gaGVscHMgd2l0aCB0aGlzLCBzaW5jZSB0aGUgZXhwb25lbnRpYWwgZnVuY3Rpb24gdHJhbnNmb3JtcyBhbnkgcmVhbCBudW1iZXIgdG8gYSBub24tbmVnYXRpdmUgbnVtYmVyLCBpLmUuLCAkXGV4cChcbWF0aGJme1h9XlRfaSBcbWF0aGJme1xiZXRhfSkgXGluIFswLCBcaW5mdHlbJC4gCiAKCiMjIyBHZW5lcmFsaXplZCBsaW5lYXIgbW9kZWxzIGluIGBSYAoKR29hbHM6IAotIEZpdCBQb2lzc29uIEdMTSBvbiBiaWtlIGRhdGEKLSBVc2UgaXQgdG8gZXhwbGFpbiBHTE0gb3V0cHV0Ci0gVXNlIGl0IHRvIGludGVycHJldCBjb2VmZmljaWVudHM6IHNob3cgaW1wb3J0YW5jZSBvZiBsaW5rCi0gVGhlbiBsb29rIGF0IGFzc3VtcHRpb25zIGFuZCBwaW5wb2ludCBvdmVyZGlzcGVyc2lvbi4gU29sdXRpb24gd2lsbCBiZSBmb3IgbmV4dCBsZWN0dXJlLgoKCiAtIEluIG9yZGVyIHRvIGdldCBmYW1pbGlhciB3aXRoIEdMTXMsIHdlIHdpbGwgZml0IGEgUG9pc3NvbiBHTE0gaW4gYFJgLCB1c2luZyB0aGUgYEJpa2VzaGFyZWAgZGF0YXNldCBhcyBwYXJ0IG9mIHRoZSBgSVNMUjJgIHBhY2thZ2UuIFRoaXMgZGF0YXNldCByZWNvcmRzIGhvdyBtYW55IGJpa2VzIHdlcmUgYmVpbmcgdXNlZCBmcm9tIGEgYmlrZS1zaGFyaW5nIHNlcnZpY2UsIGV2ZXJ5IGhvdXIgb2YgdGhlIGRheSBvdmVyIGEgZnVsbCB5ZWFyICgzNjUgZGF5cykuCiAtIEZ1bGwgaW5mb3JtYXRpb24gb2YgdGhlIGRhdGFzZXQgaXMgcHJvdmlkZWQgW2hlcmVdKGh0dHBzOi8vYXJjaGl2ZS5pY3MudWNpLmVkdS9tbC9kYXRhc2V0cy9iaWtlK3NoYXJpbmcrZGF0YXNldCkuIFZhcmlhYmxlcyBvZiBpbnRlcmVzdCBmb3IgdXMgYXJlOgogCiAgICAtIGBiaWtlcnNgOiBEaXNjcmV0ZSBjb3VudCB2YXJpYWJsZTsgdGhlIG51bWJlciBvZiBiaWtlcyBiZWluZyB1c2VkIHRoYXQgaG91ci4KICAgIC0gYGh1bWA6IENvbnRpbnVvdXMgdmFyaWFibGUgcmFuZ2luZyBiZXR3ZWVuIDAgYW5kIDE7IG5vcm1hbGl6ZWQgaHVtaWRpdHkuCiAgICAtIGBocmA6IENhdGVnb3JpY2FsIHZhcmlhYmxlIGJldHdlZW4gMCBhbmQgMjM7IHRoZSBob3VyIG9mIHRoZSBkYXkuIE5vdGUgdGhhdCBvbmUgY291bGQgYWxzbyBjb25zaWRlciB0aGlzIHZhcmlhYmxlIHRvIGJlIG51bWVyaWMgYW5kIG1vZGVsIGl0IGFzIHN1Y2guCiAgICAtIGB3ZWF0aGVyc2l0YDogQ2F0ZWdvcmljYWwgdmFyaWFibGU7IHRoZSB3ZWF0aGVyIGNvbmRpdGlvbiBvZiB0aGF0IGhvdXIsIHdpdGgKICAgIAogICAgICAxLiBDbGVhciwgRmV3IGNsb3VkcywgUGFydGx5IGNsb3VkeS4KICAgICAgMi4gTWlzdCArIENsb3VkeSwgTWlzdCArIEJyb2tlbiBjbG91ZHMsIE1pc3QgKyBGZXcgY2xvdWRzLCBNaXN0LgogICAgICAzLiBMaWdodCBTbm93LCBMaWdodCBSYWluICsgVGh1bmRlcnN0b3JtICsgU2NhdHRlcmVkIGNsb3VkcywgTGlnaHQgUmFpbiArIFNjYXR0ZXJlZCBjbG91ZHMuCiAgICAgIDQuIEhlYXZ5IFJhaW4gKyBJY2UgUGFsbGV0cyArIFRodW5kZXJzdG9ybSArIE1pc3QsIFNub3cgKyBGb2cuCiAgICAKIC0tLSAgCgpgYGB7cn0KIyBpZiBJU0xSMiBpc24ndCBpbnN0YWxsZWQsIGluc3RhbGwgaXQ6CmlmKCEiSVNMUjIiICVpbiUgaW5zdGFsbGVkLnBhY2thZ2VzKClbLDFdKXsKICBpbnN0YWxsLnBhY2thZ2VzKCJJU0xSMiIpCn0KIyBsb2FkIGFuZCBwcmV2aWV3IHRoZSBkYXRhc2V0OgpkYXRhKCJCaWtlc2hhcmUiLCBwYWNrYWdlPSJJU0xSMiIpCmhlYWQoQmlrZXNoYXJlKQoKIyBhc3NvY2lhdGlvbiB3aXRoIHdlYXRoZXIgb24gY291bnQgYW5kIGxvZyBzY2FsZQpiYXJwbG90KHRhYmxlKEJpa2VzaGFyZSR3ZWF0aGVyc2l0KSkKYm94cGxvdChiaWtlcnMgfiB3ZWF0aGVyc2l0LCBkYXRhPUJpa2VzaGFyZSwKICAgICAgICB4bGFiID0gIldlYXRoZXIiLCB5bGFiID0gIkJpa2VycyIpCmJveHBsb3QobG9nMXAoYmlrZXJzKSB+IHdlYXRoZXJzaXQsIGRhdGE9QmlrZXNoYXJlLAogICAgICAgIHhsYWIgPSAiV2VhdGhlciIsIHlsYWIgPSAiTG9nIChiaWtlcnMgKzEpIikKCiMgYXNzb2NpYXRpb24gd2l0aCBodW1pZGl0eSBvbiBjb3VudCBhbmQgbG9nIHNjYWxlCmhpc3QoQmlrZXNoYXJlJGh1bSwgYnJlYWtzPTQwKQpwbG90KGJpa2VycyB+IGh1bSwgZGF0YT1CaWtlc2hhcmUsIHBjaD0xNiwgY2V4PTEvMiwKICAgICAgICB4bGFiID0gIkh1bWlkaXR5IiwgeWxhYiA9ICJCaWtlcnMiKQpsb0h1bSA8LSBsb2VzcyhiaWtlcnMgfiBodW0sIGRhdGE9QmlrZXNoYXJlKQp4R3JpZCA8LSBzZXEoMCwgMSwgbGVuZ3RoPTUwKQp5aGF0IDwtIHByZWRpY3QobG9IdW0sIGRhdGEuZnJhbWUoaHVtID0geEdyaWQpKQpsaW5lcyh4PXhHcmlkLCB5PXloYXQsIGNvbD0icmVkIiwgbHdkPTMpCgpwbG90KGxvZzFwKGJpa2VycykgfiBodW0sIGRhdGE9QmlrZXNoYXJlLCBwY2g9MTYsIGNleD0xLzIsCiAgICAgICAgeGxhYiA9ICJIdW1pZGl0eSIsIHlsYWIgPSAiTG9nIChiaWtlcnMgKzEpIikKbG9IdW0gPC0gbG9lc3MobG9nMXAoYmlrZXJzKSB+IGh1bSwgZGF0YT1CaWtlc2hhcmUpCnhHcmlkIDwtIHNlcSgwLCAxLCBsZW5ndGg9NTApCnloYXQgPC0gcHJlZGljdChsb0h1bSwgZGF0YS5mcmFtZShodW0gPSB4R3JpZCkpCmxpbmVzKHg9eEdyaWQsIHk9eWhhdCwgY29sPSJyZWQiLCBsd2Q9MykKCiMgYXNzb2NpYXRpb24gd2l0aCBob3VyIG9uIGNvdW50IGFuZCBsb2cgc2NhbGUKYmFycGxvdCh0YWJsZShCaWtlc2hhcmUkaHIpKQpwbG90KGJpa2VycyB+IGhyLCBkYXRhPUJpa2VzaGFyZSwgcGNoPTE2LCBjZXg9MS8yLAogICAgICAgIHhsYWIgPSAiSG91ciBvZiBkYXkiLCB5bGFiID0gIkJpa2VycyIpCnBsb3QobG9nMXAoYmlrZXJzKSB+IGhyLCBkYXRhPUJpa2VzaGFyZSwgcGNoPTE2LCBjZXg9MS8yLAogICAgICAgIHhsYWIgPSAiSG91ciBvZiBkYXkiLCB5bGFiID0gIkxvZyAoYmlrZXJzICsxKSIpCmBgYAoKVGhlIGRhdGEgZXhwbG9yYXRpb24gc2hvd3MgdGhhdAoKIC0gTW9yZSBiaWtlcyBhcmUgYmVpbmcgdXNlZCB3aGVuIHRoZSB3ZWF0aGVyIGlzIGJldHRlci4KIC0gVGhlcmUgc2VlbXMgdG8gYmUgYSBub24tbGluZWFyIGFzc29jaWF0aW9uIGJldHdlZW4gYmljeWNsZSByZW50YWxzIGFuZCBodW1pZGl0eSwgd2hlcmUgaW4gYm90aCBsb3cgYW5kIGhpZ2ggaHVtaWRpdHkgY29uZGl0aW9ucyByZWxhdGl2ZWx5IGZldyBiaWtlcyBhcmUgdXNlZCwgcG9zc2libHkgcmVmbGVjdGluZyB2ZXJ5IGhvdCBhbmQgdmVyeSB3ZXQgZGF5cyByZXNwZWN0aXZlbHksIHdoaWxlIG1vc3QgYmlrZXMgYXJlIGJlaW5nIHVzZWQgYXQgbW9kZXJhdGUgaHVtaWRpdHkuCiAtIEJpY3ljbGUgcmVudGFsIGlzIGFzc29jaWF0ZWQgdG8gdGhlIGhvdXIgb2YgdGhlIGRheSwgaG93ZXZlciwgaW4gYSBub24tbGluZWFyIHdheSwgd2l0aCBjbGVhciBwZWFrcyBpbiB1c2FnZSBhdCB0eXBpY2FsIGNvbW11dGUgaG91cnMgKDZoLThoIGFuZCAxN2gtMTloKS4gSGVyZSwgd2Ugd2lsbCBhZGQgYGhyYCBhcyBhIGNhdGVnb3JpY2FsIHZhcmlhYmxlIHRvIHRoZSBtb2RlbCwgZXN0aW1hdGluZyBvbmUgcGFyYW1ldGVyIGZvciBlYWNoIGhvdXIuIEhvd2V2ZXIsIG5vdGUgdGhhdCB0aGlzIG1heSBub3QgYmUgdGhlIG1vc3QgZWZmaWNpZW50IGFwcHJvYWNoIHN0YXRpc3RpY2FsbHksIGFzIG9uZSBtYXkgYmUgYWJsZSB0byBpbmNvcnBvcmF0ZSBgaHJgIGFzIGEgbnVtZXJpY2FsIHZhcmlhYmxlIGFuZCBtb2RlbCB0aGUgbm9uLWxpbmVhcml0eSB1c2luZyBhIGxvd2VyIG51bWJlciBvZiBwYXJhbWV0ZXJzLgogLSAqRGlzY2xhaW1lcio6IE5vdGUgdGhhdCB0aGVyZSBhcmUgbGlrZWx5IGludGVyYWN0aW9ucyBiZXR3ZWVuIHRoZSB2YXJpYWJsZXMsIHdoaWNoIGhlcmUgd2Ugd2lsbCBub3QgZXZhbHVhdGUgYXMgb3VyIGdvYWwgaXMgdG8gaW50cm9kdWNlIGEgUG9pc3NvbiBHTE0gcmF0aGVyIHRoYW4gYSBmdWxsIGFuYWx5c2lzIG9mIHRoZSBgQmlrZXNoYXJlYCBkYXRhc2V0LiBGb3IgZXhhbXBsZSwgaXQgc2VlbXMgbGlrZWx5IHRoYXQgbW9yZSBwZW9wbGUgY29tbXV0ZSBieSBiaWtlIGluIGdvb2Qgd2VhdGhlciwgd2hpbGUgZmV3ZXIgcGVvcGxlIHdpbGwgY29tbXV0ZSBieSBiaWtlIGluIHRlcnJpYmxlIHdlYXRoZXIuIFRoaXMgd291bGQgbW90aXZhdGUgYW4gaW50ZXJhY3Rpb24gYmV0d2VlbiB0aGUgdmFyaWFibGVzIGB3ZWF0aGVyc2l0YCBhbmQgYGhyYC4KIAogLS0tCiAKIC0gQmVsb3csIHdlIGZpdCBhIFBvaXNzb24gR0xNIHVzaW5nIHRoZSBgZ2xtYCBmdW5jdGlvbi4gVGhlIG51bWJlciBvZiBiaWtlcnMgaXMgdXNlZCBhcyBhIHJlc3BvbnNlIHZhcmlhYmxlLCB3aGljaCBpcyBtb2RlbGVkIGFzIGEgZnVuY3Rpb24gb2YgYHdlYXRoZXJzaXRgLCBgaHVtYCBhbmQgYGhyYC4gCiAtIE5vdGUgdGhhdCB0aGVyZSBzZWVtcyB0byBiZSBhIG5vbi1saW5lYXIsIHRob3VnaCBmYWlybHkgc2ltcGxlLCBhc3NvY2lhdGlvbiBiZXR3ZWVuIG91ciByZXNwb25zZSB2YXJpYWJsZSBhbmQgdGhlIGh1bWlkaXR5LiBXZSB3aWxsIHRoZXJlZm9yZSBhZGQgYSBxdWFkcmF0aWMgdGVybSBmb3IgaHVtaWRpdHkgdG8gdGhlIG1vZGVsLiBJbiBvcmRlciB0byBhdm9pZCBtdWx0aWNvbGxpbmVhcml0eSBiZXR3ZWVuIHRoZSBsaW5lYXIgYW5kIHF1YWRyYXRpYyBodW1pZGl0eSBlZmZlY3RzLCB3ZSB3aWxsIGZpcnN0IGNlbnRlciB0aGUgaHVtaWRpdHkgdmFyaWFibGUgYW5kIHN0b3JlIHRoaXMgaW4gYSBuZXcgdmFyaWFibGUgY2FsbGVkIGBodW1jYC4gVGhpcyBtZWFucyB0aGF0IHdoZW4gYGh1bWM9MGAsIHRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIGF2ZXJhZ2UgaHVtaWRpdHkgaW4gdGhlIGRhdGFzZXQuCiAtIFRoZSBhcmd1bWVudCBgZmFtaWx5ID0gInBvaXNzb24iYCBzcGVjaWZpZXMgdGhlIFBvaXNzb24gZGlzdHJpYnV0aW9uIGZvciB0aGUgcmVzcG9uc2UgdmFyaWFibGUgYW5kIGJ5IGRlZmF1bHQgdGhlIGNhbm9uaWNhbCBsaW5rIGZ1bmN0aW9uLCB3aGljaCBpcyB0aGUgbG9nIGxpbmssIHdpbGwgYmUgdXNlZC4KIApgYGB7cn0KQmlrZXNoYXJlJGh1bWMgPC0gQmlrZXNoYXJlJGh1bSAtIG1lYW4oQmlrZXNoYXJlJGh1bSkKbSA8LSBnbG0oYmlrZXJzIH4gd2VhdGhlcnNpdCArIGh1bWMgKyBJKGh1bWNeMikgKyBJKGh1bWNeMykgKyBociwKICAgICAgICAgZGF0YSA9IEJpa2VzaGFyZSwKICAgICAgICAgZmFtaWx5ID0gInBvaXNzb24iKQpzdW1tYXJ5KG0pCmBgYAoKIyMjIyBJbnRlcnByZXRhdGlvbiBvZiBlc3RpbWF0ZWQgbW9kZWwgcGFyYW1ldGVycyAKCiAtIFJlbWVtYmVyIHRoYXQgdGhlIFBvaXNzb24gR0xNIGNhbiBiZSBkZWZpbmVkIGFzCiAkJAogIFxsZWZ0XHsKICBcYmVnaW57YXJyYXl9e2NjY30KICBZX2kgJiBcc2ltICYgUG9pKFxtdV9pKSBcXAogIFxsb2cgXG11X2kgJiA9ICYgXGV0YV9pIFxcCiAgXGV0YV9pICYgPSAmIFxtYXRoYmZ7WH1eVF9pIFxtYXRoYmZ7XGJldGF9IFxcCiAgXGVuZHthcnJheX0KICBccmlnaHQuCiAgJCQKICAKICpJbnRlcnByZXRhdGlvbiBvZiB0aGUgaW50ZXJjZXB0LioKICAKIC0gV2Ugd2lsbCBmaXJzdCBpbnRlcnByZXQgdGhlIGludGVyY2VwdCwgaW4gdGVybXMgb2YgdGhlIGF2ZXJhZ2UgbnVtYmVyIG9mIGJpa2VzIGJlaW5nIHVzZWQuIE5vdGUgdGhhdCB0aGUgaW50ZXJjZXB0IGNvcnJlc3BvbmRzIHRvIGhvdXIgMCwgYXQgZ29vZCB3ZWF0aGVyIChgd2VhdGhlcnNpdGAgbGV2ZWwgMSksIGFuZCBhdmVyYWdlIGh1bWlkaXR5LiBXZSB3aWxsIGRlbm90ZSB0aGUgaW50ZXJjZXB0IGFzICRcYmV0YV8wJCBhbmQgaXRzIGVzdGltYXRlLCBnaXZlbiB0aGUgZGF0YSwgYXMgJFxoYXR7XGJldGF9XzAkLiBBbGwgb3RoZXIgY29lZmZpY2llbnRzIHdpbGwgdGh1cyBkZW5vdGUgYSByZWxhdGl2ZSBjaGFuZ2Ugd2l0aCByZXNwZWN0IHRvIHRoYXQgcmVmZXJlbmNlIGxldmVsLgogLSBUaGUgbW9kZWwgZGVmaW5pdGlvbiBzaG93cyB0aGF0ICRcbG9nIFxtdV9pID0gXG1hdGhiZntYfV5UX2kgXG1hdGhiZntcYmV0YX0kLCB3aXRoICRcbXUkIHRoZSBhdmVyYWdlIG51bWJlciBvZiBiaWtlcyBiZWluZyB1c2VkLiBTaW5jZSB3ZSdyZSBvbmx5IHdvcmtpbmcgd2l0aCB0aGUgaW50ZXJjZXB0IGhlcmUsIHdlIG1heSB3cml0ZSAkXGxvZyBcbXVfaSA9IFxiZXRhXzAkLCBhbmQgdGh1cyAkXG11X2kgPSBcZXhwIFxiZXRhXzAkLgogLSBQbHVnZ2luZyBpbiB0aGUgZXN0aW1hdGVkIGludGVyY2VwdCAkXGhhdHtcYmV0YX1fMCQsIHdlIGhhdmUgJFxleHAgXGhhdHtcYmV0YX1fMCA9JCBgciByb3VuZChleHAoY29lZihtKVsxXSksIDIpYC4gSW4gb3RoZXIgd29yZHMsIGluIGNsZWFyIHdlYXRoZXIgd2l0aCBmZXcgY2xvdWRzLCBhdCB6ZXJvIGh1bWlkaXR5IGFuZCBhdCBob3VyIDAsIGFuIGF2ZXJhZ2Ugb2YgJDQwLjgyJCBiaWtlcyBhcmUgYmVpbmcgdXNlZC4KIAogLS0tCiAKICpJbnRlcnByZXRhdGlvbiBvZiBgd2VhdGhlcnNpdGNsb3VkeS9taXN0eWAuKgogCiAtIFdlIHdpbGwgZGVub3RlIHRoaXMgY29lZmZpY2llbnQgYXMgJFxiZXRhXzEkIGFuZCBpdHMgZXN0aW1hdGUgYXMgJFxoYXR7XGJldGF9XzEkLiAKIC0gTm90ZSB0aGF0IHRoaXMgY29lZmZpY2llbnQgZGVmaW5lcyB0aGUgZGlmZmVyZW5jZSBpbiBsaW5lYXIgcHJlZGljdG9yIGJldHdlZW4gYHdlYXRoZXJzaXQ9MmAgYW5kIGB3ZWF0aGVyc2l0PTFgLCBhbGwgb3RoZXIgdmFyaWFibGVzIGJlaW5nIGVxdWFsIChzYXksIGF0IHRoZWlyIHJlZmVyZW5jZSBsZXZlbCkuIEluZGVlZCwgZGVmaW5lICRcZXRhX3t3Mn0kIGFuZCAkXGV0YV97dzF9JCB0byBkZW5vdGUgdGhlIGxpbmVhciBwcmVkaWN0b3IgYXQgYHdlYXRoZXJzaXQ9MmAsIGFuZCBgd2VhdGhlcnNpdD0xYCwgcmVzcGVjdGl2ZWx5LiBUaGVuLCAkXGV0YV97dzJ9IC0gXGV0YV97dzF9ID0gKFxiZXRhXzAgKyBcYmV0YV8xKSAtIFxiZXRhXzAgPSBcYmV0YV8xJC4KIC0gVGhpcyBhbHNvIG1lYW5zIHRoYXQgJFxiZXRhXzEgPSBcbG9nIFxtdV97dzJ9IC0gXGxvZyBcbXVfe3cxfSA9IFxsb2cgXGZyYWN7XG11X3t3Mn19e1xtdV97MjF9fSQsIGFuZCB0aHVzICRcZXhwIFxiZXRhXzEgPSBcZnJhY3tcbXVfe3cyfX17XG11X3syMX19JC4KIC0gSW4gb3VyIGNhc2UsICRcZXhwIFxoYXR7XGJldGF9XzEgPSQgYHIgcm91bmQoZXhwKGNvZWYobSlbMl0pLCAyKWAuIEluIHdvcmRzOiBBbGwgb3RoZXIgdmFyaWFibGVzIGJlaW5nIGVxdWFsLCB0aGUgYXZlcmFnZSBudW1iZXIgb2YgYmlrZXMgYmVpbmcgdXNlZCBpbiBjbG91ZHkvbWlzdHkgd2VhdGhlciBpcyAkMC44NSQgdGltZXMgKG9yLCBhbHNvLCAkODVcJSQgb2YpIHRoZSBudW1iZXIgb2YgYmlrZXMgYmVpbmcgdXNlZCBpbiBnb29kIHdlYXRoZXIuCiAtIFRoaXMgZXhlcmNpc2UgaGFzIHNob3duIHVzIHRoYXQsIGR1ZSB0byB0aGUgJFxsb2ckIGxpbmsgZnVuY3Rpb24sIHRoZSBwYXJhbWV0ZXJzIGluIGEgUG9pc3NvbiBHTE0gY2Fubm90IGJlIGludGVycHJldGVkIGluIHRlcm1zIG9mIGFic29sdXRlIGRpZmZlcmVuY2VzIGluIGF2ZXJhZ2VzIG9mIHRoZSByZXNwb25zZSB2YXJpYWJsZSBidXQgaW5zdGVhZCBtdXN0IGJlIGludGVycHJldGVkIGluIHRlcm1zIG9mIG11bHRpcGxpY2F0aXZlIGRpZmZlcmVuY2VzIQogLSBJZiB5b3UncmUgaW4gYSBtZWV0aW5nIGFuZCB5b3UgbmVlZCBhIHF1aWNrIHdheSB0byBpbnRlcnByZXQgdGhlc2UgcGFyYW1ldGVycywgcmVtZW1iZXIgdGhhdCAkZXhwKDEpID0gMi43MiBcYXBwcm94IDMkIGFuZCB0aHVzIGFuIGVzdGltYXRlZCBjb2VmZmljaWVudCBvZiAkMSQgKCQtMSQpIG1lYW5zIHRoZSBhdmVyYWdlIG9mIHRoZSByZXNwb25zZSB2YXJpYWJsZSBpcyBhYm91dCB0aHJlZSB0aW1lcyBoaWdoZXIgKGxvd2VyKS4KIAogLS0tCiAKICpJbnRlcnByZXRhdGlvbiBvZiB0aGUgaHVtaWRpdHkgZWZmZWN0LioKIAogLSBUaGUgaHVtaWRpdHkgZWZmZWN0IGlzIGEgYml0IG1vcmUgaW52b2x2ZWQgdG8gaW50ZXJwcmV0LiBEdWUgdG8gdGhlIHF1YWRyYXRpYyBhbmQgY3ViaWMgdGVybXMsIHdlIGNhbm5vdCBpbnRlcnByZXQgdGhlIGxpbmVhciB0ZXJtIHNlcGFyYXRlbHkgKG5vciBjYW4gd2UgaW50ZXJwcmV0IHRoZSBxdWFkcmF0aWMgb3IgY3ViaWMgdGVybSBzZXBhcmF0ZWx5KTsgd2UgbXVzdCBpbnRlcnByZXQgYm90aCB0aGUgbGluZWFyLCBxdWFkcmF0aWMgYW5kIGN1YmljIHRlcm0gc2ltdWx0YW5lb3VzbHkuCiAtIEFsc28gZHVlIHRvIHRoZSBoaWdoZXItb3JkZXIgdGVybXMsIHRoZSByYXRlIG9mIGNoYW5nZSBpbiBhdmVyYWdlIGJpa2VycyB3aWxsIG5vdCBiZSBjb25zdGFudCBhY3Jvc3MgdGhlIHJhbmdlIG9mIGh1bWlkaXR5LiBXZSBjYW4gdGhlcmVmb3JlIG5vdCBpbnRlcnByZXQgdGhlIGh1bWlkaXR5IGVmZmVjdCB1c2luZyBhIHNpbmdsZSBudW1iZXIgYXMgd2UndmUgZG9uZSBwcmV2aW91c2x5LgogLSBXZSBjYW4sIGhvd2V2ZXIsIHByb3ZpZGUgc29tZSBleGFtcGxlcyBmb3Igc3BlY2lmaWMgaHVtaWRpdHkgdmFsdWVzLCBhbG9uZyB3aXRoIGEgdmlzdWFsaXphdGlvbiBvZiBpdHMgZ2xvYmFsIGVmZmVjdC4KICAtIEZvciBleGFtcGxlLCBsZXQncyBkZXJpdmUgdGhlIGNoYW5nZSBpbiBhdmVyYWdlIGJpa2VzIGJlaW5nIHVzZWQgYXQgYSBodW1pZGl0eSB0aGF0IGlzICQwLjIkIGFib3ZlIGF2ZXJhZ2UsIHZlcnN1cyBhdmVyYWdlIGh1bWlkaXR5LgogIEZvciBhdmVyYWdlIGh1bWlkaXR5ICQrMC4yJCB0aGUgbGluZWFyIHByZWRpY3RvciAkXGV0YV97MC4yfSA9IFxiZXRhXzAgKyBcYmV0YV80IHhfe2h1bX0gKyBcYmV0YV81IHhfe2h1bX1eMiArIFxiZXRhXzYgeF97aHVtfV4zID0gXGJldGFfMCArIFxiZXRhXzQgMC4yICsgXGJldGFfNSAwLjJeMiArIFxiZXRhXzYgMC4yXjMkLgogIEZvciBhdmVyYWdlIGh1bWlkaXR5LCB0aGUgbGluZWFyIHByZWRpY3RvciAkXGV0YV97MH0gPSBcYmV0YV8wICsgXGJldGFfNCB4X3todW19ICsgXGJldGFfNSB4X3todW19XjIgKyBcYmV0YV82IHhfe2h1bX1eMyA9IFxiZXRhXzAgKyBcYmV0YV80IDAgKyBcYmV0YV81IDBeMiArIFxiZXRhXzYgMF4zID0gXGJldGFfMCQuCiAgV2UgdGh1cyBoYXZlICRcbG9nIFxmcmFje1xtdV97MC4yfX17XG11XzB9ID0gXGJldGFfNCAwLjIgKyBcYmV0YV81IDAuMl4yICsgXGJldGFfNiAwLjJeMyQuIEluIG91ciBjYXNlLCAkXGxvZyBcZnJhY3tcaGF0e1xtdX1fezAuMn19e1xoYXR7XG11fV8wfSA9IDAuMDkxNzUxKjAuMiAtIDIuMjMzOTE5ICogMC4yXjIgLSAxLjgyMzA2NiAqIDAuMl4zID0gLTAuMDg1NiQgYW5kIHRodXMgJFxmcmFje1xoYXR7XG11fV97MC4yfX17XGhhdHtcbXV9XzB9ID0gMC45MiQuIFRoZXJlZm9yZSwgYXQgaHVtaWRpdHkgdGhhdCBpcyAkMC4yJCBhYm92ZSBhdmVyYWdlLCB0aGUgYXZlcmFnZSBudW1iZXIgb2YgYmlrZXMgYmVpbmcgdXNlZCBhcmUgJDAuOTIkIHRpbWVzIHRoZSBhdmVyYWdlIG51bWJlciBvZiBiaWtlcyB1c2VkIGF0IGF2ZXJhZ2UgaHVtaWRpdHkuCiAtIEp1c3QgbGlrZSB3aXRoIGxpbmVhciBtb2RlbHMsIHRoZSBgcHJlZGljdGAgZnVuY3Rpb24gaXMgZXh0cmVtZWx5IGhlbHBmdWwgd2hlbiB0cnlpbmcgdG8gdmlzdWFsaXplIGFuZCB1bmRlcnN0YW5kIGEgZml0dGVkIEdMTS4gSW4gR0xNcywgdGhlIGB0eXBlYCBhcmd1bWVudCBiZWNvbWVzIGVzc2VudGlhbCB3aGVuIHVzaW5nIHRoZSBgcHJlZGljdGAgZnVuY3Rpb24uIEluZGVlZCwgYnkgZGVmYXVsdCwgZXN0aW1hdGVzIGFyZSBwcm92aWRlZCBvbiB0aGUgbGluZWFyIHByZWRpY3RvciBzY2FsZTogaW4gb3VyIGNhc2UsIG9uIHRoZSAkXGxvZyQgc2NhbGUuIElmIHdlJ2QgbGlrZSBwcmVkaWN0aW9ucyBvbiB0aGUgc2NhbGUgb2YgdGhlIHJlc3BvbnNlIHZhcmlhYmxlLCB3ZSBuZWVkIHRvIHNldCBgdHlwZT0icmVzcG9uc2UiYC4gWW91IGNhbiBmaW5kIG1vcmUgaW5mb3JtYXRpb24gaW4gdGhlIGhlbHAgZmlsZSB1c2luZyBgP3ByZWRpY3QuZ2xtYC4KIC0gVGhlIHZpc3VhbGl6YXRpb24gc2hvd3MgdGhhdCB0aGUgaGlnaGVzdCBudW1iZXIgb2YgYmlrZXMgYXJlIGJlaW5nIHVzZWQgYXQgYXJvdW5kIGF2ZXJhZ2UgaHVtaWRpdHksIHdpdGggYSBkZWNyZWFzZWQgdXNhZ2UgYXQgaGlnaGVyIGFuZCBsb3dlciBodW1pZGl0aWVzLgogCmBgYHtyfQpodW1pZGl0eUdyaWQgPC0gc2VxKG1pbihCaWtlc2hhcmUkaHVtYyksIG1heChCaWtlc2hhcmUkaHVtYyksIAogICAgICAgICAgICAgICAgICAgIGxlbmd0aC5vdXQgPSA1MCkKbmV3RGYgPC0gZGF0YS5mcmFtZSh3ZWF0aGVyc2l0ID0gZmFjdG9yKCJjbGVhciIpLAogICAgICAgICAgICAgICAgICAgIGhyID0gZmFjdG9yKDgpLAogICAgICAgICAgICAgICAgICAgIGh1bWMgPSBodW1pZGl0eUdyaWQsCiAgICAgICAgICAgICAgICAgICAgIkkoaHVtY14yKSIgPSBodW1pZGl0eUdyaWReMiwKICAgICAgICAgICAgICAgICAgICAiSShodW1jXjMpIiA9IGh1bWlkaXR5R3JpZF4zKQp5aGF0IDwtIHByZWRpY3QobSwgCiAgICAgICAgICAgICAgICBuZXdkYXRhID0gbmV3RGYsCiAgICAgICAgICAgICAgICB0eXBlID0gInJlc3BvbnNlIikKCnBsb3QoeCA9IGh1bWlkaXR5R3JpZCwKICAgICB5ID0geWhhdCwKICAgICB0eXBlID0gJ2wnLCBsd2Q9MiwKICAgICB4bGFiID0gIkNlbnRlcmVkIGh1bWlkaXR5IiwKICAgICB5bGFiID0gIkF2ZXJhZ2UgbnVtYmVyIG9mIGJpa2VycyIpCmBgYAogCiAtLS0gCiAKICpTZXR0aW5nIHVwIGEgY29udHJhc3QuKgogCiAtIFN1cHBvc2Ugd2UncmUgaW50ZXJlc3RlZCBpbiB3aGV0aGVyIHRoZXJlIGFyZSBtb3JlIGJpa2VycyBhdCAoQSkgbWF4aW11bSBodW1pZGl0eSAoY2VudGVyZWQgaHVtaWRpdHkgdmFsdWUgb2YgJDAuMzU3JCksIGhvdXIgMTcsIGluIHRoZSBgbGlnaHQgcmFpbi9zbm93YCB3ZWF0aGVyIGNhdGVnb3J5LCB2ZXJzdXMgKEIpIGF2ZXJhZ2UgaHVtaWRpdHksIGhvdXIgOCwgaW4gdGhlIGBjbGVhcmAgd2VhdGhlciBjYXRlZ29yeS4gVGhpcyByZXF1aXJlcyB1cyB0byBzZXQgdXAgYSBjb250cmFzdCBpbiB0ZXJtcyBvZiBhIGxpbmVhciBjb21iaW5hdGlvbiBvZiB0aGUgbW9kZWwgcGFyYW1ldGVycy4KIC0gKipNYW51YWxseSoqOiAKICQkIFxsb2cgXG11X0EgPSBcYmV0YV8wICsgXGJldGFfMiB4X3tyYWluU25vd30gKyBcYmV0YV80IHhfe2h1bX0gKyBcYmV0YV81IHhfe2h1bX1eMiArIFxiZXRhXzYgeF97aHVtfV4zICsgXGJldGFfezIzfSB4X3tocjE3fSBcXD0gMy44OTQgLSAwLjU1NiArIDAuMDkyICogMC4zNTcgLSAyLjIzNCAqIDAuMzU3XjIgLSAxLjgyMyAqIDAuMzU3XjMgKyAyLjE0MCA9IDUuMTQzLlxcCiAgIFxsb2cgXG11X0IgPSBcYmV0YV8wICsgXGJldGFfezE0fSB4X3tocjh9ID0gMy44OTQgKyAxLjgzMCA9IDUuNzI0LlxcCiAgIFxmcmFje1xtdV9BfXtcbXVfQn0gPSBcZXhwKDUuMTQzIC0gNS43MjQpID0gMC41NTkuCiAgICQkCiAgIFRodXMsIGF0IG1heGltdW0gaHVtaWRpdHksIGhvdXIgMTcsIGluIHRoZSBgbGlnaHQgcmFpbi9zbm93YCB3ZWF0aGVyIGNhdGVnb3J5IHRoZSBhdmVyYWdlIG51bWJlciBvZiBiaWtlcnMgaXMgNTYlIHRpbWVzIHRoZSBhdmVyYWdlIG51bWJlciBvZiBiaWtlcnMgaW4gdGhlIGF2ZXJhZ2UgaHVtaWRpdHksIGhvdXIgOCwgaW4gdGhlIGBjbGVhcmAgd2VhdGhlciBjYXRlZ29yeS4KIC0gKipNYW51YWxseSBpbiBgUmAqKjogV2UgY2FuIGFsc28gdXNlIG1hdHJpeCBtdWx0aXBsaWNhdGlvbiB0byBkZXJpdmUgdGhlIGVzdGltYXRlcy4gV2Uga25vdyBmcm9tIG91ciBtYW51YWwgY2FsY3VsYXRpb25zIGFib3ZlLCB0aGF0IHRoZSBjb250cmFzdCBvZiBpbnRlcmVzdCBpcyAkKFxiZXRhXzAgKyBcYmV0YV8yIHhfe3JhaW5Tbm93fSArIFxiZXRhXzQgeF97aHVtfSArIFxiZXRhXzUgeF97aHVtfV4rIFxiZXRhXzYgeF97aHVtfV4zICsgXGJldGFfezIzfSB4X3tocjE3fSkgLSAoXGJldGFfMCArIFxiZXRhX3sxNH0geF97aHI4fSkkLiBXZSBjYW4gc3RvcmUgdGhpcyBpbiBhIGNvbnRyYXN0IG1hdHJpeCwgYW5kIHRoZW4gbXVsdGlwbHkgaXQgd2l0aCB0aGUgY29lZmZpY2llbnRzIG9mIG91ciBtb2RlbDoKIApgYGB7cn0KTCA8LSBtYXRyaXgoMCwgCiAgICAgICAgICAgIG5yb3cgPSBsZW5ndGgoY29lZihtKSksCiAgICAgICAgICAgIG5jb2wgPSAxKQpyb3duYW1lcyhMKSA8LSBuYW1lcyhjb2VmKG0pKQpMWyJ3ZWF0aGVyc2l0bGlnaHQgcmFpbi9zbm93IiwxXSA8LSAxCkxbImh1bWMiLDFdIDwtIDAuMzU3CkxbIkkoaHVtY14yKSIsIDFdIDwtIDAuMzU3XjIKTFsiSShodW1jXjMpIiwgMV0gPC0gMC4zNTdeMwpMWyJocjE3IiwgMV0gPC0gMQpMWyJocjgiLDFdIDwtIC0xCkwKCmJldGEgPC0gbWF0cml4KGNvZWYobSksIG5jb2w9MSkKZXhwKHQoTCkgJSolIGJldGEpICMgZXF1YWxzIG91ciBtYW51YWwgY2FsY3VsYXRpb24uCmBgYAogICAKIC0gKipVc2luZyBgcHJlZGljdGAgaW4gYFJgKio6CgpgYGB7cn0KIyBzZXQgdXAgZGF0YSBmcmFtZXMgd2l0aCByZWxldmFudCBwcmVkaWN0b3IgdmFyaWFibGVzJyB2YWx1ZXMuCmRmQSA8LSBkYXRhLmZyYW1lKHdlYXRoZXJzaXQgPSBmYWN0b3IoImxpZ2h0IHJhaW4vc25vdyIpLAogICAgICAgICAgICAgICAgICAgIGhyID0gZmFjdG9yKDE3KSwKICAgICAgICAgICAgICAgICAgICBodW1jID0gMC4zNTcsCiAgICAgICAgICAgICAgICAgICAgIkkoaHVtY14yKSIgPSAwLjM1N14yLAogICAgICAgICAgICAgICAgICAgICJJKGh1bWNeMykiID0gMC4zNTdeMykKZGZCIDwtIGRhdGEuZnJhbWUod2VhdGhlcnNpdCA9IGZhY3RvcigiY2xlYXIiKSwKICAgICAgICAgICAgICAgICAgICBociA9IGZhY3Rvcig4KSwKICAgICAgICAgICAgICAgICAgICBodW1jID0gMCwKICAgICAgICAgICAgICAgICAgICAiSShodW1jXjIpIiA9IDAsCiAgICAgICAgICAgICAgICAgICAgIkkoaHVtY14zKSIgPSAwKQoKIyBjYWxjdWxhdGUgZXN0aW1hdGVkIGF2ZXJhZ2UgbnVtYmVyIG9mIGJpa2Vycwp5aGF0QSA8LSBwcmVkaWN0KG0sIAogICAgICAgICAgICAgICAgbmV3ZGF0YSA9IGRmQSwKICAgICAgICAgICAgICAgIHR5cGUgPSAicmVzcG9uc2UiKQp5aGF0QiA8LSBwcmVkaWN0KG0sIAogICAgICAgICAgICAgICAgbmV3ZGF0YSA9IGRmQiwKICAgICAgICAgICAgICAgIHR5cGUgPSAicmVzcG9uc2UiKQoKeWhhdEEgLyB5aGF0QiAjIGFsc28gZXF1YWwgdG8gYWJvdmUuCmBgYAogCiAtLS0KIAogKipFeGVyY2lzZSoqOiB0cnkgdG8gZGVyaXZlIHRoZSBjaGFuZ2UgaW4gYXZlcmFnZSBudW1iZXIgb2YgYmlrZXJzIGJldHdlZW4gKGEpIGh1bWlkaXR5IG9mIDAuMSBhYm92ZSBhdmVyYWdlLCBjbGVhciB3ZWF0aGVyIChgd2VhdGhlcnNpdD0xYCksIGF0IGhvdXIgMTAgYW5kIChiKSBodW1pZGl0eSBvZiAwLjEgYmVsb3cgYXZlcmFnZSwgY2xvdWR5IHdlYXRoZXIgKGB3ZWF0aGVyc2l0PTJgKSwgYXQgaG91ciAyMCwgdXNpbmcgYWxsIHRocmVlIG1ldGhvZHMuCgojIyMjIE1vZGVsIGRldmlhbmNlLCByZXNpZHVhbHMgYW5kIGdvb2RuZXNzLW9mLWZpdAoKIC0gSW4gbGluZWFyIG1vZGVscywgd2Ugb2Z0ZW4gdXNlIHJlc2lkdWFscyAkZV9pID0geV9pIC0gXGhhdHtcbXV9X2kkIHRvIGNoZWNrIG1vZGVsIGFzc3VtcHRpb25zIChsaW5lYXJpdHksIGhvbW9zY2VkYXN0aWNpdHkpLiBIb3dldmVyLCBpbiBhIEdMTSBzZXR0aW5nLCB3ZSBrbm93IHRoYXQgdGhlIHZhcmlhbmNlIG9mIG91ciByZXNpZHVhbHMgd2lsbCBkZXBlbmQgb24gdGhlIG1lYW4sIGkuZS4sICRWYXIoXGVwc2lsb25faSkgPSBmKFxtdV9pKSQuIFVzaW5nIG9yZGluYXJ5IHJlc2lkdWFscyBzdWNoIGFzICRlX2kkIHRoZXJlZm9yZSBpcyBubyBsb25nZXIgYXBwcm9wcmlhdGUuCiAtIFdlIGhhdmUgc2VlbiB0aGF0IHRoZSBvYmplY3RpdmUgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIGZpdCBhIEdMTSBpcyB0aGUgbG9nLWxpa2VsaWhvb2Qgb2YgdGhlIGRhdGEgdW5kZXIgdGhlIHBvc2l0ZWQgbW9kZWwuIEZvciBleGFtcGxlLCB0aGUgbG9nIGxpa2VsaWhvb2Qgb2YgYSBQb2lzc29uIEdMTSB3aXRoIHJlc3BvbnNlIHZhcmlhYmxlICRcbWF0aGJme1l9JCwgd2l0aCBlbGVtZW50cyAkWV9pLCBpIFxpbiBcezEsIFxsZG90cywgblx9JCBhbmQgbW9kZWwgbWF0cml4ICRcbWF0aGJme1h9JCBpcwogJCQgXGVsbChcbWF0aGJme1l9OyAgXG1hdGhiZntcYmV0YX0pID0gXGxvZyBccHJvZF97aT0xfV5uIFxsZWZ0KCBcZnJhY3tcZXhwIChcbWF0aGJme1h9X2leVCBcbWF0aGJme1xiZXRhfSlee1lfaX0gXGV4cCggLSBcZXhwKFxtYXRoYmZ7WH1faV5UIFxtYXRoYmZ7XGJldGF9KSl9e1lfaSF9IFxyaWdodCkgPSBcc3VtX3tpPTF9Xm4gXGxvZyBcbGVmdCggXGZyYWN7XGV4cChcbWF0aGJme1h9X2leVCBcbWF0aGJme1xiZXRhfSlee1lfaX0gXGV4cCggLSBcZXhwKFxtYXRoYmZ7WH1faV5UIFxtYXRoYmZ7XGJldGF9KSl9e1lfaSF9IFxyaWdodCkgXFwgPSBcc3VtX3tpPTF9Xm4gWV9pIChcbWF0aGJme1h9X2leVCBcbWF0aGJme1xiZXRhfSkgKyBcZXhwKFxtYXRoYmZ7WH1faV5UIFxtYXRoYmZ7XGJldGF9KSAgLSBcbG9nIFlfaSEuICQkCiBUaGUgZXN0aW1hdGVzICRcaGF0e1xtYXRoYmZ7XGJldGF9fSQgYXJlIHRoZW4gZm91bmQgYnkgbWF4aW1pemluZyAkXGVsbChcbWF0aGJme1xiZXRhfSB8IFxtYXRoYmZ7WX0sIFxtYXRoYmZ7WH0gKSQgd2l0aCByZXNwZWN0IHRvICRcbWF0aGJme1xiZXRhfSQuIFRoaXMgaXMgYW5hbG9nb3VzIHRvIG1heGltaXppbmcgYSBHYXVzc2lhbiBsaWtlbGlob29kIGluIHRoZSBsaW5lYXIgbW9kZWwgc2V0dGluZy4KIC0gQSBnb29kbmVzcy1vZi1maXQgbWVhc3VyZSB1c2VkIGluIHRoZSBHTE0gc2V0dGluZyBpcyB0aGVuIHRoZSAqKnJlc2lkdWFsIGRldmlhbmNlKiosIHRoYXQgaXMgdHdpY2UgdGhlIGRpZmZlcmVuY2UgaW4gbG9nLWxpa2VsaWhvb2QgYmV0d2VlbiBhICdzYXR1cmF0ZWQgbW9kZWwnIGFuZCB0aGUgY3VycmVudCBtb2RlbC4gSGVyZSwgYSBzYXR1cmF0ZWQgbW9kZWwsIGlzIGEgbW9kZWwgd2hlcmUgd2UgZml0IG9uZSBwYXJhbWV0ZXIgcGVyIGRhdGEgcG9pbnQgYW5kIHRoZXJlZm9yZSBmaXQgdGhlIGRhdGEgcGVyZmVjdGx5LCBpbiBvdGhlciB3b3JkcyAkXGhhdHtcbXV9X2kgPSB5X2kkLiBUaGlzIGlzLAogJCQgMiAqIFxsZWZ0XHsgXGVsbChcbWF0aGJme1l9OyAgXG1hdGhiZntcYmV0YX0gfCBcaGF0e1xtdX1faSA9IHlfaSkgLSBcZWxsKFxtYXRoYmZ7WX07ICBcbWF0aGJme1xiZXRhfSB8IFxoYXR7XG11fV9pID0gXGV4cChcbWF0aGJme1h9X2leVCBcbWF0aGJme1xiZXRhfSkpIFxyaWdodFx9LiQkCiAtIEEgbG93IHJlc2lkdWFsIGRldmlhbmNlIGNhbiB0aHVzIGJlIGludGVycHJldGVkIGFzIGEgbW9kZWwgdGhhdCBpcyBmaXR0aW5nIHRoZSBkYXRhIHdlbGwsIHNpbmNlIHlvdXIgY3VycmVudCBtb2RlbCB3aWxsIGJlIGNsb3NlIGluIGxvZy1saWtlbGlob29kIHRvIHRoZSBzYXR1cmF0ZWQgbW9kZWwuIFRoZSBkZXZpYW5jZSBpcyBhIHZlcnkgdXNlZnVsIHN0YXRpc3RpYyB0aGF0IGlzIGFsc28gaW1wb3J0YW50IGluIHN0YXRpc3RpY2FsIGluZmVyZW5jZSBhbmQgbW9kZWwgc2VsZWN0aW9uLCBlLmcuLCBmb3IgdGVzdGluZyBpZiBhIHNtYWxsZXIgbW9kZWwgZml0cyBzaWduaWZpY2FudGx5IHdvcnNlIHRoYW4gYSBsYXJnZXIgbW9kZWwuCiAtIEZpbmFsbHksIGEgKipkZXZpYW5jZSByZXNpZHVhbCoqICREX2kkIGNhbiB0aGVuIGJlIGRlZmluZWQgYXMgdGhlIHNxdWFyZSByb290IG9mIHRoZSBjb250cmlidXRpb24gb2YgdGhlICRpJHRoIGRhdHVtIHRvIHRoZSByZXNpZHVhbCBkZXZpYW5jZQogJCQgRF9pID0gXHNxcnR7IDIqIFxsZWZ0XHsgXGVsbChcbWF0aGJme1l9OyAgXG1hdGhiZntcYmV0YX0gfCBcaGF0e1xtdX1faSA9IHlfaSkgLSBcZWxsKFxtYXRoYmZ7WX07ICBcbWF0aGJme1xiZXRhfSB8IFxoYXR7XG11fV9pID0gXGV4cChcbWF0aGJme1h9X2leVCBcbWF0aGJme1xiZXRhfSkpIFxyaWdodFx9IH0gJCQKCiAqKkV4ZXJjaXNlKio6IFNlZSBpZiB5b3UgY2FuIGNvbWUgdXAgd2l0aCB0aGUgcmVzaWR1YWwgZGV2aWFuY2UgdGhhdCBpcyByZXBvcnRlZCBpbiB0aGUgc3VtbWFyeSBvZiBvdXIgbW9kZWwgYWJvdmUuIEFsc28gY2hlY2sgaWYgeW91IGNhbiByZWNvdmVyIHRoZSBjb3JyZWN0IGRldmlhbmNlIHJlc2lkdWFscyBieSBjYWxjdWxhdGluZyB0aGVtIHlvdXJzZWxmLiBZb3UgY2FuIGdldCB0aGUgZGV2aWFuY2UgcmVzaWR1YWxzIGluIGBSYCBieSBgcmVzaWQobSwgdHlwZT0iZGV2aWFuY2UiKWAuCgoKIyMgT3ZlcmRpc3BlcnNpb24KCgoKYGBge3J9CmxpYnJhcnkoTUFTUykKbSA8LSBnbG0ubmIoYmlrZXJzIH4gd2VhdGhlcnNpdCArIGh1bSArIGhyLAogICAgICAgICBkYXRhID0gQmlrZXNoYXJlKQoKc3VtbWFyeShtKQoKcGxvdChtKQpgYGAKCgoKCgoKIyBBIGZpbmFsIG5vdGUgYW5kIHN1bW1hcnkKCmBgYHtyLCBlY2hvPUZBTFNFLCBmaWcuY2FwPXBhc3RlKCIiKX0KIyBBbGwgZGVmYXVsdHMKaW5jbHVkZV9ncmFwaGljcygiLi9pbWFnZXNfc2VxdWVuY2luZy94a2NkLTE3MjUtbGluZWFyX3JlZ3Jlc3Npb25fMngucG5nIikKYGBgCgoKCiMgUmVmZXJlbmNlcwoKIC0gW01hcmlvbmkgKmV0IGFsLiogKDIwMDgpXShodHRwczovL2dlbm9tZS5jc2hscC5vcmcvY29udGVudC8xOC85LzE1MDkpIGRlc2NyaWJlIHRoZSBkaXN0cmlidXRpb24gb2YgZ2VuZSBleHByZXNzaW9uIGNvdW50cyBhY3Jvc3MgdGVjaG5pY2FsIHJlcGxpY2F0ZXMsIGFuZCBpbiBhZGRpdGlvbiBkaXNjdXNzIGxhbmUgZWZmZWN0cyBpbiBSTkEtc2VxLCBhcyB3ZWxsIGFzIGEgY29tcGFyaXNvbiBiZXR3ZWVuIFJOQS1zZXEgYW5kIGFycmF5LWJhc2VkIHBsYXRmb3Jtcy4KIC0gVGhlIGNvdW50IGRhdGEgY2hhcHRlciBvZiBNb2Rlcm4gU3RhdGlzdGljcyBmb3IgTW9kZXJuIEJpb2xvZ3kgYnkgV29sZmdhbmcgSHViZXIgYW5kIFN1c2FuIEhvbG1lcyBoYW5kbGVzIHNpbWlsYXIgdG9waWNzIGFsc28gaW4gdGhlIGNvbnRleHQgb2YgUk5BLXNlcTogaHR0cHM6Ly93d3cuaHViZXIuZW1ibC5kZS9tc21iL0NoYXAtQ291bnREYXRhLmh0bWwKCgojIEp1bmsKCgpgYGB7ciwgZXZhbD1GQUxTRX0KbGlicmFyeShkcGx5cikKIyBkb3dubG9hZGVkIGZyb20gaHR0cHM6Ly9lcGlzdGF0Lndpdi1pc3AuYmUvY292aWQvIApkYXRhIDwtIHJlYWQuY3N2KCJ+L0Rvd25sb2Fkcy9DT1ZJRDE5QkVfQ0FTRVNfQUdFU0VYLmNzdiIpCiMgcmVtb3ZlIHJvd3Mgd2l0aCBOQQpkYXRhIDwtIGRhdGFbIWFwcGx5KGRhdGEsIDEgLCBmdW5jdGlvbih4KSBhbnkoaXMubmEoeCkpKSxdCiMgY29udmVydCB0byBSIERhdGUgZm9ybWF0CmRhdGEkREFURSA8LSBhcy5EYXRlKGRhdGEkREFURSkKIyBjb252ZXJ0IGRhdGUgdG8gZGF5IG9mIHRoZSB3ZWVrCmRhdGEkZGF5IDwtIHdlZWtkYXlzKGRhdGEkREFURSkKCmRhdGFHcm91cGVkIDwtIGdyb3VwX2J5KGRhdGEsIERBVEUpICU+JQogIHN1bW1hcml6ZShuQ2FzZXMgPSBzdW0oQ0FTRVMpLAogICAgICAgICAgICBkYXkgPSB1bmlxdWUoZGF5KSkKCnBsb3QoeD1kYXRhR3JvdXBlZCREQVRFLCB5PWRhdGFHcm91cGVkJG5DYXNlcywKICAgICBwY2g9MTYsIGNleD0xLzIpCgojIGxlc3MgcmVwb3J0aW5nIG9uIHdlZWtlbmRzCnBsb3QoeD1kYXRhR3JvdXBlZCREQVRFLCB5PWRhdGFHcm91cGVkJG5DYXNlcywKICAgICBwY2g9MTYsIGNleD0xLzIsIGNvbD1mYWN0b3IoZGF0YUdyb3VwZWQkZGF5KSkKYGBg</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("sequencing_countData.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
